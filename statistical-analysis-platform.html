<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µê³„ ë¶„ì„ í”Œë«í¼ | êµ­ë¦½ìˆ˜ì‚°ê³¼í•™ì›</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SheetJS -->
    <script defer src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2canvas for PDF screenshots -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        * {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }
        
        /* Light Mode (Default) */
        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.08);
        }
        
        /* Dark Mode */
        [data-theme='dark'] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #475569;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .professional-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow-color);
            transition: all 0.3s ease;
        }
        
        .professional-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .step-number.inactive {
            background: #e5e7eb;
            color: #9ca3af;
        }
        
        .step-number.complete {
            background: #10b981;
            animation: checkmark 0.3s ease;
        }
        
        @keyframes checkmark {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #6366f1 100%);
            transition: width 0.5s ease;
        }
        
        .help-tooltip {
            background: #1e293b;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            position: absolute;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            max-width: 300px;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .loading-spinner {
            border: 3px solid #e5e7eb;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ê³µí†µ ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë“¤ */
        .info-box {
            padding: 16px;
            border-radius: 8px;
            border-width: 1px;
            animation: slideIn 0.3s ease;
        }
        
        .info-box.success {
            background: #f0f9ff;
            border-color: #bae6fd;
        }
        
        .info-box.warning {
            background: #fef3c7;
            border-color: #fde047;
        }
        
        .info-box.error {
            background: #fee2e2;
            border-color: #fca5a5;
        }
        
        .result-box {
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #bae6fd;
            background: #f0f9ff;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .warning-box {
            background: #fef3c7;
            border: 1px solid #fde68a;
            border-radius: 8px;
            padding: 16px;
        }
        
        .success-box {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            border-radius: 8px;
            padding: 16px;
        }
        
        .error-box {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            border-radius: 8px;
            padding: 16px;
        }
        
        .auto-progress-checkbox {
            accent-color: #3b82f6;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
        }
        
        .btn-primary:disabled {
            background: #94a3b8;
            transform: none;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .btn-secondary {
            background: white;
            color: #475569;
            padding: 12px 24px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: #f8fafc;
            border-color: #94a3b8;
            transform: translateY(-1px);
        }
        
        .info-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: #eff6ff;
            color: #3730a3;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .drop-zone {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fafafa;
        }
        
        .drop-zone:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }
        
        .drop-zone.dragover {
            border-color: #3b82f6;
            background: #dbeafe;
            transform: scale(1.02);
        }
        
        .tooltip-trigger {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: #e5e7eb;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 11px;
            cursor: help;
            margin-left: 4px;
        }
        
        .step-content {
            opacity: 0;
            animation: fadeSlideIn 0.4s forwards;
        }
        
        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .pulse-once {
            animation: pulse 1s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .loading-stage {
            display: flex;
            align-items: center;
            padding: 8px 0;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        
        .loading-stage.active {
            opacity: 1;
            font-weight: 600;
        }
        
        .loading-stage.complete {
            opacity: 0.7;
        }
        
        .loading-stage .check {
            display: none;
            color: #10b981;
            margin-right: 8px;
        }
        
        .loading-stage.complete .check {
            display: inline;
        }
        
        .loading-stage.complete .spinner {
            display: none;
        }
    </style>
</head>
<body>

    <!-- ì²« ë°©ë¬¸ ì•ˆë‚´ (ì˜µì…˜) -->
    <div id="welcomeTour" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md mx-4">
            <h2 class="text-xl font-bold mb-4">ğŸ‰ í†µê³„ ë¶„ì„ í”Œë«í¼ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
            <p class="text-gray-600 mb-6">
                ì´ í”Œë«í¼ì€ ë³µì¡í•œ í†µê³„ ë¶„ì„ì„ 6ë‹¨ê³„ë¡œ ê°„ë‹¨í•˜ê²Œ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ë“œë¦½ë‹ˆë‹¤.
                í†µê³„ ì§€ì‹ì´ ì—†ì–´ë„ ìë™ìœ¼ë¡œ ìµœì ì˜ ë¶„ì„ ë°©ë²•ì„ ì„ íƒí•´ë“œë ¤ìš”.
            </p>
            <div class="flex space-x-3">
                <button onclick="startTour()" class="btn-primary">
                    ğŸ‘‹ ê°„ë‹¨í•œ íˆ¬ì–´ ì‹œì‘
                </button>
                <button onclick="closeTour()" class="btn-secondary">
                    ë‚˜ì¤‘ì— í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <div class="min-h-screen p-4 md:p-8">
        <!-- í—¤ë” -->
        <header class="max-w-7xl mx-auto mb-8">
            <div class="professional-card p-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">í†µê³„ ë¶„ì„ í”Œë«í¼</h1>
                        <p class="text-gray-600 mt-1">êµ­ë¦½ìˆ˜ì‚°ê³¼í•™ì› | National Institute of Fisheries Science</p>
                        <p class="text-xs text-gray-500 mt-1">SciPy.stats ê¸°ë°˜ | Python ê³¼í•™ ì»´í“¨íŒ… ë¼ì´ë¸ŒëŸ¬ë¦¬</p>
                    </div>
                    <div class="text-right">
                        <button onclick="showHelp()" class="btn-secondary mb-2">
                            <span class="mr-2">â“</span> ë„ì›€ë§
                        </button>

                        <button onclick="exportProgress()" class="btn-secondary mb-2 ml-2" id="exportBtn" style="display:none;">
                            <span class="mr-2">ğŸ’¾</span> ì§„í–‰ìƒí™© ì €ì¥
                        </button>
                    </div>
                </div>
                
                <!-- ê°œì„ ëœ ë¡œë”© ìƒíƒœ í‘œì‹œ -->
                <div class="mt-4 flex items-center justify-between">
                    <div id="pyodideStatus" class="bg-gray-50 rounded-lg p-4 flex-1">
                        <div class="text-center">
                            <div class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                            <span class="text-sm text-gray-600">ì¤€ë¹„ ì¤‘...</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ì§„í–‰ ë‹¨ê³„ í‘œì‹œ (ê°œì„ ) -->
        <div class="max-w-7xl mx-auto mb-8">
            <div class="professional-card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">ë¶„ì„ ì§„í–‰ ë‹¨ê³„</h2>
                    <div class="flex items-center">
                        <button id="prevStepBtn" onclick="previousStep()" class="btn-secondary text-sm mr-2" disabled>
                            â† ì´ì „ ë‹¨ê³„
                        </button>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="autoProgress" class="auto-progress-checkbox mr-2">
                            <span class="text-sm text-gray-600">ìë™ ì§„í–‰</span>
                            <span class="tooltip-trigger" onmouseover="showTooltip(event, 'ê° ë‹¨ê³„ê°€ ì™„ë£Œë˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•©ë‹ˆë‹¤')" onmouseout="hideTooltip()">?</span>
                        </label>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <!-- ë‹¨ê³„ 1: ë°ì´í„° ì…ë ¥ -->
                    <div class="text-center cursor-pointer" onclick="moveToStep(1)">
                        <div class="step-number" id="step1">1</div>
                        <p class="text-xs mt-2">ë°ì´í„° ì…ë ¥</p>
                    </div>
                    
                    <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
                    
                    <!-- ë‹¨ê³„ 2: ë°ì´í„° ê²€ì¦ -->
                    <div class="text-center cursor-pointer" onclick="moveToStep(2)">
                        <div class="step-number inactive" id="step2">2</div>
                        <p class="text-xs mt-2">ë°ì´í„° ê²€ì¦</p>
                    </div>
                    
                    <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
                    
                    <!-- ë‹¨ê³„ 3: ê°€ì • ê²€ì • -->
                    <div class="text-center cursor-pointer" onclick="moveToStep(3)">
                        <div class="step-number inactive" id="step3">3</div>
                        <p class="text-xs mt-2">ê°€ì • ê²€ì •</p>
                    </div>
                    
                    <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
                    
                    <!-- ë‹¨ê³„ 4: ë°©ë²• ì„ íƒ -->
                    <div class="text-center cursor-pointer" onclick="moveToStep(4)">
                        <div class="step-number inactive" id="step4">4</div>
                        <p class="text-xs mt-2">ë°©ë²• ì„ íƒ</p>
                    </div>
                    
                    <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
                    
                    <!-- ë‹¨ê³„ 5: ë¶„ì„ ì‹¤í–‰ -->
                    <div class="text-center cursor-pointer" onclick="moveToStep(5)">
                        <div class="step-number inactive" id="step5">5</div>
                        <p class="text-xs mt-2">ë¶„ì„ ì‹¤í–‰</p>
                    </div>
                    
                    <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
                    
                    <!-- ë‹¨ê³„ 6: ê²°ê³¼ í•´ì„ -->
                    <div class="text-center cursor-pointer" onclick="moveToStep(6)">
                        <div class="step-number inactive" id="step6">6</div>
                        <p class="text-xs mt-2">ê²°ê³¼ í•´ì„</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë‹¨ê³„ë³„ ì½˜í…ì¸  ì˜ì—­ (ê°œì„ ) -->
        <div class="max-w-7xl mx-auto">
            <!-- ë‹¨ê³„ 1: ë°ì´í„° ì…ë ¥ (ê°œì„ ) -->
            <div id="step1Content" class="professional-card p-6 step-content">
                <h3 class="text-xl font-bold mb-4">
                    1ë‹¨ê³„: ë°ì´í„° ì…ë ¥
                    <span class="tooltip-trigger" onmouseover="showTooltip(event, 'Excel, CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ìƒ˜í”Œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”')" onmouseout="hideTooltip()">?</span>
                </h3>
                
                <!-- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ ê°œì„  -->
                <div id="dropZone" class="drop-zone mb-4">
                    <svg class="mx-auto mb-4" width="64" height="64" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="8" y="8" width="48" height="48" rx="8" stroke-dasharray="4 4"/>
                        <path d="M32 24v16m-8-8h16" stroke-linecap="round"/>
                    </svg>
                    <p class="text-lg font-medium mb-2">íŒŒì¼ì„ ì—¬ê¸°ë¡œ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ</p>
                    <p class="text-sm text-gray-500">Excel (.xlsx, .xls) ë˜ëŠ” CSV (.csv) íŒŒì¼</p>
                    <p class="text-xs text-gray-400 mt-2">ìµœëŒ€ íŒŒì¼ í¬ê¸°: 10MB</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" class="hidden">
                </div>
                
                <!-- íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° -->
                <div id="filePreview" class="hidden mb-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <svg class="w-8 h-8 text-blue-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-1a1 1 0 100-2h1a4 4 0 014 4v6a4 4 0 01-4 4H6a4 4 0 01-4-4V7a4 4 0 014-4z" clip-rule="evenodd"/>
                                </svg>
                                <div>
                                    <p class="font-medium" id="fileName">íŒŒì¼ëª….xlsx</p>
                                    <p class="text-sm text-gray-600" id="fileInfo">í¬ê¸°: 2.3MB | í–‰: 1,234 | ì—´: 5</p>
                                </div>
                            </div>
                            <button onclick="removeFile()" class="text-red-600 hover:text-red-800">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ë°ì´í„° ì—…ë¡œë“œ í›„ ì„¤ëª… -->
                <div id="step1Explanation" class="hidden mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-2">ğŸ“Š ë°ì´í„° ì—…ë¡œë“œ ì™„ë£Œ</h4>
                    <p class="text-sm text-gray-700 mb-2">
                        ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë°ì´í„°ì˜ í’ˆì§ˆì„ ê²€ì¦í•˜ê³  ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•  ì˜ˆì •ì…ë‹ˆë‹¤.
                    </p>
                    <ul class="text-xs text-gray-600 space-y-1 mb-3">
                        <li>â€¢ ë°ì´í„° í˜•ì‹ ë° ìœ í˜• ê²€ì‚¬</li>
                        <li>â€¢ ê²°ì¸¡ì¹˜ ë° ì´ìƒì¹˜ í™•ì¸</li>
                        <li>â€¢ ë³€ìˆ˜ë³„ ê¸°ë³¸ ì •ë³´ ìš”ì•½</li>
                    </ul>
                    <div class="flex space-x-3">
                        <button onclick="proceedToStep2()" class="btn-primary" id="proceedBtn1">
                            ë°ì´í„° ê²€ì¦ ì‹œì‘ â†’
                        </button>
                        <button onclick="clearFileSelection()" class="btn-secondary">
                            ğŸ”„ ë‹¤ë¥¸ íŒŒì¼ ì„ íƒ
                        </button>
                    </div>
                </div>
                
                <!-- ì´ˆê¸° ì—…ë¡œë“œ ë²„íŠ¼ë“¤ -->
                <div id="initialButtons" class="flex space-x-4">
                    <button onclick="generateSampleData()" class="btn-secondary">
                        <span class="mr-2">ğŸ²</span> ìƒ˜í”Œ ë°ì´í„° ìƒì„±
                    </button>
                </div>
            </div>

            <!-- ë‹¨ê³„ 2: ë°ì´í„° ê²€ì¦ -->
            <div id="step2Content" class="professional-card p-6 step-content hidden">
                <h3 class="text-xl font-bold mb-4">
                    2ë‹¨ê³„: ë°ì´í„° ê²€ì¦
                    <span class="tooltip-trigger" onmouseover="showTooltip(event, 'ì—…ë¡œë“œëœ ë°ì´í„°ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤')" onmouseout="hideTooltip()">?</span>
                </h3>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm font-semibold mb-2">ë°ì´í„° ìš”ì•½</p>
                        <div class="text-xs space-y-1">
                            <p>í–‰: <span id="rowCount">0</span></p>
                            <p>ì—´: <span id="colCount">0</span></p>
                        </div>
                        <!-- ë°ì´í„° í…Œì´ë¸”ì€ ì—¬ê¸°ë¡œ ì´ë™ -->
                        <div class="mt-3 overflow-x-auto max-h-32">
                            <table class="min-w-full text-xs">
                                <thead id="tableHeader"></thead>
                                <tbody id="tableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-sm font-semibold">ê²€ì¦ ìƒíƒœ</p>
                        <div id="dataValidation" class="mt-2"></div>
                    </div>
                </div>
                
                <!-- ìƒì„¸ ê²€ì¦ ê²°ê³¼ -->
                <div id="step2DetailedResults" class="hidden mt-4 p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-medium mb-3">ğŸ“Š ìƒì„¸ ë¶„ì„ ê²°ê³¼</h4>
                    <div id="detailedValidationContent"></div>
                </div>
                
                <!-- ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ ë²„íŠ¼ -->
                <div id="step2NextButton" class="hidden mt-4 text-center">
                    <button onclick="proceedToStep3()" class="btn-primary" disabled>
                        í†µê³„ì  ê°€ì • ê²€ì • ì‹œì‘ â†’
                    </button>
                </div>
                
                <!-- ë°ì´í„° ê²€ì¦ ê²°ê³¼ ì„¤ëª… -->
                <div id="step2Explanation" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <h4 class="font-semibold text-green-800 mb-2">âœ… ë°ì´í„° ê²€ì¦ ì™„ë£Œ</h4>
                    <p class="text-sm text-gray-700 mb-2">
                        ë°ì´í„° í’ˆì§ˆ ê²€ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë³€ìˆ˜ íƒ€ì…ì´ ë¶„ë¥˜ë˜ê³  ë¶„ì„ ì¶”ì²œì‚¬í•­ì´ ì œì‹œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” ì„ íƒí•œ ë¶„ì„ì— í•„ìš”í•œ í†µê³„ì  ê°€ì •ì„ ê²€ì •í•˜ê² ìŠµë‹ˆë‹¤.
                    </p>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div class="text-xs">
                            <strong>ìˆ˜í–‰ëœ ê²€ì¦:</strong>
                            <ul class="text-gray-600 mt-1 space-y-1">
                                <li>â€¢ ê²°ì¸¡ì¹˜ ë° ë°ì´í„° í’ˆì§ˆ í™•ì¸</li>
                                <li>â€¢ ë³€ìˆ˜ íƒ€ì… ë¶„ë¥˜ (ì—°ì†í˜•/ê·¸ë£¹í˜•)</li>
                                <li>â€¢ ì´ìƒì¹˜ ê°ì§€ ë° ê·¸ë£¹ ê· í˜• í™•ì¸</li>
                            </ul>
                        </div>
                        <div class="text-xs">
                            <strong>ë‹¤ìŒ ë‹¨ê³„ ì˜ˆì •:</strong>
                            <ul class="text-gray-600 mt-1 space-y-1">
                                <li>â€¢ ì •ê·œì„± ê²€ì • (Shapiro-Wilk/KS)</li>
                                <li>â€¢ ë“±ë¶„ì‚°ì„± ê²€ì • (Levene/Bartlett)</li>
                                <li>â€¢ í†µê³„ë°©ë²• ìë™ ì¶”ì²œ</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="proceedToStep3()" class="btn-primary">
                            ê°€ì • ê²€ì‚¬ ì‹œì‘ â†’
                        </button>
                        <button onclick="revalidateData()" class="btn-secondary">
                            ğŸ”„ ë°ì´í„° ì¬ê²€ì¦
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ë‹¨ê³„ 3: í†µê³„ì  ê°€ì • ê²€ì • -->
            <div id="step3Content" class="professional-card p-6 step-content hidden">
                <h3 class="text-xl font-bold mb-4">
                    3ë‹¨ê³„: í†µê³„ì  ê°€ì • ê²€ì •
                    <span class="tooltip-trigger" onmouseover="showTooltip(event, 'ì •ê·œì„±ê³¼ ë“±ë¶„ì‚°ì„±ì„ ê²€ì •í•©ë‹ˆë‹¤')" onmouseout="hideTooltip()">?</span>
                </h3>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold mb-2">ì •ê·œì„± ê²€ì •</h4>
                        <div id="normalityResults"></div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">ë“±ë¶„ì‚°ì„± ê²€ì •</h4>
                        <div id="homogeneityResults"></div>
                    </div>
                </div>
                
                <!-- ê°€ì • ê²€ì‚¬ ê²°ê³¼ ì„¤ëª… -->
                <div id="step3Explanation" class="hidden mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <h4 class="font-semibold text-purple-800 mb-2">ğŸ” ê°€ì • ê²€ì‚¬ ì™„ë£Œ</h4>
                    <p class="text-sm text-gray-700 mb-2">
                        í†µê³„ ë¶„ì„ì„ ìœ„í•œ ê¸°ë³¸ ê°€ì • ê²€ì‚¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë°ì´í„°ì˜ íŠ¹ì„±ì— ê¸°ë°˜í•˜ì—¬ ìµœì ì˜ í†µê³„ ë°©ë²•ì„ ì¶”ì²œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
                    </p>
                    <div class="bg-white p-3 rounded border mb-3">
                        <p class="text-xs font-semibold text-purple-700 mb-1">ê²€ì‚¬ ê²°ê³¼ í•´ì„:</p>
                        <div id="assumptionInterpretation" class="text-xs text-gray-600">
                            <!-- ê°€ì • ê²€ì‚¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="proceedToStep4()" class="btn-primary">
                            ìµœì  ë°©ë²• ì¶”ì²œ â†’
                        </button>
                        <button onclick="retestAssumptions()" class="btn-secondary">
                            ğŸ”„ ê°€ì • ì¬ê²€ì‚¬
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ë‹¨ê³„ 4: í†µê³„ ë°©ë²• ì„ íƒ -->
            <div id="step4Content" class="professional-card p-6 step-content hidden">
                <h3 class="text-xl font-bold mb-4">
                    4ë‹¨ê³„: ìµœì  í†µê³„ ë°©ë²• ì„ íƒ
                    <span class="tooltip-trigger" onmouseover="showTooltip(event, 'ë°ì´í„° íŠ¹ì„±ì— ë§ëŠ” ìµœì ì˜ í†µê³„ ë°©ë²•ì„ ì¶”ì²œí•©ë‹ˆë‹¤')" onmouseout="hideTooltip()">?</span>
                </h3>
                
                <div id="methodRecommendation" class="bg-blue-50 p-6 rounded-lg">
                    <p class="text-lg font-semibold mb-2">ì¶”ì²œ ë°©ë²• ë¶„ì„ ì¤‘...</p>
                </div>
                
                <!-- ë°©ë²• ì¶”ì²œ ê²°ê³¼ ì„¤ëª… -->
                <div id="step4Explanation" class="hidden mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg">
                    <h4 class="font-semibold text-orange-800 mb-2">ğŸ¯ ìµœì  ë°©ë²• ê²°ì •</h4>
                    <p class="text-sm text-gray-700 mb-2">
                        ë°ì´í„° íŠ¹ì„±ì„ ë¶„ì„í•˜ì—¬ ìµœì ì˜ í†µê³„ ë°©ë²•ì„ ê²°ì •í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ì¶”ì²œ ë‚´ìš©ì„ í™•ì¸í•˜ì‹œê³  ë¶„ì„ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.
                    </p>
                    <div class="bg-white p-3 rounded border mb-3">
                        <div id="methodDetails">
                            <!-- ì¶”ì²œ ë°©ë²• ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="proceedToStep5()" class="btn-primary">
                            ë¶„ì„ ì‹¤í–‰ ì‹œì‘ â†’
                        </button>
                        <button onclick="moveToStep(3)" class="btn-secondary">
                            â† ê°€ì • ê²€ì‚¬ ì¬í™•ì¸
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ë‹¨ê³„ 5: í†µê³„ ë¶„ì„ ì‹¤í–‰ -->
            <div id="step5Content" class="professional-card p-6 step-content hidden">
                <h3 class="text-xl font-bold mb-4">
                    5ë‹¨ê³„: í†µê³„ ë¶„ì„ ì‹¤í–‰
                    <span class="tooltip-trigger" onmouseover="showTooltip(event, 'SciPy.statsë¥¼ ì‚¬ìš©í•˜ì—¬ í†µê³„ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤')" onmouseout="hideTooltip()">?</span>
                </h3>
                
                <div class="text-center py-12">
                    <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                    <p class="text-lg font-medium">ë¶„ì„ì„ ì‹¤í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                    <p class="text-sm text-gray-600 mt-2" id="analysisProgress">ë°ì´í„° ì²˜ë¦¬ ì¤‘...</p>
                </div>
            </div>
            
            <!-- ë‹¨ê³„ 6: ê²°ê³¼ í•´ì„ -->
            <div id="step6Content" class="professional-card p-6 step-content hidden">
                <h3 class="text-xl font-bold mb-4">
                    6ë‹¨ê³„: ê²°ê³¼ í•´ì„
                    <span class="tooltip-trigger" onmouseover="showTooltip(event, 'ë¶„ì„ ê²°ê³¼ë¥¼ ì´í•´í•˜ê¸° ì‰½ê²Œ í•´ì„í•´ë“œë¦½ë‹ˆë‹¤')" onmouseout="hideTooltip()">?</span>
                </h3>
                
                <div id="analysisResults">
                    <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <!-- ë¶„ì„ ê²°ê³¼ ì„¤ëª… -->
                <div id="step6Explanation" class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <h4 class="font-semibold text-green-800 mb-2">ğŸ† ë¶„ì„ ì™„ë£Œ</h4>
                    <p class="text-sm text-gray-700 mb-2">
                        í†µê³„ ë¶„ì„ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ì˜ ê²°ê³¼ë¥¼ í†µí•´ ë°ì´í„°ì—ì„œ ì˜ë¯¸ ìˆëŠ” íŒ¨í„´ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div class="text-xs">
                            <strong>ê²°ê³¼ í™œìš©:</strong>
                            <ul class="text-gray-600 mt-1 space-y-1">
                                <li>â€¢ ì—°êµ¬ ë° ë³´ê³ ì„œ ì‘ì„±</li>
                                <li>â€¢ ì˜ì‚¬ê²°ì • ê·¼ê±° ìë£Œ</li>
                            </ul>
                        </div>
                        <div class="text-xs">
                            <strong>ë‚´ë³´ë‚´ê¸° ì˜µì…˜:</strong>
                            <ul class="text-gray-600 mt-1 space-y-1">
                                <li>â€¢ Excel íŒŒì¼ë¡œ ì €ì¥</li>
                                <li>â€¢ PDF ë³´ê³ ì„œ ìƒì„±</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="exportResults()" class="btn-primary">
                            ğŸ“¥ ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
                        </button>
                        <button onclick="resetAnalysis()" class="btn-secondary">
                            ğŸ”„ ìƒˆë¡œìš´ ë¶„ì„
                        </button>
                        <button onclick="moveToStep(1)" class="btn-secondary">
                            â† ì²˜ìŒìœ¼ë¡œ
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ë‚˜ë¨¸ì§€ ë‹¨ê³„ë“¤ì€ ê¸°ì¡´ê³¼ ìœ ì‚¬í•˜ê²Œ ê°œì„  -->
        </div>
    </div>

    <!-- íˆ´íŒ ì»¨í…Œì´ë„ˆ -->
    <div id="tooltip" class="help-tooltip hidden"></div>

    <!-- ê°œì„ ëœ Footer -->
    <footer class="mt-12 py-6 bg-gray-100 border-t border-gray-200">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center">
                <p class="text-xs text-gray-600 mb-2">
                    <strong>í†µê³„ ë¶„ì„ ì—”ì§„:</strong> SciPy.stats v1.11+ | NumPy v1.24+ | Pyodide v0.24.1
                </p>
                <p class="text-xs text-gray-500">
                    ì´ í”Œë«í¼ì€ ì˜¤í”ˆì†ŒìŠ¤ ê³¼í•™ ì»´í“¨íŒ… ë¼ì´ë¸ŒëŸ¬ë¦¬ SciPyì˜ ê²€ì¦ëœ í†µê³„ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.<br>
                    ëª¨ë“  í†µê³„ ê³„ì‚°ì€ SciPy.stats ëª¨ë“ˆì˜ í‘œì¤€ êµ¬í˜„ì„ ë”°ë¥´ë©°, í•™ìˆ  ì—°êµ¬ì—ì„œ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë¡ ì„ ì ìš©í•©ë‹ˆë‹¤.
                </p>
                
                <!-- ë‹¤í¬ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
                <div class="mt-4 mb-2">
                    <button id="darkModeToggle" class="inline-flex items-center px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm" title="ë‹¤í¬ ëª¨ë“œ ì „í™˜">
                        <svg id="sunIcon" class="w-4 h-4 text-yellow-500 hidden mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
                        </svg>
                        <svg id="moonIcon" class="w-4 h-4 text-gray-700 dark:text-gray-200 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                        </svg>
                        <span class="text-gray-700 dark:text-gray-200">ë‹¤í¬ ëª¨ë“œ</span>
                    </button>
                </div>
                
                <p class="text-xs text-gray-400 mt-2">
                    Â© 2024 êµ­ë¦½ìˆ˜ì‚°ê³¼í•™ì› í†µê³„ ë¶„ì„ í”Œë«í¼ | BSD ë¼ì´ì„ ìŠ¤ ê¸°ë°˜ ì˜¤í”ˆì†ŒìŠ¤ í™œìš©
                </p>
            </div>
        </div>
    </footer>

    <!-- Pyodide Script -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let pyodide = null;
        let currentStep = 1;
        let autoProgress = false;
        let currentData = null;
        let analysisResults = {};
        let tourStep = 0;
        
        // ì²« ë°©ë¬¸ ì²´í¬
        if (!localStorage.getItem('hasVisited')) {
            setTimeout(() => {
                document.getElementById('welcomeTour').classList.remove('hidden');
                localStorage.setItem('hasVisited', 'true');
            }, 1000);
        }
        
        // íˆ¬ì–´ ê¸°ëŠ¥
        // DOM ì¡°ì‘ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) element.classList.remove('hidden');
        }
        
        function hideElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) element.classList.add('hidden');
        }
        
        function enableButton(selector) {
            const button = document.querySelector(selector);
            if (button) {
                button.disabled = false;
                button.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
        
        function disableButton(selector) {
            const button = document.querySelector(selector);
            if (button) {
                button.disabled = true;
                button.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }
        
        // íˆ´íŒ í‘œì‹œ
        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = text;
            tooltip.style.left = event.clientX + 10 + 'px';
            tooltip.style.top = event.clientY - 30 + 'px';
            tooltip.classList.remove('hidden');
        }
        
        function hideTooltip() {
            document.getElementById('tooltip').classList.add('hidden');
        }
        
        // ë©”ëª¨ë¦¬ ê´€ë¦¬ í•¨ìˆ˜
        function cleanupPyodideMemory() {
            if (window.pyodide) {
                try {
                    pyodide.runPython(`
                        import gc
                        gc.collect()
                    `);
                    console.log('Python ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì‹¤í–‰ë¨');
                } catch (error) {
                    console.error('ë©”ëª¨ë¦¬ ì •ë¦¬ ì‹¤íŒ¨:', error);
                }
            }
        }
        
        // ì£¼ê¸°ì ì¸ ë©”ëª¨ë¦¬ ì •ë¦¬ (5ë¶„ë§ˆë‹¤)
        setInterval(cleanupPyodideMemory, 5 * 60 * 1000);
        
        // ê°„ì†Œí™”ëœ Pyodide ì´ˆê¸°í™”
        async function initPyodide() {
            try {
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
                });
                
                // ë©”ëª¨ë¦¬ ë¶€ì¡± ì²´í¬
                if (performance && performance.memory) {
                    const memoryInfo = performance.memory;
                    if (memoryInfo.usedJSHeapSize / memoryInfo.jsHeapSizeLimit > 0.9) {
                        throw new Error('ë©”ëª¨ë¦¬ ë¶€ì¡±: ë¸Œë¼ìš°ì €ë¥¼ ì¬ì‹œì‘í•˜ê±°ë‚˜ ë‹¤ë¥¸ íƒ­ì„ ë‹«ì•„ì£¼ì„¸ìš”.');
                    }
                }
                
                await pyodide.loadPackage(['numpy', 'scipy']);
                await pyodide.runPythonAsync(`
                    import numpy as np
                    from scipy import stats
                    import json
                    import warnings
                    warnings.filterwarnings('ignore')
                    
                    # ì •ê·œì„± ê²€ì • í•¨ìˆ˜
                    def test_normality(values):
                        """ì •ê·œì„± ê²€ì • (Shapiro-Wilk or D'Agostino KÂ²)"""
                        x = np.array(values, dtype=float)
                        # NaN ì œê±°
                        x = x[~np.isnan(x)]
                        n = len(x)
                        
                        if n < 3:
                            return {
                                "test": "insufficient_data",
                                "n": n,
                                "statistic": None,
                                "pValue": None,
                                "isNormal": False,
                                "message": "í‘œë³¸ ìˆ˜ ë¶€ì¡± (n < 3)"
                            }
                        elif n < 50:
                            # Shapiro-Wilk test
                            stat, p = stats.shapiro(x)
                            test_name = "Shapiro-Wilk"
                        else:
                            # D'Agostino KÂ² test (ë” ì•ˆì •ì )
                            stat, p = stats.normaltest(x)
                            test_name = "D'Agostino KÂ²"
                        
                        # ì™œë„ì™€ ì²¨ë„ ê³„ì‚°
                        skewness = stats.skew(x)
                        kurtosis = stats.kurtosis(x)
                        
                        return {
                            "test": test_name,
                            "n": n,
                            "statistic": float(stat),
                            "pValue": float(p),
                            "isNormal": p > 0.05,
                            "skewness": float(skewness),
                            "kurtosis": float(kurtosis),
                            "mean": float(np.mean(x)),
                            "std": float(np.std(x, ddof=1))
                        }
                    
                    # ë“±ë¶„ì‚°ì„± ê²€ì • í•¨ìˆ˜
                    def test_homogeneity(groups_dict):
                        """ë“±ë¶„ì‚°ì„± ê²€ì • (Brown-Forsythe/Levene)"""
                        # ê·¸ë£¹ë³„ ë°ì´í„° ì¤€ë¹„
                        groups = []
                        group_names = []
                        for name, values in groups_dict.items():
                            arr = np.array(values, dtype=float)
                            arr = arr[~np.isnan(arr)]
                            if len(arr) >= 2:
                                groups.append(arr)
                                group_names.append(name)
                        
                        if len(groups) < 2:
                            return {
                                "test": "insufficient_groups",
                                "statistic": None,
                                "pValue": None,
                                "isHomogeneous": False,
                                "message": "ë¹„êµ ê°€ëŠ¥í•œ ê·¸ë£¹ì´ 2ê°œ ë¯¸ë§Œ"
                            }
                        
                        # Brown-Forsythe test (ì¤‘ì•™ê°’ ê¸°ë°˜ - ë” robust)
                        stat_bf, p_bf = stats.levene(*groups, center='median')
                        
                        # Levene test (í‰ê·  ê¸°ë°˜ - ì°¸ê³ ìš©)
                        stat_lv, p_lv = stats.levene(*groups, center='mean')
                        
                        # Bartlett test (ì •ê·œì„± ì¶©ì¡± ì‹œ ì‚¬ìš©)
                        try:
                            stat_bt, p_bt = stats.bartlett(*groups)
                        except:
                            stat_bt, p_bt = None, None
                        
                        # ê° ê·¸ë£¹ì˜ ë¶„ì‚°
                        variances = [float(np.var(g, ddof=1)) for g in groups]
                        
                        return {
                            "test": "Brown-Forsythe",
                            "statistic": float(stat_bf),
                            "pValue": float(p_bf),
                            "isHomogeneous": p_bf > 0.05,
                            "levene_mean": {"statistic": float(stat_lv), "pValue": float(p_lv)},
                            "bartlett": {"statistic": float(stat_bt) if stat_bt else None, 
                                        "pValue": float(p_bt) if p_bt else None},
                            "variances": variances,
                            "variance_ratio": max(variances) / min(variances) if min(variances) > 0 else None,
                            "groups": len(groups)
                        }
                    
                    # t-test í•¨ìˆ˜
                    def perform_ttest(group1, group2, equal_var=True):
                        """Independent t-test or Welch's t-test"""
                        x = np.array(group1, dtype=float)
                        y = np.array(group2, dtype=float)
                        x = x[~np.isnan(x)]
                        y = y[~np.isnan(y)]
                        
                        if len(x) < 2 or len(y) < 2:
                            return {"error": "í‘œë³¸ ìˆ˜ ë¶€ì¡±"}
                        
                        # t-test
                        stat, p = stats.ttest_ind(x, y, equal_var=equal_var)
                        
                        # íš¨ê³¼ í¬ê¸° (Cohen's d)
                        nx, ny = len(x), len(y)
                        mx, my = np.mean(x), np.mean(y)
                        vx, vy = np.var(x, ddof=1), np.var(y, ddof=1)
                        
                        # Pooled standard deviation
                        sp = np.sqrt(((nx - 1) * vx + (ny - 1) * vy) / (nx + ny - 2))
                        cohens_d = (mx - my) / sp if sp > 0 else 0
                        
                        # 95% CI for mean difference
                        se = sp * np.sqrt(1/nx + 1/ny)
                        t_critical = stats.t.ppf(0.975, nx + ny - 2)
                        ci_lower = (mx - my) - t_critical * se
                        ci_upper = (mx - my) + t_critical * se
                        
                        return {
                            "statistic": float(stat),
                            "pValue": float(p),
                            "df": nx + ny - 2,
                            "cohens_d": float(cohens_d),
                            "mean_diff": float(mx - my),
                            "ci_95": [float(ci_lower), float(ci_upper)],
                            "group1": {"mean": float(mx), "std": float(np.sqrt(vx)), "n": nx},
                            "group2": {"mean": float(my), "std": float(np.sqrt(vy)), "n": ny}
                        }
                    
                    # ANOVA í•¨ìˆ˜
                    def perform_anova(groups_dict):
                        """One-way ANOVA"""
                        groups = []
                        for name, values in groups_dict.items():
                            arr = np.array(values, dtype=float)
                            arr = arr[~np.isnan(arr)]
                            if len(arr) >= 2:
                                groups.append(arr)
                        
                        if len(groups) < 2:
                            return {"error": "ê·¸ë£¹ ìˆ˜ ë¶€ì¡±"}
                        
                        # ANOVA
                        stat, p = stats.f_oneway(*groups)
                        
                        # íš¨ê³¼ í¬ê¸° ê³„ì‚°
                        all_data = np.concatenate(groups)
                        grand_mean = np.mean(all_data)
                        
                        # SST, SSB, SSW
                        sst = np.sum((all_data - grand_mean) ** 2)
                        ssb = sum(len(g) * (np.mean(g) - grand_mean) ** 2 for g in groups)
                        ssw = sst - ssb
                        
                        # eta squared
                        eta_squared = ssb / sst if sst > 0 else 0
                        
                        # omega squared
                        df_between = len(groups) - 1
                        df_within = len(all_data) - len(groups)
                        ms_between = ssb / df_between if df_between > 0 else 0
                        ms_within = ssw / df_within if df_within > 0 else 0
                        
                        omega_squared = (ssb - df_between * ms_within) / (sst + ms_within) if (sst + ms_within) > 0 else 0
                        
                        return {
                            "statistic": float(stat),
                            "pValue": float(p),
                            "df_between": df_between,
                            "df_within": df_within,
                            "eta_squared": float(eta_squared),
                            "omega_squared": float(omega_squared),
                            "group_count": len(groups),
                            "total_n": len(all_data)
                        }
                    
                    # ë¹„ëª¨ìˆ˜ ê²€ì • í•¨ìˆ˜ë“¤
                    def perform_mann_whitney(group1, group2):
                        """Mann-Whitney U test"""
                        x = np.array(group1, dtype=float)
                        y = np.array(group2, dtype=float)
                        x = x[~np.isnan(x)]
                        y = y[~np.isnan(y)]
                        
                        if len(x) < 2 or len(y) < 2:
                            return {"error": "í‘œë³¸ ìˆ˜ ë¶€ì¡±"}
                        
                        stat, p = stats.mannwhitneyu(x, y, alternative='two-sided')
                        
                        # íš¨ê³¼ í¬ê¸° (rank-biserial correlation)
                        n1, n2 = len(x), len(y)
                        r = 1 - (2 * stat) / (n1 * n2)
                        
                        return {
                            "statistic": float(stat),
                            "pValue": float(p),
                            "effect_size": float(r),
                            "n1": n1,
                            "n2": n2
                        }
                    
                    def perform_kruskal_wallis(groups_dict):
                        """Kruskal-Wallis H test"""
                        groups = []
                        for name, values in groups_dict.items():
                            arr = np.array(values, dtype=float)
                            arr = arr[~np.isnan(arr)]
                            if len(arr) >= 2:
                                groups.append(arr)
                        
                        if len(groups) < 2:
                            return {"error": "ê·¸ë£¹ ìˆ˜ ë¶€ì¡±"}
                        
                        stat, p = stats.kruskal(*groups)
                        
                        # íš¨ê³¼ í¬ê¸° (epsilon squared)
                        n = sum(len(g) for g in groups)
                        k = len(groups)
                        epsilon_squared = (stat - k + 1) / (n - k) if (n - k) > 0 else 0
                        
                        return {
                            "statistic": float(stat),
                            "pValue": float(p),
                            "epsilon_squared": float(epsilon_squared),
                            "group_count": k,
                            "total_n": n
                        }
                    
                    # í†µê³„ ë¶„ì„ í•¨ìˆ˜ë“¤
                    def validate_data(data):
                        """ë°ì´í„° ê²€ì¦"""
                        issues = []
                        valid = True
                        
                        for col, values in data.items():
                            # ê²°ì¸¡ì¹˜ í™•ì¸
                            null_count = sum(1 for v in values if v is None or (isinstance(v, str) and v.strip() == ''))
                            if null_count > 0:
                                issues.append(f"{col}: {null_count}ê°œ ê²°ì¸¡ì¹˜ ë°œê²¬")
                            
                            # ìˆ«ì ë°ì´í„° í™•ì¸
                            numeric_values = []
                            for v in values:
                                if v is not None and str(v).strip() != '':
                                    try:
                                        numeric_values.append(float(v))
                                    except:
                                        pass
                            
                            if len(numeric_values) < len(values) * 0.5:
                                issues.append(f"{col}: ìˆ«ìê°€ ì•„ë‹Œ ë°ì´í„°ê°€ 50% ì´ìƒ")
                                valid = False
                        
                        return {
                            'valid': valid,
                            'issues': issues
                        }
                    
                    print("í†µê³„ ì—”ì§„ ì¤€ë¹„ ì™„ë£Œ")
                `);
                
                // ì™„ë£Œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ
                document.getElementById('pyodideStatus').innerHTML = `
                    <div class="text-center">
                        <span class="text-sm text-green-600">âœ“ ì¤€ë¹„ ì™„ë£Œ</span>
                    </div>
                `;
                document.getElementById('proceedBtn1').disabled = false;
                
                // 3ì´ˆ í›„ ë¡œë”© ìƒíƒœ ì˜ì—­ ìˆ¨ê¸°ê¸°
                setTimeout(() => {
                    const pyodideStatus = document.getElementById('pyodideStatus');
                    if (pyodideStatus) {
                        pyodideStatus.style.transition = 'opacity 0.5s ease';
                        pyodideStatus.style.opacity = '0';
                        setTimeout(() => {
                            pyodideStatus.style.display = 'none';
                        }, 500);
                    }
                }, 3000);
                
            } catch (error) {
                console.error("Pyodide ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
                
                // ì—ëŸ¬ íƒ€ì…ë³„ ì²˜ë¦¬
                let errorMessage = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                let solution = 'í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.';
                
                if (error.name === 'NetworkError' || error.message.includes('fetch')) {
                    errorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.';
                    solution = 'ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                } else if (error.message.includes('ë©”ëª¨ë¦¬')) {
                    errorMessage = error.message;
                    solution = 'ë¸Œë¼ìš°ì €ë¥¼ ì¬ì‹œì‘í•˜ê±°ë‚˜ ë‹¤ë¥¸ íƒ­ì„ ë‹«ì•„ì£¼ì„¸ìš”.';
                } else if (error.message.includes('WebAssembly')) {
                    errorMessage = 'ë¸Œë¼ìš°ì €ê°€ WebAssemblyë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    solution = 'ìµœì‹  ë²„ì „ì˜ Chrome, Firefox, ë˜ëŠ” Edgeë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.';
                }
                
                const statusDiv = document.getElementById('pyodideStatus');
                statusDiv.textContent = '';
                const errorBox = document.createElement('div');
                errorBox.className = 'error-box';
                errorBox.innerHTML = `
                    <p class="font-semibold mb-2">âš ï¸ í†µê³„ ì—”ì§„ ë¡œë”© ì‹¤íŒ¨</p>
                    <p class="text-sm text-gray-700 mb-1">${errorMessage}</p>
                    <p class="text-sm text-gray-600 mb-3">${solution}</p>
                    <div class="flex space-x-2">
                        <button onclick="location.reload()" class="btn-primary text-sm">
                            ğŸ”„ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë‹¤ì‹œ ì‹œë„
                            </button>
                            <button onclick="showOfflineHelp()" class="btn-secondary text-sm">
                                ğŸ“– ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì•ˆë‚´
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        
        dropZone?.addEventListener('click', () => fileInput.click());
        
        dropZone?.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone?.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone?.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileInput?.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        // íŒŒì¼ í¬ê¸° í¬ë§·íŒ… í•¨ìˆ˜
        function formatFileSize(bytes) {
            if (bytes < 1024) return `${bytes} bytes`;
            if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
            return `${(bytes / 1024 / 1024).toFixed(2)} MB`;
        }
        
        // íŒŒì¼ ì²˜ë¦¬
        function handleFile(file) {
            // íŒŒì¼ í¬ê¸° ì²´í¬
            if (file.size > 10 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 10MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            document.getElementById('dropZone').classList.add('hidden');
            document.getElementById('filePreview').classList.remove('hidden');
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileInfo').textContent = `í¬ê¸°: ${formatFileSize(file.size)} | ì²˜ë¦¬ ì¤‘...`;
            
            // íŒŒì¼ ì½ê¸°
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    // íŒŒì¼ íŒŒì‹± ë¡œì§
                    let parsedData;
                    
                    if (file.name.endsWith('.csv')) {
                        // CSV íŒŒì‹±
                        const text = e.target.result;
                        const lines = text.split('\n').filter(line => line.trim());
                        if (lines.length < 2) throw new Error('CSV íŒŒì¼ì´ ë¹„ì–´ìˆê±°ë‚˜ í—¤ë”ë§Œ ìˆìŠµë‹ˆë‹¤.');
                        
                        const headers = lines[0].split(',').map(h => h.trim());
                        const data = {};
                        headers.forEach(header => data[header] = []);
                        
                        for (let i = 1; i < lines.length; i++) {
                            const values = lines[i].split(',').map(v => v.trim());
                            headers.forEach((header, idx) => {
                                if (values[idx] !== undefined) {
                                    data[header].push(values[idx]);
                                }
                            });
                        }
                        parsedData = data;
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        // Excel íŒŒì‹± (XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©)
                        const workbook = XLSX.read(e.target.result, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                        
                        if (jsonData.length < 2) throw new Error('Excel íŒŒì¼ì´ ë¹„ì–´ìˆê±°ë‚˜ í—¤ë”ë§Œ ìˆìŠµë‹ˆë‹¤.');
                        
                        const headers = jsonData[0];
                        const data = {};
                        headers.forEach(header => data[header] = []);
                        
                        for (let i = 1; i < jsonData.length; i++) {
                            headers.forEach((header, idx) => {
                                if (jsonData[i][idx] !== undefined) {
                                    data[header].push(jsonData[i][idx]);
                                }
                            });
                        }
                        parsedData = data;
                    } else {
                        throw new Error('ì§€ì›ë˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
                    }
                    
                    currentData = parsedData;
                    const rowCount = Object.values(parsedData)[0]?.length || 0;
                    document.getElementById('fileInfo').textContent = `í¬ê¸°: ${formatFileSize(file.size)} | ${Object.keys(parsedData).length}ê°œ ì—´, ${rowCount}ê°œ í–‰`;
                    
                    // ì„¤ëª… ë°•ìŠ¤ í‘œì‹œ
                    document.getElementById('initialButtons').classList.add('hidden');
                    document.getElementById('step1Explanation').classList.remove('hidden');
                    
                    // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ í™œì„±í™”
                    document.getElementById('proceedBtn1').disabled = false;
                    
                    // ìë™ ì§„í–‰
                    if (autoProgress) {
                        setTimeout(() => proceedToStep2(), 1000);
                    }
                } catch (error) {
                    alert('íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    removeFile();
                }
            };
            
            if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        }
        
        // íŒŒì¼ ì œê±°
        // íŒŒì¼ ì œê±° (í†µí•©ëœ í•¨ìˆ˜)
        function removeFile(resetToStart = false) {
            // ê¸°ë³¸ íŒŒì¼ ì œê±°
            document.getElementById('dropZone').classList.remove('hidden');
            document.getElementById('filePreview').classList.add('hidden');
            document.getElementById('fileInput').value = '';
            currentData = null;
            document.getElementById('proceedBtn1').disabled = true;
            
            // ì™„ì „ ì´ˆê¸°í™” ì˜µì…˜
            if (resetToStart) {
                analysisResults = {};
                document.getElementById('step1Explanation').classList.add('hidden');
                document.getElementById('initialButtons').classList.remove('hidden');
                moveToStep(1);
            }
        }
        
        // ë‹¤ë¥¸ íŒŒì¼ ì„ íƒì„ ìœ„í•œ wrapper
        function clearFileSelection() {
            removeFile(true);
        }
        
        // ì´ì „ ë‹¨ê³„ë¡œ ì´ë™
        function previousStep() {
            if (currentStep > 1) {
                moveToStep(currentStep - 1);
            }
        }
        
        // ë‹¨ê³„ ì´ë™ (ê°œì„ )
        function moveToStep(step, isForwardProgress = false) {
            // í˜„ì¬ ë‹¨ê³„ ìˆ¨ê¸°ê¸°
            const currentContent = document.getElementById(`step${currentStep}Content`);
            if (currentContent) {
                currentContent.classList.add('hidden');
            }
            
            // ìƒˆ ë‹¨ê³„ í‘œì‹œ
            const newContent = document.getElementById(`step${step}Content`);
            if (newContent) {
                newContent.classList.remove('hidden');
                newContent.classList.add('pulse-once');
                setTimeout(() => newContent.classList.remove('pulse-once'), 1000);
            }
            
            // ë‹¨ê³„ ë²ˆí˜¸ ì—…ë°ì´íŠ¸
            for (let i = 1; i <= 6; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (!stepEl) continue;
                
                if (i < step) {
                    stepEl.classList.add('complete');
                    stepEl.classList.remove('inactive');
                } else if (i === step) {
                    stepEl.classList.remove('complete', 'inactive');
                } else {
                    stepEl.classList.add('inactive');
                    stepEl.classList.remove('complete');
                }
            }
            
            const previousStep = currentStep;
            currentStep = step;
            
            // ì´ì „ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            const prevBtn = document.getElementById('prevStepBtn');
            if (prevBtn) {
                prevBtn.disabled = step === 1;
            }
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const progress = ((step - 1) / 5) * 100;
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
            
            // ì•ìœ¼ë¡œ ì§„í–‰í•  ë•Œë§Œ ë°ì´í„° ì²˜ë¦¬ (ë’¤ë¡œ ê°ˆ ë•ŒëŠ” ê¸°ì¡´ ê²°ê³¼ í‘œì‹œ)
            if (!isForwardProgress) {
                // ì´ì „ ë‹¨ê³„ë¡œ ëŒì•„ê°ˆ ë•Œ - ì €ì¥ëœ ê²°ê³¼ê°€ ìˆìœ¼ë©´ í‘œì‹œ
                if (step === 2 && analysisResults.validation) {
                    displayValidationResults(analysisResults.validation);
                } else if (step === 3 && analysisResults.assumptions) {
                    displayAssumptionResults(analysisResults.assumptions);
                } else if (step === 4 && analysisResults.method) {
                    displayMethodRecommendation(analysisResults.method);
                } else if (step === 5 && analysisResults.analysis) {
                    displayAnalysisProgress(analysisResults.analysis);
                } else if (step === 6 && analysisResults.final) {
                    displayResults();
                }
            }
        }
        

        
        // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
        function generateSampleData() {
            currentData = {
                'ê·¸ë£¹A': [23, 25, 27, 22, 24, 26, 28, 25, 24, 23],
                'ê·¸ë£¹B': [31, 33, 35, 32, 34, 36, 38, 35, 34, 33],
                'ê·¸ë£¹C': [42, 44, 46, 43, 45, 47, 49, 46, 45, 44]
            };
            
            // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            document.getElementById('dropZone').classList.add('hidden');
            document.getElementById('filePreview').classList.remove('hidden');
            document.getElementById('fileName').textContent = 'ìƒ˜í”Œ ë°ì´í„°';
            document.getElementById('fileInfo').textContent = '3ê°œ ê·¸ë£¹ | ê° 10ê°œ ê´€ì¸¡ì¹˜';
            
            // ì„¤ëª… ë°•ìŠ¤ í‘œì‹œ
            document.getElementById('initialButtons').classList.add('hidden');
            document.getElementById('step1Explanation').classList.remove('hidden');
            
            // ì„±ê³µ ë©”ì‹œì§€
            const successMsg = document.createElement('div');
            successMsg.className = 'success-box mt-4';
            successMsg.innerHTML = 'âœ… ìƒ˜í”Œ ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!';
            document.getElementById('step1Content').appendChild(successMsg);
            
            setTimeout(() => successMsg.remove(), 3000);
        }
        
        // ì˜¤í”„ë¼ì¸ ë„ì›€ë§
        function showOfflineHelp() {
            alert('ì˜¤í”„ë¼ì¸ ëª¨ë“œì—ì„œëŠ” ì‚¬ì „ì— ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.\nìì„¸í•œ ë‚´ìš©ì€ ë„ì›€ë§ì„ ì°¸ì¡°í•˜ì„¸ìš”.');
        }
        
        // ë„ì›€ë§ í‘œì‹œ (ê°œì„ )
        function showHelp() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-4">ğŸ“– ì‚¬ìš© ê°€ì´ë“œ</h2>
                    
                    <div class="space-y-4 text-sm">
                        <div class="border-l-4 border-blue-500 pl-4">
                            <h3 class="font-semibold text-blue-700 mb-2">ğŸš€ ì‹œì‘í•˜ê¸°</h3>
                            <p>1. <strong>ë°ì´í„° ì—…ë¡œë“œ</strong>: CSV ë˜ëŠ” Excel íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ìƒ˜í”Œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</p>
                            <p>2. <strong>ë°ì´í„° ê²€ì¦</strong>: ì—…ë¡œë“œëœ ë°ì´í„°ì˜ í’ˆì§ˆì„ ìë™ìœ¼ë¡œ ê²€ì‚¬í•©ë‹ˆë‹¤.</p>
                            <p>3. <strong>ë¶„ì„ ì‹¤í–‰</strong>: ë°ì´í„° íŠ¹ì„±ì— ë§ëŠ” í†µê³„ ë¶„ì„ì„ ì¶”ì²œë°›ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
                        </div>
                        
                        <div class="border-l-4 border-green-500 pl-4">
                            <h3 class="font-semibold text-green-700 mb-2">ğŸ“Š ì§€ì›í•˜ëŠ” ë¶„ì„</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>t-ê²€ì •</strong>: ë‘ ê·¸ë£¹ ê°„ í‰ê·  ì°¨ì´ ë¹„êµ</li>
                                <li><strong>ë¶„ì‚°ë¶„ì„(ANOVA)</strong>: ì„¸ ê°œ ì´ìƒ ê·¸ë£¹ ê°„ ì°¨ì´ ë¹„êµ</li>
                                <li><strong>ìƒê´€ë¶„ì„</strong>: ë³€ìˆ˜ ê°„ ê´€ê³„ ë¶„ì„</li>
                                <li><strong>ê¸°ìˆ í†µê³„</strong>: í‰ê· , í‘œì¤€í¸ì°¨ ë“± ê¸°ë³¸ í†µê³„</li>
                            </ul>
                        </div>
                        
                        <div class="border-l-4 border-orange-500 pl-4">
                            <h3 class="font-semibold text-orange-700 mb-2">ğŸ’¡ íŒ</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>ë°ì´í„° ì²« ë²ˆì§¸ í–‰ì€ <strong>ë³€ìˆ˜ëª…(í—¤ë”)</strong>ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤</li>
                                <li><strong>ìˆ«ì ë°ì´í„°</strong>ëŠ” ì—°ì†í˜• ë³€ìˆ˜ë¡œ, <strong>í…ìŠ¤íŠ¸ ë°ì´í„°</strong>ëŠ” ê·¸ë£¹ ë³€ìˆ˜ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤</li>
                                <li>ê²°ì¸¡ì¹˜ê°€ ë§ìœ¼ë©´ ë¶„ì„ ì •í™•ë„ê°€ ë‚®ì•„ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                <li>ìë™ ì§„í–‰ ëª¨ë“œë¥¼ ì²´í¬í•˜ë©´ ë‹¨ê³„ë³„ë¡œ ìë™ ì§„í–‰ë©ë‹ˆë‹¤</li>
                            </ul>
                        </div>
                        
                        <div class="border-l-4 border-red-500 pl-4">
                            <h3 class="font-semibold text-red-700 mb-2">âš ï¸ ì£¼ì˜ì‚¬í•­</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li>íŒŒì¼ í¬ê¸°ëŠ” <strong>10MB ì´í•˜</strong>ë¡œ ì œí•œë©ë‹ˆë‹¤</li>
                                <li>ì²˜ìŒ ë¡œë”© ì‹œ í†µê³„ ì—”ì§„ ì´ˆê¸°í™”ì— <strong>30ì´ˆ~1ë¶„</strong> ì†Œìš”ë©ë‹ˆë‹¤</li>
                                <li>ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤</li>
                            </ul>
                        </div>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" class="btn-primary mt-6 w-full">
                        í™•ì¸
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            initPyodide();
            
            // ìë™ ì§„í–‰ ì²´í¬ë°•ìŠ¤
            document.getElementById('autoProgress').addEventListener('change', (e) => {
                autoProgress = e.target.checked;
                if (autoProgress) {
                    showTooltip({clientX: e.target.offsetLeft, clientY: e.target.offsetTop}, 'ì´ì œ ê° ë‹¨ê³„ê°€ ìë™ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤');
                    setTimeout(hideTooltip, 2000);
                }
            });
        });
        
        // í†µí•©ëœ ë‹¨ê³„ ì§„í–‰ í•¨ìˆ˜
        function proceedToStep(step) {
            moveToStep(step, true);
            
            if (!currentData) return;
            
            // ê° ë‹¨ê³„ë³„ ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
            console.log(`proceedToStep - ë‹¨ê³„ ${step} ì‹¤í–‰`);
            switch(step) {
                case 2: 
                    console.log('validateData() í˜¸ì¶œ ì‹œì‘');
                    validateData(); 
                    break;
                case 3: testAssumptions(); break;
                case 4: recommendMethod(); break;
                case 5: runAnalysis(); break;
            }
        }
        
        // ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€ (í•˜ìœ„ í˜¸í™˜ì„±)
        function proceedToStep2() { proceedToStep(2); }
        function proceedToStep3() { proceedToStep(3); }
        function proceedToStep4() { proceedToStep(4); }
        function proceedToStep5() { proceedToStep(5); }
        
        // ë°ì´í„° ê²€ì¦
        async function validateData(force = false) {
            console.log('validateData í˜¸ì¶œë¨', { force, currentData: !!currentData, dataKeys: currentData ? Object.keys(currentData) : null, pyodide: !!pyodide });
            
            if (!currentData) {
                document.getElementById('dataValidation').innerHTML = 
                    '<div class="warning-box">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            
            // ì´ë¯¸ ê²€ì¦ ê²°ê³¼ê°€ ìˆê³  ê°•ì œ ì¬ê²€ì¦ì´ ì•„ë‹ˆë©´ ê¸°ì¡´ ê²°ê³¼ í‘œì‹œ
            if (analysisResults.validation && !force) {
                displayValidationResults(analysisResults.validation);
                return;
            }
            
            // Pyodide ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ JavaScript ìƒì„¸ ê²€ì¦ ìˆ˜í–‰
            console.log('JavaScript ìƒì„¸ ê²€ì¦ ìˆ˜í–‰');
            document.getElementById('dataValidation').innerHTML = 
                '<div class="info-box">ê²€ì¦ ì¤‘ì…ë‹ˆë‹¤...</div>';
            
            // JavaScriptë¡œ ìƒì„¸ ê²€ì¦ ìˆ˜í–‰
            setTimeout(() => performBasicValidation(), 100);
        }
        
        // ê²€ì¦ ê²°ê³¼ ì¬í‘œì‹œ
        function displayValidationResults(validation) {
            document.getElementById('rowCount').textContent = validation.rows;
            document.getElementById('colCount').textContent = validation.columns;
            
            if (validation.tableData) {
                document.getElementById('tableHeader').innerHTML = 
                    validation.tableData.headers.map(h => 
                        `<th class="px-4 py-2 text-left font-medium text-gray-700">${h}</th>`
                    ).join('');
                document.getElementById('tableBody').innerHTML = validation.tableData.body;
            }
            
            let validationHtml = '';
            if (validation.valid) {
                validationHtml = '<div class="success-box">âœ… ë°ì´í„° ê²€ì¦ ì™„ë£Œ: ë¬¸ì œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>';
            } else {
                validationHtml = '<div class="warning-box">âš ï¸ ë°ì´í„° ë¬¸ì œ ë°œê²¬:<ul class="mt-2">';
                validation.issues.forEach(issue => {
                    validationHtml += `<li>â€¢ ${issue}</li>`;
                });
                validationHtml += '</ul></div>';
            }
            document.getElementById('dataValidation').innerHTML = validationHtml;
            
            // ì„¤ëª… ë°•ìŠ¤ í‘œì‹œ
            document.getElementById('step2Explanation').classList.remove('hidden');
            
            // ìë™ ì§„í–‰ (ì˜µì…˜ì´ ì¼œì ¸ìˆëŠ” ê²½ìš°)
            if (autoProgress) {
                setTimeout(() => proceedToStep3(), 2000);
            }
        }
        
        // JavaScript ê¸°ë³¸ ê²€ì¦ í•¨ìˆ˜
        function performBasicValidation() {
            console.log('performBasicValidation ì‹œì‘ë¨');
            if (!currentData) {
                console.log('currentDataê°€ ì—†ìŒ');
                return;
            }
            
            const columns = Object.keys(currentData);
            const rows = currentData[columns[0]]?.length || 0;
            console.log('ë°ì´í„° êµ¬ì¡°:', { rows, columns: columns.length });
            
            // ë°ì´í„° ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸ (ê¸°ë³¸ ë°ì´í„° ì •ë³´)
            document.getElementById('rowCount').textContent = rows;
            document.getElementById('colCount').textContent = columns.length;
            
            // í…Œì´ë¸” í‘œì‹œ (ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°)
            const headerHtml = columns.map(col => 
                `<th class="px-4 py-2 text-left font-medium text-gray-700">${col}</th>`
            ).join('');
            document.getElementById('tableHeader').innerHTML = headerHtml;
            
            let bodyHtml = '';
            for (let i = 0; i < Math.min(5, rows); i++) {
                bodyHtml += '<tr>';
                columns.forEach(col => {
                    bodyHtml += `<td class="px-4 py-2">${currentData[col][i] || ''}</td>`;
                });
                bodyHtml += '</tr>';
            }
            
            if (rows > 5) {
                bodyHtml += `<tr><td colspan="${columns.length}" class="px-4 py-2 text-center text-gray-500">... ${rows - 5}ê°œ í–‰ ë” ìˆìŒ ...</td></tr>`;
            }
            
            document.getElementById('tableBody').innerHTML = bodyHtml;
            
            // í†µê³„ ë¶„ì„ìš© ìƒì„¸ ê²€ì¦ ìˆ˜í–‰
            let issues = [];
            let validationDetails = [];
            let numericColumns = [];
            let textColumns = [];
            let groupColumns = [];
            let analysisRecommendations = [];
            
            for (let col of columns) {
                const values = currentData[col] || [];
                const validValues = values.filter(v => v != null && v !== '' && v !== undefined);
                
                // ê²°ì¸¡ì¹˜ í™•ì¸
                const nullCount = values.length - validValues.length;
                if (nullCount > 0) {
                    if (nullCount / values.length > 0.2) {
                        issues.push(`${col}: ê²°ì¸¡ì¹˜ê°€ 20% ì´ìƒ (${nullCount}ê°œ)`);
                    } else {
                        validationDetails.push(`${col}: ê²°ì¸¡ì¹˜ ${nullCount}ê°œ (${(nullCount/values.length*100).toFixed(1)}%)`);
                    }
                }
                
                // ë°ì´í„° íƒ€ì… ë° í†µê³„ì  íŠ¹ì„± ë¶„ì„
                const numericValues = validValues.filter(v => !isNaN(parseFloat(v)) && isFinite(v));
                const numericRatio = validValues.length > 0 ? (numericValues.length / validValues.length) : 0;
                
                if (numericRatio >= 0.8 && numericValues.length >= 3) {
                    numericColumns.push(col);
                    const nums = numericValues.map(v => parseFloat(v));
                    const min = Math.min(...nums);
                    const max = Math.max(...nums);
                    const mean = nums.reduce((a, b) => a + b, 0) / nums.length;
                    const variance = nums.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / (nums.length - 1);
                    const std = Math.sqrt(variance);
                    
                    // ë¶„í¬ íŠ¹ì„± í™•ì¸
                    const range = max - min;
                    const cv = std / mean; // ë³€ë™ê³„ìˆ˜
                    
                    validationDetails.push(`${col}: ì—°ì†í˜• ë³€ìˆ˜ (N=${nums.length}, í‰ê· =${mean.toFixed(2)}, í‘œì¤€í¸ì°¨=${std.toFixed(2)}, ë²”ìœ„=${min.toFixed(2)}~${max.toFixed(2)})`);
                    
                    // ì´ìƒì¹˜ í™•ì¸ (IQR ë°©ë²•)
                    const sorted = nums.sort((a, b) => a - b);
                    const q1 = sorted[Math.floor(sorted.length * 0.25)];
                    const q3 = sorted[Math.floor(sorted.length * 0.75)];
                    const iqr = q3 - q1;
                    const outliers = nums.filter(v => v < q1 - 1.5 * iqr || v > q3 + 1.5 * iqr);
                    
                    if (outliers.length > 0) {
                        validationDetails.push(`  â”” ì ì¬ì  ì´ìƒì¹˜ ${outliers.length}ê°œ ë°œê²¬`);
                    }
                    
                } else {
                    const uniqueValues = [...new Set(validValues)];
                    const isGroupVariable = uniqueValues.length >= 2 && uniqueValues.length <= Math.max(10, values.length * 0.5);
                    
                    if (isGroupVariable) {
                        groupColumns.push(col);
                        validationDetails.push(`${col}: ê·¸ë£¹ ë³€ìˆ˜ (${uniqueValues.length}ê°œ ê·¸ë£¹: ${uniqueValues.slice(0, 5).join(', ')}${uniqueValues.length > 5 ? '...' : ''})`);
                        
                        // ê·¸ë£¹ë³„ ê°œìˆ˜ í™•ì¸
                        const groupCounts = {};
                        validValues.forEach(v => groupCounts[v] = (groupCounts[v] || 0) + 1);
                        const minGroupSize = Math.min(...Object.values(groupCounts));
                        const maxGroupSize = Math.max(...Object.values(groupCounts));
                        
                        validationDetails.push(`  â”” ê·¸ë£¹ í¬ê¸°: ${minGroupSize}~${maxGroupSize}ê°œ`);
                        
                        if (minGroupSize < 3) {
                            issues.push(`${col}: ì¼ë¶€ ê·¸ë£¹ì˜ í¬ê¸°ê°€ ë„ˆë¬´ ì‘ìŒ (ìµœì†Œ ${minGroupSize}ê°œ)`);
                        }
                    } else {
                        textColumns.push(col);
                        validationDetails.push(`${col}: í…ìŠ¤íŠ¸/ID ë³€ìˆ˜ (${uniqueValues.length}ê°œ ê³ ìœ ê°’)`);
                    }
                }
            }
            
            // ë°ì´í„° íŠ¹ì„± ê¸°ë°˜ í†µê³„ ë¶„ì„ ì¶”ì²œ
            let primaryRecommendation = "";
            
            // 1. ê·¸ë£¹ ë¹„êµ ë¶„ì„ (ê°€ì¥ ì¼ë°˜ì )
            if (numericColumns.length >= 1 && groupColumns.length >= 1) {
                const dependentVar = numericColumns[0];
                
                // ì—¬ëŸ¬ ê·¸ë£¹ ë³€ìˆ˜ê°€ ìˆëŠ” ê²½ìš° (ì´ì›/ë‹¤ì› ë¶„ì‚°ë¶„ì„)
                if (groupColumns.length >= 2) {
                    const factorInfo = groupColumns.map(col => {
                        const uniqueGroups = [...new Set(currentData[col])];
                        return `${col}(${uniqueGroups.length}ìˆ˜ì¤€)`;
                    });
                    
                    primaryRecommendation = `ğŸ¯ ì¶”ì²œ: "${dependentVar}"ì— ëŒ€í•œ ${factorInfo.join(' Ã— ')} ${groupColumns.length}ì›ë¶„ì‚°ë¶„ì„`;
                    
                    if (groupColumns.length === 2) {
                        analysisRecommendations.push("ì´ì›ë¶„ì‚°ë¶„ì„(Two-way ANOVA) â†’ ì£¼íš¨ê³¼ ë° ìƒí˜¸ì‘ìš© íš¨ê³¼ ê²€ì •");
                        analysisRecommendations.push("ì‚¬í›„ë¶„ì„ â†’ ë‹¨ìˆœ ì£¼íš¨ê³¼ ë¶„ì„ ë˜ëŠ” ë‹¤ì¤‘ë¹„êµ");
                    } else {
                        analysisRecommendations.push(`ë‹¤ì›ë¶„ì‚°ë¶„ì„(${groupColumns.length}-way ANOVA) â†’ ì£¼íš¨ê³¼ ë° ìƒí˜¸ì‘ìš© ê²€ì •`);
                        analysisRecommendations.push("ë³µì¡í•œ ìƒí˜¸ì‘ìš© í•´ì„ í•„ìš”");
                    }
                }
                // ë‹¨ì¼ ê·¸ë£¹ ë³€ìˆ˜ì¸ ê²½ìš° (ì¼ì›ë¶„ì‚°ë¶„ì„)
                else {
                    const groupCol = groupColumns[0];
                    const uniqueGroups = [...new Set(currentData[groupCol])];
                    
                    console.log('ê·¸ë£¹ ë¶„ì„:', {
                        groupCol,
                        uniqueGroups,
                        groupCount: uniqueGroups.length,
                        dependentVar
                    });
                    
                    if (uniqueGroups.length === 2) {
                        primaryRecommendation = `ğŸ¯ ì¶”ì²œ: "${dependentVar}" ë³€ìˆ˜ì— ëŒ€í•œ "${groupCol}" ê·¸ë£¹(${uniqueGroups.join(', ')}) ê°„ ì°¨ì´ ê²€ì • (ë…ë¦½ t-ê²€ì •)`;
                        analysisRecommendations.push("ë…ë¦½ t-ê²€ì • â†’ ì •ê·œì„± í™•ì¸ í›„ t-test ë˜ëŠ” Mann-Whitney U ê²€ì •");
                    } else if (uniqueGroups.length >= 3) {
                        primaryRecommendation = `ğŸ¯ ì¶”ì²œ: "${dependentVar}" ë³€ìˆ˜ì— ëŒ€í•œ "${groupCol}" ${uniqueGroups.length}ê°œ ê·¸ë£¹ ê°„ ì°¨ì´ ë¶„ì„ (ì¼ì›ë¶„ì‚°ë¶„ì„)`;
                        analysisRecommendations.push("ì¼ì›ë¶„ì‚°ë¶„ì„(ANOVA) â†’ ì •ê·œì„±Â·ë“±ë¶„ì‚°ì„± í™•ì¸ í›„ ANOVA ë˜ëŠ” Kruskal-Wallis");
                    }
                }
                
                if (numericColumns.length >= 2) {
                    analysisRecommendations.push("ì¶”ê°€ ë¶„ì„: ê·¸ë£¹ë³„ ìƒê´€ë¶„ì„ ë˜ëŠ” ë‹¤ë³€ëŸ‰ë¶„ì„ ê°€ëŠ¥");
                }
            }
            
            // 2. ìƒê´€/íšŒê·€ ë¶„ì„
            else if (numericColumns.length >= 2) {
                primaryRecommendation = `ğŸ¯ ì¶”ì²œ: "${numericColumns.slice(0,2).join('" ê³¼ "')}" ê°„ ê´€ê³„ ë¶„ì„ (ìƒê´€ë¶„ì„/íšŒê·€ë¶„ì„)`;
                analysisRecommendations.push("ìƒê´€ë¶„ì„ â†’ Pearson ë˜ëŠ” Spearman ìƒê´€ê³„ìˆ˜");
                analysisRecommendations.push("íšŒê·€ë¶„ì„ â†’ ë‹¨ìˆœ/ë‹¤ì¤‘ ì„ í˜•íšŒê·€ ë˜ëŠ” ë¹„ì„ í˜•íšŒê·€");
            }
            
            // 3. ê¸°ìˆ í†µê³„ë§Œ ê°€ëŠ¥
            else if (numericColumns.length >= 1) {
                primaryRecommendation = `ğŸ“Š ê¸°ë³¸ ë¶„ì„: "${numericColumns[0]}" ë³€ìˆ˜ì˜ ê¸°ìˆ í†µê³„ ë° ë¶„í¬ ë¶„ì„`;
                analysisRecommendations.push("ê¸°ìˆ í†µê³„ â†’ í‰ê· , í‘œì¤€í¸ì°¨, ë¶„ìœ„ìˆ˜, íˆìŠ¤í† ê·¸ë¨");
                analysisRecommendations.push("ì •ê·œì„± ê²€ì • â†’ Shapiro-Wilk ë˜ëŠ” Kolmogorov-Smirnov");
            }
            
            // 4. ë²”ì£¼í˜• ë°ì´í„° ë¶„ì„
            else if (groupColumns.length >= 2) {
                primaryRecommendation = `ğŸ“‹ ë²”ì£¼í˜• ë¶„ì„: "${groupColumns.slice(0,2).join('" ê³¼ "')}" ê°„ ì—°ê´€ì„± ë¶„ì„`;
                analysisRecommendations.push("ì¹´ì´ì œê³± ê²€ì • â†’ ë²”ì£¼í˜• ë³€ìˆ˜ ê°„ ë…ë¦½ì„± ê²€ì •");
            }
            
            // 5. ë¶„ì„ ë¶ˆê°€
            else {
                primaryRecommendation = "âš ï¸ í˜„ì¬ ë°ì´í„°ë¡œëŠ” í†µê³„ì  ì¶”ë¡ ì´ ì œí•œì ì…ë‹ˆë‹¤";
                analysisRecommendations.push("ë°ì´í„° ì „ì²˜ë¦¬ ë˜ëŠ” ì¶”ê°€ ë°ì´í„° ìˆ˜ì§‘ì„ ê¶Œì¥í•©ë‹ˆë‹¤");
            }
            
            // ì¶”ê°€ ì¼ë°˜ì  ë¶„ì„
            if (numericColumns.length >= 1) {
                analysisRecommendations.push("íƒìƒ‰ì  ë°ì´í„° ë¶„ì„(EDA) â†’ ë¶„í¬, ì´ìƒì¹˜, íŒ¨í„´ í™•ì¸");
            }
            
            let validationHtml = '';
            if (issues.length === 0) {
                validationHtml = `
                    <div class="success-box">
                        <h4 class="font-semibold mb-2">âœ… ë°ì´í„° ê²€ì¦ ì™„ë£Œ</h4>
                        <div class="text-sm space-y-2">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p><strong>ğŸ“Š ë°ì´í„° êµ¬ì¡°:</strong></p>
                                    <ul class="ml-4 text-xs space-y-1">
                                        <li>â€¢ ì „ì²´: ${rows}ê°œ í–‰, ${columns.length}ê°œ ì—´</li>
                                        <li>â€¢ ì—°ì†í˜• ë³€ìˆ˜: ${numericColumns.length}ê°œ${numericColumns.length > 0 ? ' (' + numericColumns.join(', ') + ')' : ''}</li>
                                        <li>â€¢ ê·¸ë£¹ ë³€ìˆ˜: ${groupColumns.length}ê°œ${groupColumns.length > 0 ? ' (' + groupColumns.join(', ') + ')' : ''}</li>
                                        <li>â€¢ ê¸°íƒ€ ë³€ìˆ˜: ${textColumns.length}ê°œ${textColumns.length > 0 ? ' (' + textColumns.join(', ') + ')' : ''}</li>
                                    </ul>
                                </div>
                                <div>
                                    <p><strong>ğŸ” ë¶„ì„ ì¶”ì²œ:</strong></p>
                                    ${primaryRecommendation ? `<div class="bg-blue-100 p-2 rounded mb-2 text-xs"><strong>${primaryRecommendation}</strong></div>` : ''}
                                    <ul class="ml-4 text-xs space-y-1">
                                        ${analysisRecommendations.map(rec => `<li>â€¢ ${rec}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <details class="mt-3">
                            <summary class="cursor-pointer text-sm font-medium">ğŸ“‹ ìƒì„¸ ë³€ìˆ˜ ì •ë³´ ë³´ê¸°</summary>
                            <ul class="mt-2 text-xs space-y-1 ml-4">
                                ${validationDetails.map(detail => `<li>${detail}</li>`).join('')}
                            </ul>
                        </details>
                    </div>
                `;
            } else {
                validationHtml = `
                    <div class="warning-box">
                        <h4 class="font-semibold mb-2">âš ï¸ ë°ì´í„° í’ˆì§ˆ ë¬¸ì œ ë°œê²¬</h4>
                        <div class="bg-red-50 p-3 rounded mb-3">
                            <p class="text-sm font-medium mb-2">í•´ê²° í•„ìš”í•œ ë¬¸ì œ:</p>
                            <ul class="text-sm space-y-1">
                                ${issues.map(issue => `<li>â€¢ ${issue}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="text-sm space-y-2">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p><strong>ğŸ“Š í˜„ì¬ ë°ì´í„° êµ¬ì¡°:</strong></p>
                                    <ul class="ml-4 text-xs space-y-1">
                                        <li>â€¢ ì „ì²´: ${rows}ê°œ í–‰, ${columns.length}ê°œ ì—´</li>
                                        <li>â€¢ ì—°ì†í˜• ë³€ìˆ˜: ${numericColumns.length}ê°œ</li>
                                        <li>â€¢ ê·¸ë£¹ ë³€ìˆ˜: ${groupColumns.length}ê°œ</li>
                                    </ul>
                                </div>
                                <div>
                                    <p><strong>ğŸ” ë¶„ì„ ì¶”ì²œ:</strong></p>
                                    ${primaryRecommendation ? `<div class="bg-yellow-100 p-2 rounded mb-2 text-xs"><strong>${primaryRecommendation}</strong></div>` : ''}
                                    <ul class="ml-4 text-xs space-y-1">
                                        ${analysisRecommendations.map(rec => `<li>â€¢ ${rec}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <details class="mt-3">
                            <summary class="cursor-pointer text-sm font-medium">ğŸ“‹ ìƒì„¸ ë³€ìˆ˜ ì •ë³´ ë³´ê¸°</summary>
                            <ul class="mt-2 text-xs space-y-1 ml-4">
                                ${validationDetails.map(detail => `<li>${detail}</li>`).join('')}
                            </ul>
                        </details>
                    </div>
                `;
            }
            
            // ê²€ì¦ ìƒíƒœ ë°•ìŠ¤ì— ë” ìƒì„¸í•œ ì •ë³´ í‘œì‹œ
            let simpleValidationHtml = '';
            
            // ì´ìƒì¹˜ì™€ ê²°ì¸¡ì¹˜ ìš”ì•½
            let outlierInfo = '';
            let missingInfo = '';
            
            for (const col of columns) {
                const values = currentData[col];
                const missingCount = values.filter(v => v === null || v === '' || v === undefined).length;
                if (missingCount > 0) {
                    if (!missingInfo) missingInfo = 'ê²°ì¸¡ì¹˜: ';
                    missingInfo += `${col}(${missingCount}ê°œ) `;
                }
            }
            
            // ì´ìƒì¹˜ ì •ë³´ëŠ” validationDetailsì—ì„œ ì¶”ì¶œ
            const outlierLines = validationDetails.filter(d => d.includes('ì´ìƒì¹˜'));
            if (outlierLines.length > 0) {
                outlierInfo = outlierLines.join(', ');
            }
            
            if (issues.length === 0) {
                simpleValidationHtml = `
                    <div class="text-green-600 text-sm">
                        <div class="font-medium">âœ… í’ˆì§ˆ ê²€ì‚¬ í†µê³¼</div>
                        <div class="text-xs mt-1 space-y-1">
                            <div>â€¢ ë°ì´í„°: ${rows}ê°œ í–‰, ${columns.length}ê°œ ì—´</div>
                            <div>â€¢ ë³€ìˆ˜: ${numericColumns.length}ê°œ ì—°ì†í˜•, ${groupColumns.length}ê°œ ê·¸ë£¹í˜•</div>
                            ${missingInfo ? `<div class="text-yellow-600">â€¢ ${missingInfo}</div>` : '<div>â€¢ ê²°ì¸¡ì¹˜ ì—†ìŒ</div>'}
                            ${outlierInfo ? `<div class="text-orange-600">â€¢ ${outlierInfo}</div>` : '<div>â€¢ ì´ìƒì¹˜ ì—†ìŒ</div>'}
                        </div>
                    </div>
                `;
            } else {
                simpleValidationHtml = `
                    <div class="text-orange-600 text-sm">
                        <div class="font-medium">âš ï¸ ${issues.length}ê°œ ë¬¸ì œ ë°œê²¬</div>
                        <div class="text-xs mt-1 space-y-1">
                            ${issues.slice(0, 3).map(issue => `<div>â€¢ ${issue}</div>`).join('')}
                            ${issues.length > 3 ? '<div>â€¢ ...</div>' : ''}
                            ${missingInfo ? `<div>â€¢ ${missingInfo}</div>` : ''}
                            ${outlierInfo ? `<div>â€¢ ${outlierInfo}</div>` : ''}
                        </div>
                    </div>
                `;
            }
            
            console.log('dataValidation ì—…ë°ì´íŠ¸:', simpleValidationHtml);
            const validationElement = document.getElementById('dataValidation');
            if (validationElement) {
                validationElement.innerHTML = simpleValidationHtml;
                console.log('dataValidation ì—…ë°ì´íŠ¸ ì„±ê³µ');
            } else {
                console.error('dataValidation ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ìƒì„¸ ê²°ê³¼ë¥¼ ë³„ë„ ì˜ì—­ì— í‘œì‹œ
            const detailedResults = document.getElementById('step2DetailedResults');
            const detailedContent = document.getElementById('detailedValidationContent');
            
            if (detailedResults) {
                detailedResults.classList.remove('hidden');
                console.log('step2DetailedResults í‘œì‹œë¨');
            } else {
                console.error('step2DetailedResults ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            if (detailedContent) {
                detailedContent.innerHTML = validationHtml;
                console.log('detailedValidationContent ì—…ë°ì´íŠ¸ë¨');
            } else {
                console.error('detailedValidationContent ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            // ê²°ê³¼ ì €ì¥
            analysisResults.validation = {
                rows: rows,
                columns: columns.length,
                valid: issues.length === 0,
                issues: issues,
                numericColumns: numericColumns,
                groupColumns: groupColumns,  // ê·¸ë£¹ ë³€ìˆ˜ ì¶”ê°€
                textColumns: textColumns,
                details: validationDetails,
                primaryRecommendation: primaryRecommendation,
                analysisRecommendations: analysisRecommendations
            };
            
            // UI ìš”ì†Œë“¤ í‘œì‹œ ë° í™œì„±í™” (ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‚¬ìš©)
            console.log('UI ìš”ì†Œ í‘œì‹œ ì‹œì‘');
            showElement('step2Explanation');
            showElement('step2NextButton');
            console.log('step2NextButton í‘œì‹œ ì™„ë£Œ');
            enableButton('#step2NextButton button');
            enableButton('#step2Explanation button[onclick="proceedToStep3()"]');
            console.log('ë²„íŠ¼ í™œì„±í™” ì™„ë£Œ');
            
            // ìë™ ì§„í–‰ (ê²€ì¦ ì„±ê³µ ì‹œ)
            console.log('ìë™ ì§„í–‰ ì²´í¬:', { autoProgress, issues: issues.length });
            if (autoProgress && issues.length === 0) {
                console.log('ìë™ ì§„í–‰ ì‹œì‘ - 3ì´ˆ í›„ ë‹¤ìŒ ë‹¨ê³„ë¡œ');
                // ì„±ê³µ ë©”ì‹œì§€ì™€ í•¨ê»˜ ìë™ ì§„í–‰ ì˜ˆê³ 
                const countdownEl = document.createElement('div');
                countdownEl.className = 'mt-2 text-center text-sm text-blue-600';
                countdownEl.innerHTML = 'â±ï¸ 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë©ë‹ˆë‹¤...';
                
                const validationElement = document.getElementById('dataValidation');
                if (validationElement) {
                    validationElement.appendChild(countdownEl);
                } else {
                    console.error('dataValidation ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ ìë™ ì§„í–‰ ë©”ì‹œì§€ ì¶”ê°€ ì‹¤íŒ¨');
                }
                
                setTimeout(() => {
                    console.log('ìë™ ì§„í–‰ ì‹¤í–‰ - proceedToStep3() í˜¸ì¶œ');
                    if (countdownEl.parentNode) countdownEl.remove();
                    proceedToStep3();
                }, 3000);
            }
        }

        // ì¬ê²€ì¦ í•¨ìˆ˜
        function revalidateData() {
            analysisResults.validation = null;
            validateData(true);
        }
        
        // ë””ë²„ê·¸: ê²€ì¦ ìƒíƒœ ê°•ì œ í‘œì‹œ í•¨ìˆ˜
        function testValidationDisplay() {
            console.log('testValidationDisplay í˜¸ì¶œë¨');
            const validationElement = document.getElementById('dataValidation');
            if (validationElement) {
                validationElement.innerHTML = '<div class="text-green-600 text-sm"><div class="font-medium">âœ… í…ŒìŠ¤íŠ¸ ê²€ì¦ í‘œì‹œ</div></div>';
                console.log('ê²€ì¦ ìƒíƒœ ê°•ì œ í‘œì‹œ ì„±ê³µ');
            } else {
                console.error('dataValidation ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
        }
        
        // ë””ë²„ê·¸: ê°•ì œ ê²€ì¦ ì‹¤í–‰
        function forceValidation() {
            console.log('=== ê°•ì œ ê²€ì¦ ì‹œì‘ ===');
            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„¤ì •
            currentData = {
                'ê·¸ë£¹': ['A', 'A', 'A', 'B', 'B', 'B'],
                'ê°’': [10, 12, 14, 15, 17, 19]
            };
            console.log('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„¤ì • ì™„ë£Œ');
            
            // 2ë‹¨ê³„ë¡œ ì´ë™
            moveToStep(2);
            console.log('2ë‹¨ê³„ë¡œ ì´ë™ ì™„ë£Œ');
            
            // ê²€ì¦ ì‹¤í–‰
            validateData(true);
            console.log('validateData í˜¸ì¶œ ì™„ë£Œ');
        }
        
        // ê°€ì • ê²€ì • (ì‹¤ì œ SciPy ì‚¬ìš©)
        async function testAssumptions() {
            // ì´ë¯¸ ê²°ê³¼ê°€ ìˆìœ¼ë©´ í‘œì‹œë§Œ
            if (analysisResults.assumptions) {
                displayAssumptionResults(analysisResults.assumptions);
                return;
            }
            
            if (!currentData || !analysisResults.validation) {
                alert('ë¨¼ì € ë°ì´í„°ë¥¼ ê²€ì¦í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ìƒˆë¡œ ë¶„ì„
            document.getElementById('normalityResults').innerHTML = '<p class="text-gray-600">ì •ê·œì„± ê²€ì • ì¤‘...</p>';
            document.getElementById('homogeneityResults').innerHTML = '<p class="text-gray-600">ë“±ë¶„ì‚°ì„± ê²€ì • ì¤‘...</p>';
            
            // ê²€ì •í•  ë³€ìˆ˜ë“¤ ì°¾ê¸° (validationì—ì„œ ì €ì¥ëœ ë³€ìˆ˜ ì‚¬ìš©)
            const numericColumns = analysisResults.validation.numericColumns || [];
            let groupColumns = analysisResults.validation.groupColumns || [];
            
            // groupColumnsê°€ ì •ì˜ë˜ì§€ ì•Šì€ ê²½ìš° ë‹¤ì‹œ ì°¾ê¸°
            if (!groupColumns || groupColumns.length === 0) {
                groupColumns = [];
                const columns = Object.keys(currentData);
                for (const col of columns) {
                    const values = currentData[col];
                    const validValues = values.filter(v => v !== null && v !== '' && v !== undefined);
                    const numericValues = validValues.filter(v => !isNaN(Number(v)));
                    
                    // ìˆ«ìê°€ ì•„ë‹Œ ê°’ì´ ë§ê³ , ê³ ìœ ê°’ì´ ì ë‹¹í•œ ê²½ìš° ê·¸ë£¹ ë³€ìˆ˜ë¡œ íŒë‹¨
                    if (numericValues.length < validValues.length * 0.8) {
                        const uniqueValues = [...new Set(validValues)];
                        if (uniqueValues.length >= 2 && uniqueValues.length <= Math.max(10, values.length * 0.5)) {
                            groupColumns.push(col);
                        }
                    }
                }
            }
            
            // Pyodide ì²´í¬
            if (!window.pyodide) {
                alert('í†µê³„ ì—”ì§„ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì •ê·œì„± ê²€ì • ìˆ˜í–‰ (ì‹¤ì œ SciPy ì‚¬ìš©)
            const normalityResults = [];
            const homogeneityResults = [];
            
            try {
                // 1. ì •ê·œì„± ê²€ì • - ê° ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì— ëŒ€í•´
                for (const col of numericColumns) {
                    const values = currentData[col].filter(v => !isNaN(Number(v)) && v !== '');
                    const nums = values.map(v => parseFloat(v));
                    
                    if (nums.length < 3) {
                        normalityResults.push({
                            variable: col,
                            test: 'N/A',
                            statistic: null,
                            pValue: null,
                            isNormal: false,
                            interpretation: 'í‘œë³¸ ìˆ˜ ë¶€ì¡± (n < 3)',
                            sampleSize: nums.length
                        });
                        continue;
                    }
                    
                    // Pythonìœ¼ë¡œ ì •ê·œì„± ê²€ì • ì‹¤í–‰
                    pyodide.globals.set('test_values', nums);
                    const result = await pyodide.runPythonAsync(`
                        result = test_normality(test_values)
                        result
                    `);
                    
                    const normResult = result.toJs();
                    
                    normalityResults.push({
                        variable: col,
                        test: normResult.get('test'),
                        statistic: normResult.get('statistic'),
                        pValue: normResult.get('pValue'),
                        isNormal: normResult.get('isNormal'),
                        skewness: normResult.get('skewness'),
                        kurtosis: normResult.get('kurtosis'),
                        sampleSize: normResult.get('n'),
                        interpretation: normResult.get('isNormal') ? 
                            `ì •ê·œë¶„í¬ë¥¼ ë”°ë¦„ (${normResult.get('test')}, p = ${normResult.get('pValue')?.toFixed(3)} > 0.05)` : 
                            `ì •ê·œë¶„í¬ë¥¼ ë”°ë¥´ì§€ ì•ŠìŒ (${normResult.get('test')}, p = ${normResult.get('pValue')?.toFixed(3)} < 0.05)`,
                        recommendation: !normResult.get('isNormal') ? 
                            'ë¹„ëª¨ìˆ˜ ê²€ì • ë˜ëŠ” ë°ì´í„° ë³€í™˜ì„ ê³ ë ¤í•˜ì„¸ìš”' : 
                            'ëª¨ìˆ˜ ê²€ì • ì‚¬ìš© ê°€ëŠ¥'
                    });
                }
                
                // 2. ë“±ë¶„ì‚°ì„± ê²€ì • - ê·¸ë£¹ì´ ìˆëŠ” ê²½ìš°
                if (groupColumns.length > 0) {
                    for (const numCol of numericColumns) {
                        for (const groupCol of groupColumns) {
                            // ê·¸ë£¹ë³„ ë°ì´í„° ì¤€ë¹„
                            const groupsData = {};
                            for (let i = 0; i < currentData[groupCol].length; i++) {
                                const group = currentData[groupCol][i];
                                const value = currentData[numCol][i];
                                
                                if (group && !isNaN(parseFloat(value))) {
                                    if (!groupsData[group]) groupsData[group] = [];
                                    groupsData[group].push(parseFloat(value));
                                }
                            }
                            
                            // ê·¸ë£¹ì´ 2ê°œ ì´ìƒì¸ ê²½ìš°ë§Œ ê²€ì •
                            const validGroups = Object.entries(groupsData)
                                .filter(([_, vals]) => vals.length >= 2);
                            
                            if (validGroups.length < 2) {
                                continue;
                            }
                            
                            // Pythonìœ¼ë¡œ ë“±ë¶„ì‚°ì„± ê²€ì • ì‹¤í–‰
                            const groupsDict = Object.fromEntries(validGroups);
                            pyodide.globals.set('test_groups', groupsDict);
                            const homResult = await pyodide.runPythonAsync(`
                                result = test_homogeneity(test_groups)
                                result
                            `);
                            
                            const homData = homResult.toJs();
                            
                            // ì •ê·œì„± ê²°ê³¼ í™•ì¸í•˜ì—¬ ì ì ˆí•œ ê²€ì • í•´ì„
                            const normalityResult = normalityResults.find(r => r.variable === numCol);
                            const useTest = normalityResult && normalityResult.isNormal && 
                                          homData.get('bartlett')?.pValue ? 
                                          'Bartlett' : homData.get('test');
                            
                            homogeneityResults.push({
                                variable: numCol,
                                groupVariable: groupCol,
                                test: useTest,
                                statistic: homData.get('statistic'),
                                pValue: homData.get('pValue'),
                                isHomogeneous: homData.get('isHomogeneous'),
                                variances: homData.get('variances'),
                                varianceRatio: homData.get('variance_ratio'),
                                groupCount: homData.get('groups'),
                                interpretation: homData.get('isHomogeneous') ?
                                    `ë“±ë¶„ì‚°ì„± ë§Œì¡± (${useTest}: p = ${homData.get('pValue')?.toFixed(3)} > 0.05)` :
                                    `ë“±ë¶„ì‚°ì„± ìœ„ë°° (${useTest}: p = ${homData.get('pValue')?.toFixed(3)} < 0.05)`,
                                recommendation: !homData.get('isHomogeneous') ?
                                    'ë“±ë¶„ì‚° ê°€ì •ì´ ìœ„ë°°ë˜ì–´ Welch ê²€ì • ê¶Œì¥' :
                                    'ë“±ë¶„ì‚° ê°€ì • ì¶©ì¡±, ì¼ë°˜ ê²€ì • ì‚¬ìš© ê°€ëŠ¥'
                            });
                        }
                    }
                }
            } catch (error) {
                console.error('ê°€ì • ê²€ì • ì˜¤ë¥˜:', error);
                document.getElementById('normalityResults').innerHTML = `
                    <div class="error-box">
                        <p class="font-semibold">ì˜¤ë¥˜ ë°œìƒ</p>
                        <p class="text-sm">${error.message}</p>
                    </div>
                `;
                return;
            }
            
            // ê²°ê³¼ ì €ì¥
            analysisResults.assumptions = {
                normality: normalityResults,
                homogeneity: homogeneityResults,
                recommendation: generateAssumptionRecommendation(normalityResults, homogeneityResults)
            };
            
            displayAssumptionResults(analysisResults.assumptions);
            
            // ì„¤ëª… ë°•ìŠ¤ì™€ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('step3Explanation').classList.remove('hidden');
            document.getElementById('step3NextButton').classList.remove('hidden');
            document.getElementById('step3NextButton').querySelector('button').disabled = false;
            
            if (autoProgress) {
                setTimeout(() => proceedToStep4(), 3000);
            }
        }
        
        function generateAssumptionRecommendation(normalityResults, homogeneityResults) {
            const allNormal = normalityResults.every(r => r.isNormal);
            const allHomogeneous = homogeneityResults.length === 0 || homogeneityResults.every(r => r.isHomogeneous);
            
            let recommendation = '';
            if (allNormal && allHomogeneous) {
                recommendation = 'âœ… ëª¨ë“  ê°€ì •ì´ ì¶©ì¡±ë¨ â†’ ëª¨ìˆ˜ì  ê²€ì •(t-test, ANOVA) ì‚¬ìš© ê°€ëŠ¥';
            } else if (!allNormal && allHomogeneous) {
                recommendation = 'âš ï¸ ì •ê·œì„± ê°€ì • ìœ„ë°° â†’ ë¹„ëª¨ìˆ˜ ê²€ì •(Mann-Whitney, Kruskal-Wallis) ê¶Œì¥';
            } else if (allNormal && !allHomogeneous) {
                recommendation = 'âš ï¸ ë“±ë¶„ì‚°ì„± ê°€ì • ìœ„ë°° â†’ Welch ê²€ì • ë˜ëŠ” ë¹„ëª¨ìˆ˜ ê²€ì • ê¶Œì¥';
            } else {
                recommendation = 'âš ï¸ ì •ê·œì„±ê³¼ ë“±ë¶„ì‚°ì„± ëª¨ë‘ ìœ„ë°° â†’ ë¹„ëª¨ìˆ˜ ê²€ì • ê°•ë ¥ ê¶Œì¥';
            }
            return recommendation;
        }
        
        function displayAssumptionResults(results) {
            // ì •ê·œì„± ê²€ì • ê²°ê³¼
            let normalityHtml = '<div class="space-y-2">';
            if (results.normality && results.normality.length > 0) {
                normalityHtml += '<h4 class="font-semibold">ğŸ“Š ì •ê·œì„± ê²€ì • ê²°ê³¼</h4>';
                for (const result of results.normality) {
                    const statusIcon = result.isNormal ? 'âœ…' : 'âš ï¸';
                    const statusColor = result.isNormal ? 'green' : 'orange';
                    normalityHtml += `
                        <div class="bg-${statusColor}-50 p-3 rounded">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-medium">${statusIcon} ${result.variable}</div>
                                    <div class="text-sm text-gray-600 mt-1">
                                        â€¢ ê²€ì •ë°©ë²•: ${result.test}<br>
                                        â€¢ í†µê³„ëŸ‰: ${result.statistic.toFixed(3)}<br>
                                        â€¢ p-ê°’: ${result.pValue.toFixed(3)}<br>
                                        â€¢ ì™œë„: ${result.skewness.toFixed(2)}, ì²¨ë„: ${result.kurtosis.toFixed(2)}
                                    </div>
                                </div>
                                <div class="text-sm font-medium text-${statusColor}-700">
                                    ${result.interpretation}
                                </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-2">
                                ğŸ’¡ ì„¤ëª…: ${result.isNormal ? 
                                    'pê°’ì´ 0.05ë³´ë‹¤ ì»¤ì„œ ì •ê·œë¶„í¬ ê°€ì •ì„ ê¸°ê°í•  ìˆ˜ ì—†ìŒ. ë°ì´í„°ê°€ ì¢… ëª¨ì–‘ì˜ ëŒ€ì¹­ì  ë¶„í¬ë¥¼ ë³´ì„.' :
                                    'pê°’ì´ 0.05ë³´ë‹¤ ì‘ì•„ ì •ê·œë¶„í¬ ê°€ì •ì„ ê¸°ê°. ë°ì´í„°ê°€ ì¹˜ìš°ì³ ìˆê±°ë‚˜ ì´ìƒì¹˜ê°€ ìˆì„ ê°€ëŠ¥ì„±.'}
                            </div>
                        </div>
                    `;
                }
            } else {
                normalityHtml += '<p class="text-gray-500">ì •ê·œì„± ê²€ì •í•  ì—°ì†í˜• ë³€ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            normalityHtml += '</div>';
            document.getElementById('normalityResults').innerHTML = normalityHtml;
            
            // ë“±ë¶„ì‚°ì„± ê²€ì • ê²°ê³¼
            let homogeneityHtml = '<div class="space-y-2">';
            if (results.homogeneity && results.homogeneity.length > 0) {
                homogeneityHtml += '<h4 class="font-semibold">ğŸ“Š ë“±ë¶„ì‚°ì„± ê²€ì • ê²°ê³¼</h4>';
                for (const result of results.homogeneity) {
                    const statusIcon = result.isHomogeneous ? 'âœ…' : 'âš ï¸';
                    const statusColor = result.isHomogeneous ? 'green' : 'orange';
                    homogeneityHtml += `
                        <div class="bg-${statusColor}-50 p-3 rounded">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-medium">${statusIcon} ${result.variable} by ${result.groupVariable}</div>
                                    <div class="text-sm text-gray-600 mt-1">
                                        â€¢ ê²€ì •ë°©ë²•: ${result.test} ê²€ì •<br>
                                        â€¢ F-í†µê³„ëŸ‰: ${result.statistic.toFixed(3)}<br>
                                        â€¢ p-ê°’: ${result.pValue.toFixed(3)}
                                    </div>
                                </div>
                                <div class="text-sm font-medium text-${statusColor}-700">
                                    ${result.interpretation}
                                </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-2">
                                ğŸ’¡ ì„¤ëª…: ${result.isHomogeneous ?
                                    'ê·¸ë£¹ ê°„ ë¶„ì‚°ì´ ìœ ì‚¬í•˜ì—¬ ë“±ë¶„ì‚°ì„± ê°€ì • ì¶©ì¡±. í‘œì¤€ ANOVA ì‚¬ìš© ê°€ëŠ¥.' :
                                    'ê·¸ë£¹ ê°„ ë¶„ì‚° ì°¨ì´ê°€ ì»¤ì„œ ë“±ë¶„ì‚°ì„± ê°€ì • ìœ„ë°°. Welch ANOVA ë˜ëŠ” ë¹„ëª¨ìˆ˜ ê²€ì • ê³ ë ¤.'}
                            </div>
                        </div>
                    `;
                }
            } else {
                homogeneityHtml += '<p class="text-gray-500">ë“±ë¶„ì‚°ì„± ê²€ì •í•  ê·¸ë£¹ ë³€ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            homogeneityHtml += '</div>';
            document.getElementById('homogeneityResults').innerHTML = homogeneityHtml;
            
            // ì¢…í•© ì¶”ì²œ
            if (results.recommendation) {
                const recommendHtml = `
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <h4 class="font-semibold text-blue-800 mb-2">ğŸ¯ ì¢…í•© ë¶„ì„ ë° ê¶Œì¥ì‚¬í•­</h4>
                        <p class="text-sm text-blue-700">${results.recommendation}</p>
                    </div>
                `;
                document.getElementById('homogeneityResults').innerHTML += recommendHtml;
            }
        }
        
        // ê°€ì • ì¬ê²€ì •
        function retestAssumptions() {
            analysisResults.assumptions = null; // ê¸°ì¡´ ê²°ê³¼ ì‚­ì œ
            testAssumptions(); // ì¬ê²€ì • ì‹¤í–‰
        }
        
        // ë°©ë²• ì¶”ì²œ
        function recommendMethod() {
            // ì´ë¯¸ ê²°ê³¼ê°€ ìˆìœ¼ë©´ í‘œì‹œë§Œ
            if (analysisResults.method) {
                displayMethodRecommendation(analysisResults.method);
                return;
            }
            
            // ê°€ì • ê²€ì • ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ê²½ê³ 
            if (!analysisResults.assumptions) {
                alert('ë¨¼ì € í†µê³„ì  ê°€ì • ê²€ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë°ì´í„°ì™€ ê°€ì • ê²€ì • ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìµœì  ë°©ë²• ì¶”ì²œ
            const method = analyzeDataForMethod();
            
            analysisResults.method = method;
            displayMethodRecommendation(method);
            
            // ì„¤ëª… ë°•ìŠ¤ì™€ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('step4Explanation').classList.remove('hidden');
            document.getElementById('step4NextButton').classList.remove('hidden');
            document.getElementById('step4NextButton').querySelector('button').disabled = false;
            
            if (autoProgress) {
                setTimeout(() => proceedToStep5(), 3000);
            }
        }
        
        function analyzeDataForMethod() {
            // ê°€ì • ê²€ì • ê²°ê³¼ì™€ ë°ì´í„° íŠ¹ì„± í™•ì¸
            const validation = analysisResults.validation || {};
            const assumptions = analysisResults.assumptions || {};
            const numericColumns = validation.numericColumns || [];
            const groupColumns = validation.groupColumns || [];
            
            // ê°€ì • ì¶©ì¡± ì—¬ë¶€ í™•ì¸
            const allNormal = assumptions.normality && assumptions.normality.every(r => r.isNormal);
            const allHomogeneous = !assumptions.homogeneity || assumptions.homogeneity.length === 0 || 
                                  assumptions.homogeneity.every(r => r.isHomogeneous);
            
            if (!currentData) {
                return {
                    name: 'One-way ANOVA',
                    description: 'ê¸°ë³¸ ê·¸ë£¹ ë¹„êµ ë¶„ì„',
                    reason: 'ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                    primary: { name: 'One-way ANOVA', type: 'parametric' },
                    alternatives: [],
                    reasoning: ['ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤']
                };
            }
            
            const columns = Object.keys(currentData);
            const numericCols = [];
            const categoricalCols = [];
            
            // ì»¬ëŸ¼ ìœ í˜• ë¶„ì„
            for (const col of columns) {
                const values = currentData[col];
                const numericCount = values.filter(v => !isNaN(v) && v !== null && v !== '').length;
                const totalCount = values.filter(v => v !== null && v !== '').length;
                
                if (numericCount / totalCount > 0.8) {
                    numericCols.push(col);
                } else {
                    categoricalCols.push(col);
                }
            }
            
            // ë°©ë²• ê²°ì • ë¡œì§
            
            // 1. ëŒ€ì‘ í‘œë³¸ ë˜ëŠ” ë°˜ë³µì¸¡ì • ê°ì§€
            const hasPairedKeywords = columns.some(col => {
                const lowerCol = col.toLowerCase();
                return lowerCol.includes('before') || lowerCol.includes('after') ||
                       lowerCol.includes('pre') || lowerCol.includes('post') ||
                       lowerCol.includes('time') || lowerCol.includes('ì „') || 
                       lowerCol.includes('í›„') || lowerCol.includes('ì‹œê°„') ||
                       lowerCol.includes('paired') || lowerCol.includes('ëŒ€ì‘');
            });
            
            const hasSubjectId = columns.some(col => {
                const lowerCol = col.toLowerCase();
                return lowerCol.includes('subject') || lowerCol.includes('id') ||
                       lowerCol.includes('patient') || lowerCol.includes('í™˜ì') ||
                       lowerCol.includes('ê°œì²´');
            });
            
            // ëŒ€ì‘ í‘œë³¸ tê²€ì • ê°ì§€
            if (hasPairedKeywords && numericCols.length >= 2) {
                const isNormal = assumptions.normality && 
                                assumptions.normality.every(r => r.isNormal);
                return {
                    name: isNormal ? 'Paired t-test' : 'Wilcoxon Signed-Rank Test',
                    type: 'paired_test',
                    description: isNormal ? 
                        'ëŒ€ì‘ í‘œë³¸ì˜ í‰ê·  ì°¨ì´ë¥¼ ê²€ì •í•©ë‹ˆë‹¤.' :
                        'ëŒ€ì‘ í‘œë³¸ì˜ ì¤‘ì•™ê°’ ì°¨ì´ë¥¼ ê²€ì •í•©ë‹ˆë‹¤ (ë¹„ëª¨ìˆ˜).',
                    reason: `ëŒ€ì‘ í‘œë³¸ ë°ì´í„°ê°€ ê°ì§€ë˜ì—ˆê³ , ì •ê·œì„±: ${isNormal ? 'ì¶©ì¡±' : 'ë¯¸ì¶©ì¡±'}`,
                    variables: numericCols.slice(0, 2),
                    isPaired: true
                };
            }
            
            // ë°˜ë³µì¸¡ì • ANOVA ê°ì§€
            if (hasSubjectId && categoricalCols.length >= 1 && numericCols.length >= 1) {
                const groups = [...new Set(currentData[categoricalCols[0]])];
                if (groups.length >= 3) {
                    const isNormal = assumptions.normality && 
                                    assumptions.normality.every(r => r.isNormal);
                    return {
                        name: isNormal ? 'Repeated Measures ANOVA' : 'Friedman Test',
                        type: 'repeated_measures',
                        description: isNormal ?
                            'ë°˜ë³µì¸¡ì •ëœ ë°ì´í„°ì˜ ê·¸ë£¹ ê°„ ì°¨ì´ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.' :
                            'ë°˜ë³µì¸¡ì •ëœ ë°ì´í„°ì˜ ê·¸ë£¹ ê°„ ì°¨ì´ë¥¼ ë¹„ëª¨ìˆ˜ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.',
                        reason: `ë°˜ë³µì¸¡ì • ë””ìì¸ì´ ê°ì§€ë˜ì—ˆê³  ${groups.length}ê°œ ì‹œì `,
                        factor: categoricalCols[0],
                        dependent: numericCols[0],
                        subjectId: columns.find(col => 
                            col.toLowerCase().includes('subject') || 
                            col.toLowerCase().includes('id')
                        )
                    };
                }
            }
            
            // 2. ë²”ì£¼í˜• ë°ì´í„° ë¶„ì„ ê°ì§€
            const allCategorical = columns.every(col => {
                const values = currentData[col];
                const numericCount = values.filter(v => !isNaN(v) && v !== null && v !== '').length;
                return numericCount / values.length < 0.2; // 80% ì´ìƒì´ ë¹„ìˆ«ì
            });
            
            if (allCategorical && columns.length >= 2) {
                return {
                    name: 'Chi-square Test',
                    type: 'chi_square',
                    description: 'ë²”ì£¼í˜• ë³€ìˆ˜ ê°„ì˜ ë…ë¦½ì„±ì„ ê²€ì •í•©ë‹ˆë‹¤.',
                    reason: 'ëª¨ë“  ë³€ìˆ˜ê°€ ë²”ì£¼í˜•ìœ¼ë¡œ ê°ì§€ë˜ì–´ ì¹´ì´ì œê³± ê²€ì •ì´ ì í•©í•©ë‹ˆë‹¤.',
                    variables: columns,
                    alternatives: [
                        "Fisher's Exact Test (í‘œë³¸ í¬ê¸°ê°€ ì‘ì„ ë•Œ)",
                        "Cramer's V (íš¨ê³¼ í¬ê¸° ì¸¡ì •)"
                    ]
                };
            }
            
            // Two-way ANOVA ê°ì§€ (2ê°œ ë²”ì£¼í˜• + 1ê°œ ìˆ˜ì¹˜í˜•)
            if (categoricalCols.length >= 2 && numericCols.length >= 1) {
                return {
                    name: 'Two-way ANOVA',
                    type: 'two_way_anova',
                    description: 'ë‘ ë…ë¦½ë³€ìˆ˜ì˜ ì£¼íš¨ê³¼ì™€ ìƒí˜¸ì‘ìš© íš¨ê³¼ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.',
                    reason: `ë²”ì£¼í˜• ë³€ìˆ˜ ${categoricalCols.length}ê°œì™€ ì¢…ì†ë³€ìˆ˜ ${numericCols.length}ê°œê°€ ê°ì§€ë˜ì–´ ì´ì›ë¶„ì‚°ë¶„ì„ì´ ì í•©í•©ë‹ˆë‹¤.`,
                    factors: categoricalCols.slice(0, 2),
                    dependent: numericCols[0]
                };
            }
            
            // íšŒê·€ë¶„ì„ ê°ì§€ (2ê°œ ì´ìƒ ìˆ˜ì¹˜í˜•)
            if (numericCols.length >= 2) {
                return {
                    name: numericCols.length === 2 ? 'Simple Linear Regression' : 'Multiple Regression',
                    type: 'regression',
                    description: numericCols.length === 2 ? 
                        'ë‘ ì—°ì†ë³€ìˆ˜ ê°„ì˜ ì„ í˜• ê´€ê³„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.' :
                        'ì—¬ëŸ¬ ë…ë¦½ë³€ìˆ˜ê°€ ì¢…ì†ë³€ìˆ˜ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•©ë‹ˆë‹¤.',
                    reason: `ì—°ì†í˜• ë³€ìˆ˜ ${numericCols.length}ê°œê°€ ê°ì§€ë˜ì–´ íšŒê·€ë¶„ì„ì´ ì í•©í•©ë‹ˆë‹¤.`,
                    predictors: numericCols.slice(0, -1),
                    dependent: numericCols[numericCols.length - 1]
                };
            }
            
            // One-way ANOVA ê°ì§€ (1ê°œ ë²”ì£¼í˜• + 1ê°œ ìˆ˜ì¹˜í˜•)
            if (categoricalCols.length >= 1 && numericCols.length >= 1) {
                const groups = [...new Set(currentData[categoricalCols[0]])];
                if (groups.length >= 3) {
                    return {
                        name: 'One-way ANOVA',
                        type: 'one_way_anova',
                        description: '3ê°œ ì´ìƒ ê·¸ë£¹ì˜ í‰ê· ì„ ë¹„êµí•©ë‹ˆë‹¤.',
                        reason: `${groups.length}ê°œ ê·¸ë£¹ì´ ê°ì§€ë˜ì–´ ì¼ì›ë¶„ì‚°ë¶„ì„ì´ ì í•©í•©ë‹ˆë‹¤.`,
                        factor: categoricalCols[0],
                        dependent: numericCols[0]
                    };
                } else if (groups.length === 2) {
                    return {
                        name: 'Independent t-test',
                        type: 'ttest',
                        description: 'ë‘ ë…ë¦½ ê·¸ë£¹ì˜ í‰ê· ì„ ë¹„êµí•©ë‹ˆë‹¤.',
                        reason: '2ê°œ ê·¸ë£¹ì´ ê°ì§€ë˜ì–´ ë…ë¦½í‘œë³¸ tê²€ì •ì´ ì í•©í•©ë‹ˆë‹¤.',
                        factor: categoricalCols[0],
                        dependent: numericCols[0]
                    };
                }
            }
            
            // CPUE ë¶„ì„ ê°ì§€
            const cpueKeywords = ['catch', 'effort', 'cpue', 'ì–´íšëŸ‰', 'ì–´íšë…¸ë ¥'];
            const hasCPUE = columns.some(col => 
                cpueKeywords.some(keyword => col.toLowerCase().includes(keyword))
            );
            
            if (hasCPUE) {
                return {
                    name: 'CPUE Analysis',
                    type: 'cpue',
                    description: 'ì–´íšë…¸ë ¥ë‹¹ ì–´íšëŸ‰ ë¶„ì„ìœ¼ë¡œ ìì›ì˜ ìƒëŒ€ì  í’ë„ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.',
                    reason: 'CPUE ê´€ë ¨ ë°ì´í„°ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.',
                    special: 'fisheries'
                };
            }
            
            // ì„±ì¥ë¶„ì„ ê°ì§€
            const growthKeywords = ['length', 'weight', 'age', 'ì „ì¥', 'ì²´ì¤‘', 'ì—°ë ¹'];
            const hasGrowth = columns.some(col => 
                growthKeywords.some(keyword => col.toLowerCase().includes(keyword))
            );
            
            if (hasGrowth) {
                return {
                    name: 'Growth Analysis',
                    type: 'growth',
                    description: 'ì–´ë¥˜ì˜ ì„±ì¥ íŒ¨í„´ì„ ë¶„ì„í•©ë‹ˆë‹¤.',
                    reason: 'ì„±ì¥ ê´€ë ¨ ë°ì´í„°ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.',
                    special: 'fisheries'
                };
            }
            
            // ê¸°ë³¸ê°’
            return {
                name: 'Descriptive Statistics',
                type: 'descriptive',
                description: 'ê¸°ìˆ í†µê³„ë¡œ ë°ì´í„°ì˜ ê¸°ë³¸ íŠ¹ì„±ì„ íŒŒì•…í•©ë‹ˆë‹¤.',
                reason: 'ë°ì´í„° êµ¬ì¡° ë¶„ì„ ê²°ê³¼ ê¸°ìˆ í†µê³„ ë¶„ì„ì´ ì í•©í•©ë‹ˆë‹¤.'
            };
        }
        
        function displayMethodRecommendation(method) {
            // ì´ì „ ë²„ì „ê³¼ì˜ í˜¸í™˜ì„± ì²´í¬
            if (!method.primary) {
                // êµ¬ì‹ í˜•ì‹ì„ ìƒˆ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                method = {
                    primary: { name: method.name, description: method.description, type: method.type },
                    reasoning: [method.reason],
                    alternatives: []
                };
            }
            
            let html = `
                <div class="space-y-4">
                    <!-- ì£¼ìš” ì¶”ì²œ ë°©ë²• -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="font-semibold text-blue-800 mb-2">ğŸ¯ ì¶”ì²œ ë¶„ì„ ë°©ë²•</h4>
                        <div class="text-lg font-medium text-blue-900">${method.primary.name}</div>
                        <div class="text-sm text-blue-700 mt-1">${method.primary.description || ''}</div>
                        <div class="mt-2 text-xs">
                            <span class="inline-block px-2 py-1 bg-white rounded">
                                ${method.primary.type === 'parametric' ? 'ğŸ“Š ëª¨ìˆ˜ì  ê²€ì •' : 
                                  method.primary.type === 'non-parametric' || method.primary.type === 'non_parametric' ? 'ğŸ“ˆ ë¹„ëª¨ìˆ˜ ê²€ì •' : 
                                  method.primary.type === 'two_way_anova' || method.primary.type === 'one_way_anova' ? 'ğŸ“Š ë¶„ì‚°ë¶„ì„' :
                                  method.primary.type === 'regression' ? 'ğŸ“‰ íšŒê·€ë¶„ì„' :
                                  method.primary.type === 'ttest' ? 'ğŸ“Š t-ê²€ì •' :
                                  'ğŸ“‹ ê¸°ìˆ í†µê³„'}
                            </span>
                            ${method.primary.requirements ? `<div class="mt-1">${method.primary.requirements}</div>` : ''}
                            ${method.primary.postHoc ? `<div class="mt-1">ğŸ“Œ ì‚¬í›„ê²€ì •: ${method.primary.postHoc}</div>` : ''}
                        </div>
                    </div>
                    
                    <!-- ì¶”ì²œ ì´ìœ  -->
                    ${method.reasoning && method.reasoning.length > 0 ? `
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h5 class="font-semibold mb-2">ğŸ’¡ ì„ íƒ ì´ìœ </h5>
                        <ul class="text-sm space-y-1">
                            ${method.reasoning.map(r => `<li>â€¢ ${r}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    <!-- ëŒ€ì•ˆ ë°©ë²• -->
                    ${method.alternatives && method.alternatives.length > 0 ? `
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h5 class="font-semibold mb-2">ğŸ”„ ëŒ€ì²´ ê°€ëŠ¥í•œ ë°©ë²•</h5>
                        <ul class="text-sm space-y-2">
                            ${method.alternatives.map(alt => `
                                <li>
                                    <span class="font-medium">â€¢ ${alt.name}</span>
                                    <span class="text-xs text-gray-600 ml-2">(${alt.reason || ''})</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('methodRecommendation').innerHTML = html;
        }
        
        // ë¶„ì„ ì‹¤í–‰
        async function runAnalysis() {
            // ì´ë¯¸ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë°”ë¡œ 6ë‹¨ê³„ë¡œ
            if (analysisResults.final) {
                moveToStep(6, true);
                displayResults();
                return;
            }
            
            // í•„ìˆ˜ ì‚¬ì „ ë‹¨ê³„ í™•ì¸
            if (!analysisResults.method) {
                alert('ë¨¼ì € ë¶„ì„ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¶„ì„ ì§„í–‰ ìƒíƒœ í‘œì‹œ
            document.getElementById('analysisProgress').innerHTML = `
                <div class="text-center py-4">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    <p class="mt-2 text-gray-600">í†µê³„ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>
            `;
            
            // ì‹¤ì œ ë¶„ì„ ìˆ˜í–‰ (Pyodide ì‚¬ìš©)
            setTimeout(async () => {
                const startTime = Date.now();
                const result = await performStatisticalAnalysis();
                analysisResults.final = result;
                
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                
                // ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
                document.getElementById('analysisProgress').innerHTML = `
                    <div class="success-box">
                        <p class="font-semibold">âœ… ë¶„ì„ ì™„ë£Œ</p>
                        <p class="text-sm mt-1">ì´ ì†Œìš”ì‹œê°„: ${elapsed}ì´ˆ</p>
                    </div>
                `;
                
                // 6ë‹¨ê³„ë¡œ ì´ë™
                setTimeout(() => {
                    moveToStep(6, true);
                    displayResults();
                    
                    // ì„¤ëª… ë°•ìŠ¤ í‘œì‹œ
                    document.getElementById('step5Explanation').classList.remove('hidden');
                }, 1000);
            }, 2000);
        }
        
        async function performStatisticalAnalysis() {
            // Pyodideê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!window.pyodide || !pyodideReady) {
                console.warn('Pyodide not ready, using fallback calculations');
                return performStatisticalAnalysisFallback();
            }
            
            // ì„ íƒëœ ë°©ë²•ì— ë”°ë¼ ë‹¤ë¥¸ ë¶„ì„ ìˆ˜í–‰
            const method = analysisResults.method.primary || analysisResults.method;
            const validation = analysisResults.validation;
            const numericColumns = validation.numericColumns || [];
            const groupColumns = validation.groupColumns || [];
            
            let result = {
                method: method.name,
                timestamp: new Date().toISOString(),
                data: {},
                statistics: {},
                interpretation: '',
                postHoc: null
            };
            
            try {
                // ë¶„ì„ íƒ€ì…ë³„ ì²˜ë¦¬
                if (method.type === 'ttest' || method.name.includes('t-test')) {
                    // t-ê²€ì • (Pyodide ì‚¬ìš©)
                    const dependentVar = numericColumns[0];
                    const groupVar = groupColumns[0];
                    const groups = [...new Set(currentData[groupVar])];
                    
                    // ê·¸ë£¹ë³„ ë°ì´í„° ë¶„ë¦¬
                    const group1Data = [];
                    const group2Data = [];
                    for (let i = 0; i < currentData[groupVar].length; i++) {
                        const value = parseFloat(currentData[dependentVar][i]);
                        if (!isNaN(value)) {
                            if (currentData[groupVar][i] === groups[0]) {
                                group1Data.push(value);
                            } else if (currentData[groupVar][i] === groups[1]) {
                                group2Data.push(value);
                            }
                        }
                    }
                    
                    // Pythonìœ¼ë¡œ ì‹¤ì œ t-test ìˆ˜í–‰
                    const pythonResult = await window.pyodide.runPythonAsync(`
                        import numpy as np
                        from scipy import stats
                        import json
                        
                        group1 = np.array(${JSON.stringify(group1Data)})
                        group2 = np.array(${JSON.stringify(group2Data)})
                        
                        # Independent t-test
                        if '${method.name}'.find('Welch') >= 0:
                            t_stat, p_value = stats.ttest_ind(group1, group2, equal_var=False)
                        else:
                            t_stat, p_value = stats.ttest_ind(group1, group2, equal_var=True)
                        
                        # ê¸°ìˆ í†µê³„
                        mean1 = np.mean(group1)
                        mean2 = np.mean(group2)
                        std1 = np.std(group1, ddof=1)
                        std2 = np.std(group2, ddof=1)
                        n1 = len(group1)
                        n2 = len(group2)
                        
                        # íš¨ê³¼ í¬ê¸° ê³„ì‚°
                        pooled_std = np.sqrt(((n1-1)*std1**2 + (n2-1)*std2**2) / (n1+n2-2))
                        cohen_d = (mean1 - mean2) / pooled_std
                        
                        # 95% ì‹ ë¢°êµ¬ê°„
                        mean_diff = mean1 - mean2
                        se_diff = pooled_std * np.sqrt(1/n1 + 1/n2)
                        df = n1 + n2 - 2
                        t_crit = stats.t.ppf(0.975, df)
                        ci_lower = mean_diff - t_crit * se_diff
                        ci_upper = mean_diff + t_crit * se_diff
                        
                        result = {
                            "t_statistic": float(t_stat),
                            "p_value": float(p_value),
                            "df": int(df),
                            "mean1": float(mean1),
                            "mean2": float(mean2),
                            "std1": float(std1),
                            "std2": float(std2),
                            "n1": int(n1),
                            "n2": int(n2),
                            "cohen_d": float(cohen_d),
                            "ci_lower": float(ci_lower),
                            "ci_upper": float(ci_upper),
                            "mean_diff": float(mean_diff)
                        }
                        json.dumps(result)
                    `);
                    
                    const stats = JSON.parse(pythonResult);
                    
                    result.statistics = {
                        tStatistic: stats.t_statistic,
                        df: stats.df,
                        pValue: stats.p_value,
                        group1: { name: groups[0], n: stats.n1, mean: stats.mean1, std: stats.std1 },
                        group2: { name: groups[1], n: stats.n2, mean: stats.mean2, std: stats.std2 },
                        meanDifference: Math.abs(stats.mean_diff),
                        cohensD: Math.abs(stats.cohen_d),
                        confidenceInterval: [stats.ci_lower, stats.ci_upper]
                    };
                    
                    result.interpretation = stats.p_value < 0.05 ? 
                        `ë‘ ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤ (t=${stats.t_statistic.toFixed(3)}, p=${stats.p_value.toFixed(4)} < 0.05). ${groups[0]}ì˜ í‰ê· (${stats.mean1.toFixed(2)})ê³¼ ${groups[1]}ì˜ í‰ê· (${stats.mean2.toFixed(2)}) ê°„ ì°¨ì´ëŠ” í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•©ë‹ˆë‹¤. íš¨ê³¼í¬ê¸°(Cohen's d): ${Math.abs(stats.cohen_d).toFixed(3)}` :
                        `ë‘ ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤ (t=${stats.t_statistic.toFixed(3)}, p=${stats.p_value.toFixed(4)} > 0.05). ${groups[0]}ê³¼ ${groups[1]}ì˜ í‰ê·  ì°¨ì´ëŠ” í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`;
                        
                } else if (method.type === 'one_way_anova' || method.name.includes('ANOVA')) {
                    // ANOVA (Pyodide ì‚¬ìš©)
                    const dependentVar = numericColumns[0];
                    const groupVar = groupColumns[0];
                    const groups = [...new Set(currentData[groupVar])];
                    
                    // ê·¸ë£¹ë³„ ë°ì´í„° ì¤€ë¹„
                    const groupDataArrays = {};
                    for (const group of groups) {
                        groupDataArrays[group] = [];
                    }
                    
                    for (let i = 0; i < currentData[groupVar].length; i++) {
                        const value = parseFloat(currentData[dependentVar][i]);
                        const group = currentData[groupVar][i];
                        if (!isNaN(value) && groupDataArrays[group]) {
                            groupDataArrays[group].push(value);
                        }
                    }
                    
                    // Pythonìœ¼ë¡œ ì‹¤ì œ ANOVA ìˆ˜í–‰
                    const pythonResult = await window.pyodide.runPythonAsync(`
                        import numpy as np
                        from scipy import stats
                        import json
                        
                        # ê·¸ë£¹ ë°ì´í„°
                        groups_data = ${JSON.stringify(groupDataArrays)}
                        group_names = list(groups_data.keys())
                        group_arrays = [np.array(groups_data[name]) for name in group_names]
                        
                        # One-way ANOVA
                        f_stat, p_value = stats.f_oneway(*group_arrays)
                        
                        # ê° ê·¸ë£¹ í†µê³„
                        group_stats = {}
                        all_data = []
                        for name, data in groups_data.items():
                            arr = np.array(data)
                            all_data.extend(data)
                            group_stats[name] = {
                                "n": len(arr),
                                "mean": float(np.mean(arr)),
                                "std": float(np.std(arr, ddof=1)),
                                "variance": float(np.var(arr, ddof=1))
                            }
                        
                        # ì „ì²´ í†µê³„
                        all_data = np.array(all_data)
                        grand_mean = np.mean(all_data)
                        total_n = len(all_data)
                        
                        # SS ê³„ì‚°
                        ss_total = np.sum((all_data - grand_mean)**2)
                        ss_between = sum(group_stats[name]["n"] * (group_stats[name]["mean"] - grand_mean)**2 
                                        for name in group_names)
                        ss_within = ss_total - ss_between
                        
                        # ììœ ë„
                        df_between = len(group_names) - 1
                        df_within = total_n - len(group_names)
                        
                        # MS ê³„ì‚°
                        ms_between = ss_between / df_between
                        ms_within = ss_within / df_within
                        
                        # íš¨ê³¼ í¬ê¸°
                        eta_squared = ss_between / ss_total
                        omega_squared = (ss_between - df_between * ms_within) / (ss_total + ms_within)
                        
                        result = {
                            "f_statistic": float(f_stat),
                            "p_value": float(p_value),
                            "df_between": int(df_between),
                            "df_within": int(df_within),
                            "ss_between": float(ss_between),
                            "ss_within": float(ss_within),
                            "ss_total": float(ss_total),
                            "ms_between": float(ms_between),
                            "ms_within": float(ms_within),
                            "eta_squared": float(eta_squared),
                            "omega_squared": float(omega_squared),
                            "group_stats": group_stats,
                            "n_groups": len(group_names)
                        }
                        json.dumps(result)
                    `);
                    
                    const stats = JSON.parse(pythonResult);
                    
                    result.statistics = {
                        fStatistic: stats.f_statistic,
                        dfBetween: stats.df_between,
                        dfWithin: stats.df_within,
                        pValue: stats.p_value,
                        SSbetween: stats.ss_between,
                        SSwithin: stats.ss_within,
                        SStotal: stats.ss_total,
                        MSbetween: stats.ms_between,
                        MSwithin: stats.ms_within,
                        groups: stats.group_stats,
                        etaSquared: stats.eta_squared,
                        omegaSquared: stats.omega_squared
                    };
                    
                    result.interpretation = stats.p_value < 0.05 ?
                        `ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤ (F(${stats.df_between},${stats.df_within})=${stats.f_statistic.toFixed(3)}, p=${stats.p_value.toFixed(4)} < 0.05). ì ì–´ë„ í•˜ë‚˜ì˜ ê·¸ë£¹ í‰ê· ì´ ë‹¤ë¥¸ ê·¸ë£¹ê³¼ ìœ ì˜í•˜ê²Œ ë‹¤ë¦…ë‹ˆë‹¤. íš¨ê³¼í¬ê¸°(Î·Â²): ${stats.eta_squared.toFixed(3)}` :
                        `ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤ (F(${stats.df_between},${stats.df_within})=${stats.f_statistic.toFixed(3)}, p=${stats.p_value.toFixed(4)} > 0.05). ëª¨ë“  ê·¸ë£¹ì˜ í‰ê· ì´ í†µê³„ì ìœ¼ë¡œ ìœ ì‚¬í•©ë‹ˆë‹¤.`;
                        
                    // ì‚¬í›„ë¶„ì„ í•„ìš” ì—¬ë¶€
                    if (stats.p_value < 0.05 && stats.n_groups > 2) {
                        result.postHoc = {
                            method: analysisResults.assumptions?.homogeneity ? 'Tukey HSD' : 'Games-Howell',
                            comparisons: [],
                            note: 'ì‚¬í›„ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤ (3ê°œ ì´ìƒ ê·¸ë£¹ì—ì„œ ìœ ì˜í•œ ì°¨ì´ ë°œê²¬)'
                        };
                    }
                    
                } else if (method.type === 'mann_whitney' || method.type === 'kruskal_wallis') {
                    // ë¹„ëª¨ìˆ˜ ê²€ì •
                    result = await performNonParametricAnalysis(method, validation);
                } else {
                    // ê¸°ë³¸ ê¸°ìˆ í†µê³„
                    result.statistics = {
                        description: 'ê¸°ìˆ í†µê³„ ë¶„ì„'
                    };
                    result.interpretation = 'ë°ì´í„°ì˜ ê¸°ë³¸ í†µê³„ëŸ‰ì„ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.';
                }
                
            } catch (error) {
                console.error('Statistical analysis error:', error);
                // ì˜¤ë¥˜ ì‹œ fallback í•¨ìˆ˜ ì‚¬ìš©
                return performStatisticalAnalysisFallback();
            }
            
            return result;
        }
        
        // Fallback í•¨ìˆ˜ (Pyodide ì—†ì„ ë•Œ ì‚¬ìš©)
        function performStatisticalAnalysisFallback() {
            console.log('Using fallback statistical analysis');
            // ê¸°ì¡´ì˜ ê°„ë‹¨í•œ ê³„ì‚° ë¡œì§ (í•„ìš”ì‹œ)
            return {
                method: 'Fallback Analysis',
                timestamp: new Date().toISOString(),
                statistics: {
                    note: 'Pyodideë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ì–´ ê°„ë‹¨í•œ ë¶„ì„ë§Œ ì œê³µë©ë‹ˆë‹¤.'
                },
                interpretation: 'Python í™˜ê²½ì„ ë¡œë“œí•˜ì§€ ëª»í•´ ì œí•œëœ ë¶„ì„ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤.'
            };
        }
        
        // ë¹„ëª¨ìˆ˜ ê²€ì • ìˆ˜í–‰
        async function performNonParametricAnalysis(method, validation) {
            if (!window.pyodide || !pyodideReady) {
                return performStatisticalAnalysisFallback();
            }
            
            const numericColumns = validation.numericColumns || [];
            const groupColumns = validation.groupColumns || [];
            
            let result = {
                method: method.name,
                timestamp: new Date().toISOString(),
                data: {},
                statistics: {},
                interpretation: '',
                postHoc: null
            };
            
            try {
                if (method.type === 'mann_whitney') {
                    // Mann-Whitney U test
                    const dependentVar = numericColumns[0];
                    const groupVar = groupColumns[0];
                    const groups = [...new Set(currentData[groupVar])];
                    
                    // ê·¸ë£¹ë³„ ë°ì´í„° ë¶„ë¦¬
                    const group1Data = [];
                    const group2Data = [];
                    for (let i = 0; i < currentData[groupVar].length; i++) {
                        const value = parseFloat(currentData[dependentVar][i]);
                        if (!isNaN(value)) {
                            if (currentData[groupVar][i] === groups[0]) {
                                group1Data.push(value);
                            } else if (currentData[groupVar][i] === groups[1]) {
                                group2Data.push(value);
                            }
                        }
                    }
                    
                    const pythonResult = await window.pyodide.runPythonAsync(`
                        import numpy as np
                        from scipy import stats
                        import json
                        
                        group1 = np.array(${JSON.stringify(group1Data)})
                        group2 = np.array(${JSON.stringify(group2Data)})
                        
                        # Mann-Whitney U test
                        u_stat, p_value = stats.mannwhitneyu(group1, group2, alternative='two-sided')
                        
                        # ì¤‘ì•™ê°’ ê³„ì‚°
                        median1 = np.median(group1)
                        median2 = np.median(group2)
                        
                        # ìˆœìœ„ í•©
                        combined = np.concatenate([group1, group2])
                        ranks = stats.rankdata(combined)
                        rank_sum1 = np.sum(ranks[:len(group1)])
                        rank_sum2 = np.sum(ranks[len(group1):])
                        
                        # íš¨ê³¼ í¬ê¸° (r = Z / sqrt(N))
                        n = len(group1) + len(group2)
                        z_stat = stats.norm.ppf(p_value / 2) if p_value < 1 else 0
                        effect_size = abs(z_stat) / np.sqrt(n)
                        
                        result = {
                            "u_statistic": float(u_stat),
                            "p_value": float(p_value),
                            "median1": float(median1),
                            "median2": float(median2),
                            "n1": len(group1),
                            "n2": len(group2),
                            "rank_sum1": float(rank_sum1),
                            "rank_sum2": float(rank_sum2),
                            "effect_size": float(effect_size)
                        }
                        json.dumps(result)
                    `);
                    
                    const stats = JSON.parse(pythonResult);
                    
                    result.statistics = {
                        uStatistic: stats.u_statistic,
                        pValue: stats.p_value,
                        group1: { name: groups[0], n: stats.n1, median: stats.median1, rankSum: stats.rank_sum1 },
                        group2: { name: groups[1], n: stats.n2, median: stats.median2, rankSum: stats.rank_sum2 },
                        effectSize: stats.effect_size
                    };
                    
                    result.interpretation = stats.p_value < 0.05 ?
                        `ë‘ ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤ (U=${stats.u_statistic.toFixed(1)}, p=${stats.p_value.toFixed(4)} < 0.05). ${groups[0]}ì˜ ì¤‘ì•™ê°’(${stats.median1.toFixed(2)})ê³¼ ${groups[1]}ì˜ ì¤‘ì•™ê°’(${stats.median2.toFixed(2)}) ê°„ ì°¨ì´ëŠ” í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•©ë‹ˆë‹¤.` :
                        `ë‘ ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤ (U=${stats.u_statistic.toFixed(1)}, p=${stats.p_value.toFixed(4)} > 0.05).`;
                        
                } else if (method.type === 'kruskal_wallis') {
                    // Kruskal-Wallis test
                    const dependentVar = numericColumns[0];
                    const groupVar = groupColumns[0];
                    const groups = [...new Set(currentData[groupVar])];
                    
                    // ê·¸ë£¹ë³„ ë°ì´í„° ì¤€ë¹„
                    const groupDataArrays = {};
                    for (const group of groups) {
                        groupDataArrays[group] = [];
                    }
                    
                    for (let i = 0; i < currentData[groupVar].length; i++) {
                        const value = parseFloat(currentData[dependentVar][i]);
                        const group = currentData[groupVar][i];
                        if (!isNaN(value) && groupDataArrays[group]) {
                            groupDataArrays[group].push(value);
                        }
                    }
                    
                    const pythonResult = await window.pyodide.runPythonAsync(`
                        import numpy as np
                        from scipy import stats
                        import json
                        
                        # ê·¸ë£¹ ë°ì´í„°
                        groups_data = ${JSON.stringify(groupDataArrays)}
                        group_names = list(groups_data.keys())
                        group_arrays = [np.array(groups_data[name]) for name in group_names]
                        
                        # Kruskal-Wallis test
                        h_stat, p_value = stats.kruskal(*group_arrays)
                        
                        # ê° ê·¸ë£¹ í†µê³„
                        group_stats = {}
                        for name, data in groups_data.items():
                            arr = np.array(data)
                            group_stats[name] = {
                                "n": len(arr),
                                "median": float(np.median(arr)),
                                "iqr": float(np.percentile(arr, 75) - np.percentile(arr, 25)),
                                "mean_rank": float(stats.rankdata(np.concatenate(group_arrays))[
                                    sum(len(groups_data[n]) for n in group_names[:group_names.index(name)]):
                                    sum(len(groups_data[n]) for n in group_names[:group_names.index(name)+1])
                                ].mean())
                            }
                        
                        # íš¨ê³¼ í¬ê¸° (epsilon squared)
                        n_total = sum(len(arr) for arr in group_arrays)
                        epsilon_squared = (h_stat - len(group_names) + 1) / (n_total - len(group_names))
                        
                        result = {
                            "h_statistic": float(h_stat),
                            "p_value": float(p_value),
                            "df": len(group_names) - 1,
                            "group_stats": group_stats,
                            "n_groups": len(group_names),
                            "epsilon_squared": float(epsilon_squared) if epsilon_squared > 0 else 0
                        }
                        json.dumps(result)
                    `);
                    
                    const stats = JSON.parse(pythonResult);
                    
                    result.statistics = {
                        hStatistic: stats.h_statistic,
                        df: stats.df,
                        pValue: stats.p_value,
                        groups: stats.group_stats,
                        epsilonSquared: stats.epsilon_squared
                    };
                    
                    result.interpretation = stats.p_value < 0.05 ?
                        `ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤ (H=${stats.h_statistic.toFixed(3)}, p=${stats.p_value.toFixed(4)} < 0.05). ì ì–´ë„ í•˜ë‚˜ì˜ ê·¸ë£¹ì´ ë‹¤ë¥¸ ê·¸ë£¹ê³¼ ìœ ì˜í•˜ê²Œ ë‹¤ë¦…ë‹ˆë‹¤.` :
                        `ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤ (H=${stats.h_statistic.toFixed(3)}, p=${stats.p_value.toFixed(4)} > 0.05).`;
                        
                    // ì‚¬í›„ë¶„ì„ í•„ìš” ì—¬ë¶€
                    if (stats.p_value < 0.05 && stats.n_groups > 2) {
                        result.postHoc = {
                            method: "Dunn's test",
                            comparisons: [],
                            note: 'ë¹„ëª¨ìˆ˜ ì‚¬í›„ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤ (3ê°œ ì´ìƒ ê·¸ë£¹ì—ì„œ ìœ ì˜í•œ ì°¨ì´ ë°œê²¬)'
                        };
                    }
                }
                
            } catch (error) {
                console.error('Non-parametric analysis error:', error);
                return performStatisticalAnalysisFallback();
            }
            
            return result;
        }
        
        function displayAnalysisProgress(analysis) {
            const progressEl = document.getElementById('analysisProgress');
            if (progressEl) {
                progressEl.textContent = analysis.status === 'running' ? 
                    'í†µê³„ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...' : 
                    'ë¶„ì„ ì™„ë£Œ';
            }
        }
        
        // ê²°ê³¼ í‘œì‹œ
        function displayResults() {
            if (!analysisResults.final) return;
            
            const result = analysisResults.final;
            const stats = result.statistics;
            
            let html = `
                <div class="space-y-4">
                    <!-- ì£¼ìš” ê²°ê³¼ -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="font-semibold text-blue-800 mb-3">ğŸ“Š í†µê³„ ë¶„ì„ ê²°ê³¼</h4>
                        <div class="text-lg font-medium mb-2">${result.method}</div>
            `;
            
            // t-ê²€ì • ê²°ê³¼ í‘œì‹œ
            if (stats.tStatistic !== undefined) {
                html += `
                        <div class="grid grid-cols-2 gap-4 mb-3">
                            <div>
                                <div class="text-sm text-gray-600">t-í†µê³„ëŸ‰</div>
                                <div class="font-semibold">${stats.tStatistic.toFixed(3)}</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">ììœ ë„</div>
                                <div class="font-semibold">${stats.df}</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">p-ê°’</div>
                                <div class="font-semibold ${stats.pValue < 0.05 ? 'text-red-600' : 'text-green-600'}">
                                    ${stats.pValue.toFixed(4)} ${stats.pValue < 0.05 ? '(ìœ ì˜)' : '(ë¹„ìœ ì˜)'}
                                </div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">íš¨ê³¼í¬ê¸° (Cohen's d)</div>
                                <div class="font-semibold">${stats.cohensD.toFixed(3)}</div>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded">
                            <div class="text-sm font-medium mb-2">ê·¸ë£¹ë³„ í†µê³„</div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div>
                                    <span class="font-medium">${stats.group1.name}:</span>
                                    n=${stats.group1.n}, M=${stats.group1.mean.toFixed(2)}, SD=${stats.group1.std.toFixed(2)}
                                </div>
                                <div>
                                    <span class="font-medium">${stats.group2.name}:</span>
                                    n=${stats.group2.n}, M=${stats.group2.mean.toFixed(2)}, SD=${stats.group2.std.toFixed(2)}
                                </div>
                            </div>
                            <div class="mt-2">
                                <span class="font-medium">í‰ê·  ì°¨ì´:</span> ${stats.meanDifference.toFixed(2)}
                            </div>
                        </div>
                `;
            }
            // ANOVA ê²°ê³¼ í‘œì‹œ
            else if (stats.fStatistic !== undefined) {
                html += `
                        <div class="grid grid-cols-3 gap-3 mb-3">
                            <div>
                                <div class="text-sm text-gray-600">F-í†µê³„ëŸ‰</div>
                                <div class="font-semibold">${stats.fStatistic.toFixed(3)}</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">ììœ ë„</div>
                                <div class="font-semibold">${stats.dfBetween}, ${stats.dfWithin}</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">p-ê°’</div>
                                <div class="font-semibold ${stats.pValue < 0.05 ? 'text-red-600' : 'text-green-600'}">
                                    ${stats.pValue.toFixed(4)} ${stats.pValue < 0.05 ? '(ìœ ì˜)' : '(ë¹„ìœ ì˜)'}
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded">
                            <div class="text-sm font-medium mb-2">ë¶„ì‚°ë¶„ì„í‘œ</div>
                            <table class="text-xs w-full">
                                <tr class="border-b">
                                    <th class="text-left">ìš”ì¸</th>
                                    <th class="text-right">SS</th>
                                    <th class="text-right">df</th>
                                    <th class="text-right">MS</th>
                                    <th class="text-right">F</th>
                                </tr>
                                <tr>
                                    <td>ì§‘ë‹¨ ê°„</td>
                                    <td class="text-right">${stats.SSbetween.toFixed(2)}</td>
                                    <td class="text-right">${stats.dfBetween}</td>
                                    <td class="text-right">${stats.MSbetween.toFixed(2)}</td>
                                    <td class="text-right">${stats.fStatistic.toFixed(3)}</td>
                                </tr>
                                <tr>
                                    <td>ì§‘ë‹¨ ë‚´</td>
                                    <td class="text-right">${stats.SSwithin.toFixed(2)}</td>
                                    <td class="text-right">${stats.dfWithin}</td>
                                    <td class="text-right">${stats.MSwithin.toFixed(2)}</td>
                                    <td class="text-right">-</td>
                                </tr>
                            </table>
                            <div class="mt-2">
                                <span class="font-medium">íš¨ê³¼í¬ê¸° (Î·Â²):</span> ${stats.etaSquared.toFixed(3)}
                            </div>
                        </div>
                        ${stats.groups ? `
                        <div class="bg-white p-3 rounded mt-2">
                            <div class="text-sm font-medium mb-2">ê·¸ë£¹ë³„ ê¸°ìˆ í†µê³„</div>
                            <div class="space-y-1 text-sm">
                                ${Object.entries(stats.groups).map(([name, stat]) => `
                                    <div><span class="font-medium">${name}:</span> n=${stat.n}, M=${stat.mean.toFixed(2)}, SD=${Math.sqrt(stat.variance).toFixed(2)}</div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                `;
            }
            
            html += `
                    </div>
                    
                    <!-- í•´ì„ -->
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <h5 class="font-semibold text-green-800 mb-2">ğŸ’¡ ê²°ê³¼ í•´ì„</h5>
                        <p class="text-sm text-green-700">${result.interpretation}</p>
                    </div>
                    
                    <!-- ì‚¬í›„ë¶„ì„ í•„ìš” ì—¬ë¶€ -->
                    ${result.postHoc ? `
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <h5 class="font-semibold text-yellow-800 mb-2">ğŸ“Œ ì‚¬í›„ë¶„ì„</h5>
                        <p class="text-sm text-yellow-700">${result.postHoc.note}</p>
                        <p class="text-xs text-yellow-600 mt-1">ì¶”ì²œ ë°©ë²•: ${result.postHoc.method}</p>
                        <button onclick="performPostHocAnalysis()" class="mt-2 px-3 py-1 bg-yellow-600 text-white text-sm rounded hover:bg-yellow-700">
                            ì‚¬í›„ë¶„ì„ ì‹¤í–‰
                        </button>
                    </div>
                    ` : ''}
                    
                    <!-- ì¶”ê°€ ë¶„ì„ ì˜µì…˜ -->
                    <div id="nextAnalysisOptions" class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                        <h5 class="font-semibold text-indigo-800 mb-3">ğŸ” ì¶”ê°€ ë¶„ì„ ì˜µì…˜</h5>
                        <div id="analysisOptionsContent"></div>
                    </div>
                    
                    <!-- ì‹œê°í™” í”Œë ˆì´ìŠ¤í™€ë” -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h5 class="font-semibold mb-2">ğŸ“ˆ ì‹œê°í™”</h5>
                        <div class="h-48 bg-white rounded flex items-center justify-center text-gray-400">
                            [ì°¨íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤]
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('analysisResults').innerHTML = html;
            
            // ì¶”ê°€ ë¶„ì„ ì˜µì…˜ ìƒì„±
            generateNextAnalysisOptions(result);
            
            // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ í‘œì‹œ
            const exportBtn = document.getElementById('exportBtn');
            if (exportBtn) {
                exportBtn.style.display = 'inline-block';
            }
            
            // ì„¤ëª… ë°•ìŠ¤ í‘œì‹œ
            document.getElementById('step6Explanation').classList.remove('hidden');
            
            // ë¶„ì„ ê²°ê³¼ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ì¶”í›„ ë‚´ë³´ë‚´ê¸°ìš©)
            saveAnalysisRecord(result);
        }
        
        // íš¨ê³¼ í¬ê¸° ê³„ì‚° í•¨ìˆ˜ë“¤
        function calculateEffectSizes(data, groups, testType) {
            const effectSizes = {};
            
            if (testType === 'ttest' || testType === 'paired_test') {
                // Cohen's d ê³„ì‚°
                const group1 = data.filter((_, i) => groups[i] === groups[0]);
                const group2 = data.filter((_, i) => groups[i] !== groups[0]);
                
                const mean1 = group1.reduce((a, b) => a + b, 0) / group1.length;
                const mean2 = group2.reduce((a, b) => a + b, 0) / group2.length;
                
                const var1 = group1.reduce((a, b) => a + Math.pow(b - mean1, 2), 0) / (group1.length - 1);
                const var2 = group2.reduce((a, b) => a + Math.pow(b - mean2, 2), 0) / (group2.length - 1);
                
                // Pooled standard deviation
                const pooledSD = Math.sqrt(((group1.length - 1) * var1 + (group2.length - 1) * var2) / 
                                          (group1.length + group2.length - 2));
                
                effectSizes.cohensD = (mean1 - mean2) / pooledSD;
                
                // Hedges' g (ì†Œí‘œë³¸ ë³´ì • - ì˜¬ë°”ë¥¸ ê³µì‹)
                const df = group1.length + group2.length - 2;
                const correctionFactor = 1 - (3 / (4 * df - 1));
                effectSizes.hedgesG = effectSizes.cohensD * correctionFactor;
                
                // Glass's delta
                effectSizes.glassDelta = (mean1 - mean2) / Math.sqrt(var2);
                
                // í•´ì„
                const d = Math.abs(effectSizes.cohensD);
                effectSizes.interpretation = 
                    d < 0.2 ? 'ë§¤ìš° ì‘ì€ íš¨ê³¼' :
                    d < 0.5 ? 'ì‘ì€ íš¨ê³¼' :
                    d < 0.8 ? 'ì¤‘ê°„ íš¨ê³¼' : 'í° íš¨ê³¼';
                    
            } else if (testType === 'anova' || testType === 'kruskal') {
                // Eta-squared ê³„ì‚° (ANOVA)
                const grandMean = data.reduce((a, b) => a + b, 0) / data.length;
                const totalSS = data.reduce((a, b) => a + Math.pow(b - grandMean, 2), 0);
                
                const groupMeans = {};
                const groupCounts = {};
                for (let i = 0; i < data.length; i++) {
                    const group = groups[i];
                    if (!groupMeans[group]) {
                        groupMeans[group] = [];
                        groupCounts[group] = 0;
                    }
                    groupMeans[group].push(data[i]);
                    groupCounts[group]++;
                }
                
                let betweenSS = 0;
                for (const [group, values] of Object.entries(groupMeans)) {
                    const groupMean = values.reduce((a, b) => a + b, 0) / values.length;
                    betweenSS += values.length * Math.pow(groupMean - grandMean, 2);
                }
                
                effectSizes.etaSquared = betweenSS / totalSS;
                effectSizes.partialEtaSquared = betweenSS / (betweenSS + (totalSS - betweenSS));
                
                // Omega-squared (ë” ì •í™•í•œ íš¨ê³¼ í¬ê¸°)
                const dfBetween = Object.keys(groupMeans).length - 1;
                const dfWithin = data.length - Object.keys(groupMeans).length;
                const msBetween = betweenSS / dfBetween;
                const msWithin = (totalSS - betweenSS) / dfWithin;
                
                effectSizes.omegaSquared = (betweenSS - dfBetween * msWithin) / (totalSS + msWithin);
                
                // í•´ì„
                const eta = effectSizes.etaSquared;
                effectSizes.interpretation = 
                    eta < 0.01 ? 'ë§¤ìš° ì‘ì€ íš¨ê³¼' :
                    eta < 0.06 ? 'ì‘ì€ íš¨ê³¼' :
                    eta < 0.14 ? 'ì¤‘ê°„ íš¨ê³¼' : 'í° íš¨ê³¼';
            }
            
            return effectSizes;
        }
        
        // pê°’ ë³´ì • ë°©ë²•ë“¤
        function adjustPValues(pValues, method = 'bonferroni') {
            const n = pValues.length;
            let adjusted = [...pValues];
            
            switch(method) {
                case 'bonferroni':
                    // Bonferroni ë³´ì •
                    adjusted = pValues.map(p => Math.min(p * n, 1));
                    break;
                    
                case 'holm':
                    // Holm-Bonferroni ë³´ì • (ë‹¨ê³„ì  ë°©ë²•)
                    const sorted = pValues.map((p, i) => ({p, i})).sort((a, b) => a.p - b.p);
                    for (let i = 0; i < sorted.length; i++) {
                        sorted[i].adjusted = Math.min(sorted[i].p * (n - i), 1);
                        // ì´ì „ ê°’ë³´ë‹¤ ì‘ì§€ ì•Šë„ë¡ ë³´ì¥
                        if (i > 0 && sorted[i].adjusted < sorted[i-1].adjusted) {
                            sorted[i].adjusted = sorted[i-1].adjusted;
                        }
                    }
                    // ì›ë˜ ìˆœì„œë¡œ ë³µì›
                    sorted.forEach(item => adjusted[item.i] = item.adjusted);
                    break;
                    
                case 'hochberg':
                    // Hochberg ë³´ì • (ì—­ìˆœ ë°©ë²•)
                    const sortedDesc = pValues.map((p, i) => ({p, i})).sort((a, b) => b.p - a.p);
                    for (let i = 0; i < sortedDesc.length; i++) {
                        sortedDesc[i].adjusted = Math.min(sortedDesc[i].p * (i + 1), 1);
                        // ì´ì „ ê°’ë³´ë‹¤ í¬ì§€ ì•Šë„ë¡ ë³´ì¥
                        if (i > 0 && sortedDesc[i].adjusted > sortedDesc[i-1].adjusted) {
                            sortedDesc[i].adjusted = sortedDesc[i-1].adjusted;
                        }
                    }
                    sortedDesc.forEach(item => adjusted[item.i] = item.adjusted);
                    break;
                    
                case 'bh': // Benjamini-Hochberg
                case 'fdr':
                    // False Discovery Rate ì œì–´
                    const sortedBH = pValues.map((p, i) => ({p, i})).sort((a, b) => a.p - b.p);
                    for (let i = sortedBH.length - 1; i >= 0; i--) {
                        const adj = Math.min(sortedBH[i].p * n / (i + 1), 1);
                        sortedBH[i].adjusted = i === sortedBH.length - 1 ? adj : 
                                               Math.min(adj, sortedBH[i + 1].adjusted);
                    }
                    sortedBH.forEach(item => adjusted[item.i] = item.adjusted);
                    break;
                    
                default:
                    // ë³´ì • ì—†ìŒ
                    break;
            }
            
            return adjusted;
        }
        
        // ê²€ì •ë ¥ ê³„ì‚° (post-hoc)
        function calculatePower(effectSize, sampleSize, alpha = 0.05) {
            // ê°„ë‹¨í•œ ê·¼ì‚¬ì¹˜ ê³„ì‚° (Cohen's d ê¸°ì¤€)
            const ncp = effectSize * Math.sqrt(sampleSize / 2); // Non-centrality parameter
            const criticalZ = 1.96; // alpha = 0.05ì¼ ë•Œ
            
            // ë¹„ì¤‘ì‹¬ t-ë¶„í¬ì˜ ëˆ„ì ë¶„í¬í•¨ìˆ˜ ê·¼ì‚¬
            // ì •í™•í•œ ê³„ì‚°ì€ scipy.stats í•„ìš”
            const power = 1 - normalCDF((criticalZ - ncp) / 1);
            
            return {
                power: power,
                interpretation: power < 0.5 ? 'ë§¤ìš° ë‚®ì€ ê²€ì •ë ¥' :
                               power < 0.8 ? 'ë‚®ì€ ê²€ì •ë ¥' :
                               power < 0.95 ? 'ì ì ˆí•œ ê²€ì •ë ¥' : 'ë†’ì€ ê²€ì •ë ¥',
                recommendedN: power < 0.8 ? Math.ceil(sampleSize * Math.pow(0.8/power, 2)) : null
            };
        }
        
        // ì •ê·œë¶„í¬ CDF ê·¼ì‚¬
        function normalCDF(z) {
            const a1 = 0.254829592;
            const a2 = -0.284496736;
            const a3 = 1.421413741;
            const a4 = -1.453152027;
            const a5 = 1.061405429;
            const p = 0.3275911;
            
            const sign = z >= 0 ? 1 : -1;
            z = Math.abs(z);
            
            const t = 1.0 / (1.0 + p * z);
            const t2 = t * t;
            const t3 = t2 * t;
            const t4 = t3 * t;
            const t5 = t4 * t;
            
            const y = 1.0 - (((((a5 * t5 + a4 * t4) + a3 * t3) + a2 * t2) + a1 * t) * Math.exp(-z * z / 2));
            
            return 0.5 * (1 + sign * y);
        }
        
        // ì¶”ê°€ ë¶„ì„ ì˜µì…˜ ìƒì„±
        function generateNextAnalysisOptions(result) {
            const stats = result.statistics;
            let optionsHtml = '<div class="space-y-3">';
            
            // p-ê°’ì— ë”°ë¥¸ ì˜µì…˜ ì œê³µ
            if (stats.pValue < 0.05) {
                // ìœ ì˜í•œ ê²½ìš°ì˜ ì˜µì…˜
                optionsHtml += `
                    <div class="bg-white p-3 rounded border border-indigo-200">
                        <h6 class="font-medium text-indigo-700 mb-2">âœ… ìœ ì˜í•œ ì°¨ì´ ë°œê²¬ - ë‹¤ìŒ ë‹¨ê³„</h6>
                        <div class="space-y-2 text-sm">
                `;
                
                // íš¨ê³¼ í¬ê¸° ë¶„ì„
                optionsHtml += `
                    <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                        <input type="checkbox" class="mt-1 mr-2" value="effectSize">
                        <div>
                            <div class="font-medium">íš¨ê³¼ í¬ê¸° ìƒì„¸ ë¶„ì„</div>
                            <div class="text-xs text-gray-600">Cohen's d, Glass's delta, ì‹ ë¢°êµ¬ê°„ ê³„ì‚°</div>
                        </div>
                    </label>
                `;
                
                // ê²€ì •ë ¥ ë¶„ì„
                optionsHtml += `
                    <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                        <input type="checkbox" class="mt-1 mr-2" value="power">
                        <div>
                            <div class="font-medium">ì‚¬í›„ ê²€ì •ë ¥ ë¶„ì„</div>
                            <div class="text-xs text-gray-600">ê´€ì°°ëœ íš¨ê³¼ì— ëŒ€í•œ ê²€ì •ë ¥ ê³„ì‚°</div>
                        </div>
                    </label>
                `;
                
                // ì˜ˆì¸¡ ëª¨ë¸
                if (stats.groups && Object.keys(stats.groups).length >= 2) {
                    optionsHtml += `
                        <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                            <input type="checkbox" class="mt-1 mr-2" value="prediction">
                            <div>
                                <div class="font-medium">ì˜ˆì¸¡ ëª¨ë¸ êµ¬ì¶•</div>
                                <div class="text-xs text-gray-600">ê·¸ë£¹ ì†Œì† ì˜ˆì¸¡ì„ ìœ„í•œ íŒë³„ë¶„ì„</div>
                            </div>
                        </label>
                    `;
                }
                
                optionsHtml += '</div></div>';
                
            } else {
                // ìœ ì˜í•˜ì§€ ì•Šì€ ê²½ìš°ì˜ ì˜µì…˜
                optionsHtml += `
                    <div class="bg-white p-3 rounded border border-indigo-200">
                        <h6 class="font-medium text-indigo-700 mb-2">âŒ ìœ ì˜í•œ ì°¨ì´ ì—†ìŒ - ëŒ€ì•ˆ ë¶„ì„</h6>
                        <div class="space-y-2 text-sm">
                `;
                
                // ë™ë“±ì„± ê²€ì •
                optionsHtml += `
                    <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                        <input type="checkbox" class="mt-1 mr-2" value="equivalence">
                        <div>
                            <div class="font-medium">ë™ë“±ì„± ê²€ì • (TOST)</div>
                            <div class="text-xs text-gray-600">ê·¸ë£¹ ê°„ ì‹¤ì œì  ë™ë“±ì„± í™•ì¸</div>
                        </div>
                    </label>
                `;
                
                // ê²€ì •ë ¥ ë¶„ì„
                optionsHtml += `
                    <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                        <input type="checkbox" class="mt-1 mr-2" value="powerCalc">
                        <div>
                            <div class="font-medium">í•„ìš” í‘œë³¸ í¬ê¸° ê³„ì‚°</div>
                            <div class="text-xs text-gray-600">ì›í•˜ëŠ” ê²€ì •ë ¥ ë‹¬ì„±ì„ ìœ„í•œ n ê³„ì‚°</div>
                        </div>
                    </label>
                `;
                
                // ë² ì´ì§€ì•ˆ ë¶„ì„
                optionsHtml += `
                    <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                        <input type="checkbox" class="mt-1 mr-2" value="bayesian">
                        <div>
                            <div class="font-medium">ë² ì´ì§€ì•ˆ ë¶„ì„</div>
                            <div class="text-xs text-gray-600">ë² ì´ì¦ˆ ì¸ìë¥¼ í†µí•œ ê·€ë¬´ê°€ì„¤ ì§€ì§€ ì •ë„ í™•ì¸</div>
                        </div>
                    </label>
                `;
                
                optionsHtml += '</div></div>';
            }
            
            // ì¼ë°˜ ì˜µì…˜ (í•­ìƒ ì œê³µ)
            optionsHtml += `
                <div class="bg-white p-3 rounded border border-indigo-200">
                    <h6 class="font-medium text-indigo-700 mb-2">ğŸ“Š ì¶”ê°€ íƒìƒ‰ ì˜µì…˜</h6>
                    <div class="space-y-2 text-sm">
                        <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                            <input type="checkbox" class="mt-1 mr-2" value="outlier">
                            <div>
                                <div class="font-medium">ì´ìƒì¹˜ ì˜í–¥ ë¶„ì„</div>
                                <div class="text-xs text-gray-600">ì´ìƒì¹˜ ì œê±° ì „í›„ ê²°ê³¼ ë¹„êµ</div>
                            </div>
                        </label>
                        <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                            <input type="checkbox" class="mt-1 mr-2" value="bootstrap">
                            <div>
                                <div class="font-medium">ë¶€íŠ¸ìŠ¤íŠ¸ë© ì‹ ë¢°êµ¬ê°„</div>
                                <div class="text-xs text-gray-600">ë¹„ëª¨ìˆ˜ì  ì‹ ë¢°êµ¬ê°„ ì¶”ì •</div>
                            </div>
                        </label>
                        <label class="flex items-start cursor-pointer hover:bg-indigo-50 p-2 rounded">
                            <input type="checkbox" class="mt-1 mr-2" value="sensitivity">
                            <div>
                                <div class="font-medium">ë¯¼ê°ë„ ë¶„ì„</div>
                                <div class="text-xs text-gray-600">ë‹¤ë¥¸ ê²€ì • ë°©ë²• ì ìš© ì‹œ ê²°ê³¼ ë¹„êµ</div>
                            </div>
                        </label>
                    </div>
                </div>
            `;
            
            optionsHtml += `
                <button onclick="executeSelectedAnalyses()" class="w-full mt-3 px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
                    ì„ íƒí•œ ë¶„ì„ ì‹¤í–‰
                </button>
            </div>`;
            
            document.getElementById('analysisOptionsContent').innerHTML = optionsHtml;
        }
        
        // ì‚¬í›„ë¶„ì„ ì‹¤í–‰
        async function performPostHocAnalysis() {
            const result = analysisResults.final;
            if (!result.postHoc) {
                alert('ì‚¬í›„ë¶„ì„ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì‚¬í›„ë¶„ì„ ì¤€ë¹„
            const postHocResult = {
                method: result.postHoc.method,
                comparisons: [],
                timestamp: new Date().toISOString()
            };
            
            // Pyodideê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!window.pyodide || !pyodideReady) {
                console.warn('Pyodide not ready for post-hoc analysis');
                // Fallback ì²˜ë¦¬
                displayPostHocResults(postHocResult);
                return;
            }
            
            try {
                // ë°ì´í„° ì¤€ë¹„
                const validation = analysisResults.validation;
                const numericColumns = validation.numericColumns || [];
                const groupColumns = validation.groupColumns || [];
                const dependentVar = numericColumns[0];
                const groupVar = groupColumns[0];
                const groups = [...new Set(currentData[groupVar])];
                
                // ê·¸ë£¹ë³„ ë°ì´í„° ì¤€ë¹„
                const groupDataArrays = {};
                for (const group of groups) {
                    groupDataArrays[group] = [];
                }
                
                for (let i = 0; i < currentData[groupVar].length; i++) {
                    const value = parseFloat(currentData[dependentVar][i]);
                    const group = currentData[groupVar][i];
                    if (!isNaN(value) && groupDataArrays[group]) {
                        groupDataArrays[group].push(value);
                    }
                }
                
                // Pythonìœ¼ë¡œ ì‹¤ì œ ì‚¬í›„ë¶„ì„ ìˆ˜í–‰
                const pythonResult = await window.pyodide.runPythonAsync(`
                    import numpy as np
                    from scipy import stats
                    import json
                    from itertools import combinations
                    
                    # ê·¸ë£¹ ë°ì´í„°
                    groups_data = ${JSON.stringify(groupDataArrays)}
                    group_names = list(groups_data.keys())
                    group_arrays = [np.array(groups_data[name]) for name in group_names]
                    method = "${result.postHoc.method}"
                    
                    comparisons = []
                    
                    if method == "Tukey HSD":
                        # Tukey HSD ìˆ˜ë™ êµ¬í˜„ (scipy 0.24.1ì—ëŠ” ì—†ìŒ)
                        # MSE ê³„ì‚°
                        all_data = np.concatenate(group_arrays)
                        grand_mean = np.mean(all_data)
                        n_total = len(all_data)
                        k = len(group_names)
                        
                        # Within-group variance
                        ss_within = sum((len(arr)-1) * np.var(arr, ddof=1) for arr in group_arrays)
                        df_within = n_total - k
                        mse = ss_within / df_within
                        
                        # ëª¨ë“  ìŒë³„ ë¹„êµ
                        for i, j in combinations(range(k), 2):
                            name1, name2 = group_names[i], group_names[j]
                            group1, group2 = group_arrays[i], group_arrays[j]
                            n1, n2 = len(group1), len(group2)
                            mean1, mean2 = np.mean(group1), np.mean(group2)
                            
                            # Tukey's HSD
                            mean_diff = mean1 - mean2
                            se = np.sqrt(mse * (1/n1 + 1/n2) / 2)
                            q_stat = abs(mean_diff) / se
                            
                            # Critical value (approximate)
                            # q_crit â‰ˆ 2.8 for Î±=0.05, k=3, df=âˆ
                            # More accurate would require studentized range distribution
                            q_crit = 2.8 + 0.5 * (k - 3)  # ê·¼ì‚¬ê°’
                            p_value = 0.01 if q_stat > q_crit else 0.10
                            
                            # 95% CI
                            margin = q_crit * se
                            ci_lower = mean_diff - margin
                            ci_upper = mean_diff + margin
                            
                            comparisons.append({
                                "group1": name1,
                                "group2": name2,
                                "meanDifference": float(abs(mean_diff)),
                                "pValue": float(p_value),
                                "significant": p_value < 0.05,
                                "confidenceInterval": [float(ci_lower), float(ci_upper)],
                                "qStatistic": float(q_stat)
                            })
                            
                    elif method == "Games-Howell":
                        # Games-Howell (unequal variances)
                        for i, j in combinations(range(len(group_names)), 2):
                            name1, name2 = group_names[i], group_names[j]
                            group1, group2 = group_arrays[i], group_arrays[j]
                            n1, n2 = len(group1), len(group2)
                            mean1, mean2 = np.mean(group1), np.mean(group2)
                            var1, var2 = np.var(group1, ddof=1), np.var(group2, ddof=1)
                            
                            # Games-Howell statistic
                            mean_diff = mean1 - mean2
                            se = np.sqrt(var1/n1 + var2/n2)
                            t_stat = abs(mean_diff) / se
                            
                            # Welch's degrees of freedom
                            df = (var1/n1 + var2/n2)**2 / ((var1/n1)**2/(n1-1) + (var2/n2)**2/(n2-1))
                            
                            # p-value (two-tailed)
                            p_value = 2 * (1 - stats.t.cdf(abs(t_stat), df))
                            
                            # 95% CI
                            t_crit = stats.t.ppf(0.975, df)
                            margin = t_crit * se
                            ci_lower = mean_diff - margin
                            ci_upper = mean_diff + margin
                            
                            comparisons.append({
                                "group1": name1,
                                "group2": name2,
                                "meanDifference": float(abs(mean_diff)),
                                "pValue": float(p_value),
                                "significant": p_value < 0.05,
                                "confidenceInterval": [float(ci_lower), float(ci_upper)],
                                "tStatistic": float(t_stat),
                                "df": float(df)
                            })
                            
                    elif method == "Bonferroni":
                        # Bonferroni correction
                        n_comparisons = len(list(combinations(group_names, 2)))
                        alpha_corrected = 0.05 / n_comparisons
                        
                        for i, j in combinations(range(len(group_names)), 2):
                            name1, name2 = group_names[i], group_names[j]
                            group1, group2 = group_arrays[i], group_arrays[j]
                            
                            # Regular t-test
                            t_stat, p_value = stats.ttest_ind(group1, group2)
                            
                            # Adjusted significance
                            p_adjusted = min(p_value * n_comparisons, 1.0)
                            
                            mean_diff = np.mean(group1) - np.mean(group2)
                            
                            comparisons.append({
                                "group1": name1,
                                "group2": name2,
                                "meanDifference": float(abs(mean_diff)),
                                "pValue": float(p_value),
                                "pAdjusted": float(p_adjusted),
                                "significant": p_adjusted < 0.05,
                                "tStatistic": float(t_stat)
                            })
                            
                    elif method == "Dunn's test":
                        # Dunn's test for Kruskal-Wallis follow-up
                        # Combine all data and rank
                        all_data = np.concatenate(group_arrays)
                        all_groups = []
                        for i, arr in enumerate(group_arrays):
                            all_groups.extend([group_names[i]] * len(arr))
                        
                        ranks = stats.rankdata(all_data)
                        
                        # Mean ranks for each group
                        mean_ranks = {}
                        for name in group_names:
                            group_ranks = [ranks[i] for i, g in enumerate(all_groups) if g == name]
                            mean_ranks[name] = np.mean(group_ranks)
                        
                        n = len(all_data)
                        
                        for i, j in combinations(range(len(group_names)), 2):
                            name1, name2 = group_names[i], group_names[j]
                            n1, n2 = len(group_arrays[i]), len(group_arrays[j])
                            
                            # Dunn's z-statistic
                            mean_rank_diff = mean_ranks[name1] - mean_ranks[name2]
                            se = np.sqrt((n * (n + 1) / 12) * (1/n1 + 1/n2))
                            z_stat = abs(mean_rank_diff) / se
                            
                            # p-value (two-tailed)
                            p_value = 2 * (1 - stats.norm.cdf(abs(z_stat)))
                            
                            comparisons.append({
                                "group1": name1,
                                "group2": name2,
                                "meanRankDifference": float(abs(mean_rank_diff)),
                                "pValue": float(p_value),
                                "significant": p_value < 0.05,
                                "zStatistic": float(z_stat)
                            })
                    
                    result = {
                        "method": method,
                        "comparisons": comparisons
                    }
                    json.dumps(result)
                `);
                
                const pythonData = JSON.parse(pythonResult);
                postHocResult.comparisons = pythonData.comparisons;
                
            } catch (error) {
                console.error('Post-hoc analysis error:', error);
            }
            
            // ê²°ê³¼ í‘œì‹œ
            displayPostHocResults(postHocResult);
        }
        
        // ì‚¬í›„ë¶„ì„ ê²°ê³¼ í‘œì‹œ
        function displayPostHocResults(postHocResult) {
            let html = `
                <div class="mt-4 p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <h5 class="font-semibold text-orange-800 mb-3">ğŸ“Š ì‚¬í›„ë¶„ì„ ê²°ê³¼: ${postHocResult.method}</h5>
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left">ë¹„êµ</th>
                                <th class="text-right">í‰ê· ì°¨</th>
                                <th class="text-right">p-ê°’</th>
                                <th class="text-center">ìœ ì˜ì„±</th>
                                <th class="text-right">95% CI</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            for (const comp of postHocResult.comparisons) {
                html += `
                    <tr class="border-b">
                        <td>${comp.group1} - ${comp.group2}</td>
                        <td class="text-right">${comp.meanDifference.toFixed(3)}</td>
                        <td class="text-right ${comp.significant ? 'text-red-600 font-semibold' : ''}">${comp.pValue.toFixed(4)}</td>
                        <td class="text-center">${comp.significant ? 'âœ“' : '-'}</td>
                        <td class="text-right">[${comp.confidenceInterval[0].toFixed(2)}, ${comp.confidenceInterval[1].toFixed(2)}]</td>
                    </tr>
                `;
            }
            
            html += `
                        </tbody>
                    </table>
                    <p class="text-xs text-orange-600 mt-2">
                        * p-ê°’ì€ ë‹¤ì¤‘ë¹„êµì— ëŒ€í•´ ì¡°ì •ë˜ì—ˆìŠµë‹ˆë‹¤ (${postHocResult.method} ë°©ë²•)
                    </p>
                </div>
            `;
            
            // ê¸°ì¡´ ì‚¬í›„ë¶„ì„ ì„¹ì…˜ ë’¤ì— ì¶”ê°€
            const postHocDiv = document.querySelector('.bg-yellow-50');
            if (postHocDiv) {
                postHocDiv.insertAdjacentHTML('afterend', html);
                postHocDiv.querySelector('button').disabled = true;
                postHocDiv.querySelector('button').textContent = 'ì‚¬í›„ë¶„ì„ ì™„ë£Œ';
            }
            
            // ê²°ê³¼ ì €ì¥
            analysisResults.postHocAnalysis = postHocResult;
            saveAnalysisRecord(analysisResults);
        }
        
        // ì„ íƒëœ ì¶”ê°€ ë¶„ì„ ì‹¤í–‰
        function executeSelectedAnalyses() {
            const checkboxes = document.querySelectorAll('#analysisOptionsContent input[type="checkbox"]:checked');
            const selectedAnalyses = Array.from(checkboxes).map(cb => cb.value);
            
            if (selectedAnalyses.length === 0) {
                alert('ì‹¤í–‰í•  ë¶„ì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('ì„ íƒëœ ë¶„ì„:', selectedAnalyses);
            alert(`ë‹¤ìŒ ë¶„ì„ì´ ì‹¤í–‰ë©ë‹ˆë‹¤:\n${selectedAnalyses.join(', ')}\n\n(ì‹¤ì œ êµ¬í˜„ì€ ì¶”í›„ ê°œë°œ ì˜ˆì •)`);
        }
        
        // ë¶„ì„ ê¸°ë¡ ì €ì¥
        function saveAnalysisRecord(data) {
            const record = {
                timestamp: new Date().toISOString(),
                data: currentData,
                validation: analysisResults.validation,
                assumptions: analysisResults.assumptions,
                method: analysisResults.method,
                results: data,
                postHoc: analysisResults.postHocAnalysis || null
            };
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const records = JSON.parse(localStorage.getItem('analysisRecords') || '[]');
            records.push(record);
            localStorage.setItem('analysisRecords', JSON.stringify(records));
            
            // íŒŒì¼ë¡œë„ ìë™ ì €ì¥ (optional)
            downloadAnalysisReport(record);
        }
        
        // ë¶„ì„ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
        function downloadAnalysisReport(record) {
            const report = `
# í†µê³„ ë¶„ì„ ë³´ê³ ì„œ
ìƒì„± ì‹œê°„: ${new Date(record.timestamp).toLocaleString('ko-KR')}

## 1. ë°ì´í„° ê²€ì¦
- í–‰ ìˆ˜: ${record.validation.rows}
- ì—´ ìˆ˜: ${record.validation.columns}
- ì—°ì†í˜• ë³€ìˆ˜: ${record.validation.numericColumns.join(', ')}
- ê·¸ë£¹ ë³€ìˆ˜: ${record.validation.groupColumns.join(', ')}
- í’ˆì§ˆ ë¬¸ì œ: ${record.validation.issues.length === 0 ? 'ì—†ìŒ' : record.validation.issues.join(', ')}

## 2. í†µê³„ì  ê°€ì • ê²€ì •
### ì •ê·œì„± ê²€ì •
${record.assumptions.normality.map(n => `- ${n.variable}: ${n.interpretation} (p=${n.pValue.toFixed(4)})`).join('\n')}

### ë“±ë¶„ì‚°ì„± ê²€ì •
${record.assumptions.homogeneity.map(h => `- ${h.variable} by ${h.groupVariable}: ${h.interpretation}`).join('\n') || 'í•´ë‹¹ ì—†ìŒ'}

## 3. ë¶„ì„ ë°©ë²•
- ì„ íƒëœ ë°©ë²•: ${record.method.primary.name}
- ì„ íƒ ì´ìœ : ${record.method.reasoning.join(', ')}

## 4. ë¶„ì„ ê²°ê³¼
- ê²€ì • í†µê³„ëŸ‰: ${JSON.stringify(record.results.statistics, null, 2)}
- í•´ì„: ${record.results.interpretation}

## 5. ì‚¬í›„ë¶„ì„
${record.postHoc ? JSON.stringify(record.postHoc, null, 2) : 'í•´ë‹¹ ì—†ìŒ'}

---
ì´ ë³´ê³ ì„œëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
            `;
            
            // ì½˜ì†”ì— ì¶œë ¥ (ì‹¤ì œë¡œëŠ” íŒŒì¼ ë‹¤ìš´ë¡œë“œë¡œ êµ¬í˜„)
            console.log('=== ë¶„ì„ ë³´ê³ ì„œ ===');
            console.log(report);
            
            // ì‹¤ì œ íŒŒì¼ ë‹¤ìš´ë¡œë“œëŠ” ë‚˜ì¤‘ì— êµ¬í˜„
            // const blob = new Blob([report], { type: 'text/markdown' });
            // const url = URL.createObjectURL(blob);
            // const a = document.createElement('a');
            // a.href = url;
            // a.download = `analysis_report_${Date.now()}.md`;
            // a.click();
        }
        
        // ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
        function exportResults() {
            // ë‚´ë³´ë‚´ê¸° ì˜µì…˜ ëª¨ë‹¬ í‘œì‹œ
            showExportOptions();
        }
        
        // ë‚´ë³´ë‚´ê¸° ì˜µì…˜ ëª¨ë‹¬ í‘œì‹œ
        function showExportOptions() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.id = 'exportModal';
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md">
                    <h3 class="text-xl font-bold mb-4">ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</h3>
                    <p class="text-sm text-gray-600 mb-4">ë¶„ì„ ê²°ê³¼ë¥¼ ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ë‚´ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                    
                    <div class="space-y-3">
                        <button onclick="exportToMarkdown()" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center justify-center">
                            ğŸ“ Markdown (.md) - ë¬¸ì„œ í¸ì§‘ìš©
                        </button>
                        
                        <button onclick="exportToPDF()" class="w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 flex items-center justify-center">
                            ğŸ“„ PDF - ë³´ê³ ì„œ ì¸ì‡„ìš©
                        </button>
                        
                        <button onclick="exportToExcel()" class="w-full bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 flex items-center justify-center">
                            ğŸ“Š Excel (.xlsx) - ë°ì´í„° ì¬ë¶„ì„ìš©
                        </button>
                        
                        <button onclick="closeExportModal()" class="w-full bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // ë‚´ë³´ë‚´ê¸° ëª¨ë‹¬ ë‹«ê¸°
        function closeExportModal() {
            const modal = document.getElementById('exportModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ë¶„ì„ ì´ˆê¸°í™”
        function resetAnalysis() {
            // ë°ì´í„°ì™€ ê²°ê³¼ ì´ˆê¸°í™”
            currentData = null;
            analysisResults = {};
            
            // UI ì´ˆê¸°í™”
            document.getElementById('dropZone').classList.remove('hidden');
            document.getElementById('filePreview').classList.add('hidden');
            document.getElementById('fileInput').value = '';
            document.getElementById('proceedBtn1').disabled = true;
            
            // ê° ë‹¨ê³„ ê²°ê³¼ ì˜ì—­ ì´ˆê¸°í™”
            document.getElementById('dataValidation').innerHTML = '';
            document.getElementById('normalityResults').innerHTML = '';
            document.getElementById('homogeneityResults').innerHTML = '';
            document.getElementById('methodRecommendation').innerHTML = '';
            document.getElementById('analysisResults').innerHTML = '';
            
            // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            const exportBtn = document.getElementById('exportBtn');
            if (exportBtn) {
                exportBtn.style.display = 'none';
            }
            
            // 1ë‹¨ê³„ë¡œ ì´ë™
            moveToStep(1);
        }
        
        // ë‹¤í¬ ëª¨ë“œ í† ê¸€
        const darkModeToggle = document.getElementById('darkModeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        
        // ì €ì¥ëœ í…Œë§ˆ ë¶ˆëŸ¬ì˜¤ê¸°
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
        
        darkModeToggle?.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });
        
        function updateThemeIcon(theme) {
            if (theme === 'dark') {
                sunIcon?.classList.remove('hidden');
                moonIcon?.classList.add('hidden');
            } else {
                sunIcon?.classList.add('hidden');
                moonIcon?.classList.remove('hidden');
            }
        }
        
        // ë°ì´í„° ì €ì¥/ë³µêµ¬ ê¸°ëŠ¥
        function saveProgress() {
            const progressData = {
                currentStep: currentStep,
                currentData: currentData,
                analysisResults: analysisResults,
                autoProgress: autoProgress,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('analysisProgress', JSON.stringify(progressData));
            // ì‹œê°ì  í”¼ë“œë°± ì œê±° - ìë™ ì €ì¥ì€ ì¡°ìš©íˆ ì§„í–‰
        }
        
        function loadProgress() {
            const saved = localStorage.getItem('analysisProgress');
            if (saved) {
                const progressData = JSON.parse(saved);
                currentStep = progressData.currentStep;
                currentData = progressData.currentData;
                analysisResults = progressData.analysisResults;
                autoProgress = progressData.autoProgress;
                
                // UI ë³µêµ¬
                document.getElementById('autoProgress').checked = autoProgress;
                moveToStep(currentStep);
                
                // ë³µêµ¬ ë©”ì‹œì§€
                const msg = document.createElement('div');
                msg.className = 'fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                msg.innerHTML = `ì´ì „ ì„¸ì…˜ ë³µêµ¬ (${new Date(progressData.timestamp).toLocaleString()})`;
                document.body.appendChild(msg);
                setTimeout(() => msg.remove(), 3000);
            }
        }
        
        // ì§„í–‰ ìƒí™© ë‚´ë³´ë‚´ê¸°
        // Markdownìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°
        function exportToMarkdown() {
            closeExportModal();
            
            const date = new Date().toLocaleString('ko-KR');
            const results = analysisResults;
            
            let markdown = `# í†µê³„ ë¶„ì„ ë³´ê³ ì„œ\n\n`;
            markdown += `**ìƒì„±ì¼ì‹œ**: ${date}\n`;
            markdown += `**í”Œë«í¼**: êµ­ë¦½ìˆ˜ì‚°ê³¼í•™ì› í†µê³„ ë¶„ì„ í”Œë«í¼\n\n`;
            markdown += `---\n\n`;
            
            // 1. ë°ì´í„° ìš”ì•½
            markdown += `## 1. ë°ì´í„° ìš”ì•½\n\n`;
            if (currentData) {
                const columns = Object.keys(currentData);
                const rows = currentData[columns[0]]?.length || 0;
                markdown += `- **ë³€ìˆ˜ ìˆ˜**: ${columns.length}ê°œ\n`;
                markdown += `- **ê´€ì¸¡ì¹˜ ìˆ˜**: ${rows}ê°œ\n`;
                markdown += `- **ë³€ìˆ˜ ëª©ë¡**: ${columns.join(', ')}\n\n`;
            }
            
            // 2. ë°ì´í„° ê²€ì¦ ê²°ê³¼
            if (results.validation) {
                markdown += `## 2. ë°ì´í„° ê²€ì¦\n\n`;
                markdown += `- **ìˆ˜ì¹˜í˜• ë³€ìˆ˜**: ${results.validation.numericColumns?.join(', ') || 'ì—†ìŒ'}\n`;
                markdown += `- **ë²”ì£¼í˜• ë³€ìˆ˜**: ${results.validation.groupColumns?.join(', ') || 'ì—†ìŒ'}\n`;
                markdown += `- **ê²°ì¸¡ì¹˜**: ${results.validation.missingValues || 0}ê°œ\n`;
                markdown += `- **ì´ìƒì¹˜**: ${results.validation.outliers || 0}ê°œ\n\n`;
            }
            
            // 3. í†µê³„ì  ê°€ì • ê²€ì •
            if (results.assumptions) {
                markdown += `## 3. í†µê³„ì  ê°€ì • ê²€ì •\n\n`;
                
                // ì •ê·œì„± ê²€ì •
                if (results.assumptions.normality) {
                    markdown += `### 3.1 ì •ê·œì„± ê²€ì •\n\n`;
                    markdown += `| ë³€ìˆ˜ | ê²€ì •ë°©ë²• | í†µê³„ëŸ‰ | p-ê°’ | ê²°ê³¼ |\n`;
                    markdown += `|------|----------|--------|------|------|\n`;
                    
                    results.assumptions.normality.forEach(n => {
                        markdown += `| ${n.variable} | ${n.test} | ${n.statistic?.toFixed(4) || '-'} | ${n.pValue?.toFixed(4) || '-'} | ${n.isNormal ? 'ì •ê·œë¶„í¬ âœ“' : 'ë¹„ì •ê·œë¶„í¬ âœ—'} |\n`;
                    });
                    markdown += `\n`;
                }
                
                // ë“±ë¶„ì‚°ì„± ê²€ì •
                if (results.assumptions.homogeneity) {
                    markdown += `### 3.2 ë“±ë¶„ì‚°ì„± ê²€ì •\n\n`;
                    markdown += `| ë³€ìˆ˜ | ê²€ì •ë°©ë²• | í†µê³„ëŸ‰ | p-ê°’ | ê²°ê³¼ |\n`;
                    markdown += `|------|----------|--------|------|------|\n`;
                    
                    results.assumptions.homogeneity.forEach(h => {
                        markdown += `| ${h.variable} | ${h.test} | ${h.statistic?.toFixed(4) || '-'} | ${h.pValue?.toFixed(4) || '-'} | ${h.isHomogeneous ? 'ë“±ë¶„ì‚° âœ“' : 'ì´ë¶„ì‚° âœ—'} |\n`;
                    });
                    markdown += `\n`;
                }
            }
            
            // 4. ë¶„ì„ ë°©ë²•
            if (results.method) {
                markdown += `## 4. ì„ íƒëœ ë¶„ì„ ë°©ë²•\n\n`;
                markdown += `- **ë°©ë²•**: ${results.method.name}\n`;
                markdown += `- **ì„ íƒ ì´ìœ **: ${results.method.reason}\n\n`;
            }
            
            // 5. ë¶„ì„ ê²°ê³¼
            if (results.final) {
                markdown += `## 5. í†µê³„ ë¶„ì„ ê²°ê³¼\n\n`;
                const stats = results.final.statistics;
                
                markdown += `- **ê²€ì • í†µê³„ëŸ‰**: ${stats.testStatistic?.toFixed(4) || '-'}\n`;
                markdown += `- **p-ê°’**: ${stats.pValue?.toFixed(4) || '-'}\n`;
                markdown += `- **ìœ ì˜ìˆ˜ì¤€**: 0.05\n`;
                markdown += `- **ê²°ë¡ **: ${stats.pValue < 0.05 ? '**í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•¨**' : 'í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•˜ì§€ ì•ŠìŒ'}\n\n`;
                
                // ê·¸ë£¹ë³„ í†µê³„
                if (stats.groups) {
                    markdown += `### 5.1 ê·¸ë£¹ë³„ ê¸°ìˆ í†µê³„\n\n`;
                    markdown += `| ê·¸ë£¹ | í‰ê·  | í‘œì¤€í¸ì°¨ | í‘œë³¸ìˆ˜ |\n`;
                    markdown += `|------|------|----------|--------|\n`;
                    
                    for (const [group, data] of Object.entries(stats.groups)) {
                        markdown += `| ${group} | ${data.mean?.toFixed(3) || '-'} | ${data.std?.toFixed(3) || '-'} | ${data.n || '-'} |\n`;
                    }
                    markdown += `\n`;
                }
                
                // íš¨ê³¼ í¬ê¸°
                if (stats.effectSize) {
                    markdown += `### 5.2 íš¨ê³¼ í¬ê¸°\n\n`;
                    markdown += `- **Cohen's d**: ${stats.effectSize.cohensD?.toFixed(3) || '-'}\n`;
                    markdown += `- **í•´ì„**: ${stats.effectSize.interpretation || '-'}\n\n`;
                }
            }
            
            // 6. ì‚¬í›„ë¶„ì„
            if (results.postHoc) {
                markdown += `## 6. ì‚¬í›„ë¶„ì„ ê²°ê³¼\n\n`;
                markdown += `- **ë°©ë²•**: ${results.postHoc.method}\n\n`;
                
                if (results.postHoc.comparisons) {
                    markdown += `| ë¹„êµ | í‰ê· ì°¨ì´ | p-ê°’ | ìœ ì˜ì„± |\n`;
                    markdown += `|------|----------|------|--------|\n`;
                    
                    results.postHoc.comparisons.forEach(c => {
                        markdown += `| ${c.group1} vs ${c.group2} | ${c.meanDifference?.toFixed(3) || '-'} | ${c.pValue?.toFixed(4) || '-'} | ${c.significant ? 'ìœ ì˜í•¨ *' : '-'} |\n`;
                    });
                }
                markdown += `\n`;
            }
            
            // 7. ê¶Œì¥ì‚¬í•­
            markdown += `## 7. ê¶Œì¥ì‚¬í•­ ë° ì°¸ê³ ì‚¬í•­\n\n`;
            markdown += `- ë³¸ ë¶„ì„ì€ ìë™í™”ëœ í†µê³„ ë¶„ì„ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.\n`;
            markdown += `- ê²°ê³¼ í•´ì„ ì‹œ ì „ë¬¸ê°€ì˜ ê²€í† ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.\n`;
            markdown += `- ì¶”ê°€ ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš° ì›ë³¸ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.\n`;
            
            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([markdown], {type: 'text/markdown;charset=utf-8'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `í†µê³„ë¶„ì„ë³´ê³ ì„œ_${new Date().toISOString().slice(0,10)}.md`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // PDFë¡œ ë‚´ë³´ë‚´ê¸°
        async function exportToPDF() {
            closeExportModal();
            
            // jsPDFê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (typeof window.jspdf === 'undefined') {
                alert('PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            // í•œê¸€ í°íŠ¸ ì„¤ì • (ê¸°ë³¸ í°íŠ¸ëŠ” í•œê¸€ ë¯¸ì§€ì›ì´ë¯€ë¡œ ì˜ë¬¸ìœ¼ë¡œ ì‘ì„±)
            const date = new Date().toLocaleDateString('en-US');
            const results = analysisResults;
            
            // ì œëª©
            doc.setFontSize(20);
            doc.text('Statistical Analysis Report', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.text(`Date: ${date}`, 20, 35);
            doc.text('Platform: NIFS Statistical Analysis Platform', 20, 42);
            
            doc.line(20, 45, 190, 45);
            
            let yPos = 55;
            
            // 1. Data Summary
            doc.setFontSize(14);
            doc.text('1. Data Summary', 20, yPos);
            yPos += 10;
            
            if (currentData) {
                const columns = Object.keys(currentData);
                const rows = currentData[columns[0]]?.length || 0;
                
                doc.setFontSize(11);
                doc.text(`- Variables: ${columns.length}`, 25, yPos);
                yPos += 7;
                doc.text(`- Observations: ${rows}`, 25, yPos);
                yPos += 7;
                doc.text(`- Variable names: ${columns.join(', ')}`, 25, yPos);
                yPos += 15;
            }
            
            // 2. Statistical Test Results
            if (results.final) {
                doc.setFontSize(14);
                doc.text('2. Statistical Test Results', 20, yPos);
                yPos += 10;
                
                const stats = results.final.statistics;
                doc.setFontSize(11);
                doc.text(`- Test Method: ${results.method?.name || 'N/A'}`, 25, yPos);
                yPos += 7;
                doc.text(`- Test Statistic: ${stats.testStatistic?.toFixed(4) || 'N/A'}`, 25, yPos);
                yPos += 7;
                doc.text(`- p-value: ${stats.pValue?.toFixed(4) || 'N/A'}`, 25, yPos);
                yPos += 7;
                doc.text(`- Significance Level: 0.05`, 25, yPos);
                yPos += 7;
                
                const conclusion = stats.pValue < 0.05 ? 'Statistically Significant' : 'Not Significant';
                doc.setFont(undefined, 'bold');
                doc.text(`- Conclusion: ${conclusion}`, 25, yPos);
                doc.setFont(undefined, 'normal');
                yPos += 15;
            }
            
            // 3. Group Statistics (if available)
            if (results.final?.statistics?.groups) {
                doc.setFontSize(14);
                doc.text('3. Group Statistics', 20, yPos);
                yPos += 10;
                
                doc.setFontSize(11);
                for (const [group, data] of Object.entries(results.final.statistics.groups)) {
                    doc.text(`${group}: Mean=${data.mean?.toFixed(3)}, SD=${data.std?.toFixed(3)}, N=${data.n}`, 25, yPos);
                    yPos += 7;
                    
                    // í˜ì´ì§€ ë„˜ê¹€ ì²´í¬
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                }
            }
            
            // ì €ì¥
            doc.save(`Statistical_Report_${new Date().toISOString().slice(0,10)}.pdf`);
        }
        
        // Excelë¡œ ë‚´ë³´ë‚´ê¸°
        function exportToExcel() {
            closeExportModal();
            
            if (typeof XLSX === 'undefined') {
                alert('Excel ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const wb = XLSX.utils.book_new();
            
            // 1. ì›ë³¸ ë°ì´í„° ì‹œíŠ¸
            if (currentData) {
                const ws = XLSX.utils.json_to_sheet(
                    Object.keys(currentData[Object.keys(currentData)[0]]).map(i => {
                        const row = {};
                        Object.keys(currentData).forEach(col => {
                            row[col] = currentData[col][i];
                        });
                        return row;
                    })
                );
                XLSX.utils.book_append_sheet(wb, ws, "ì›ë³¸ë°ì´í„°");
            }
            
            // 2. ë¶„ì„ ê²°ê³¼ ì‹œíŠ¸
            const resultsData = [];
            
            if (analysisResults.final) {
                const stats = analysisResults.final.statistics;
                resultsData.push(['í†µê³„ ë¶„ì„ ê²°ê³¼']);
                resultsData.push(['']);
                resultsData.push(['í•­ëª©', 'ê°’']);
                resultsData.push(['ë¶„ì„ ë°©ë²•', analysisResults.method?.name || '']);
                resultsData.push(['ê²€ì • í†µê³„ëŸ‰', stats.testStatistic?.toFixed(4) || '']);
                resultsData.push(['p-ê°’', stats.pValue?.toFixed(4) || '']);
                resultsData.push(['ìœ ì˜ìˆ˜ì¤€', '0.05']);
                resultsData.push(['ê²°ë¡ ', stats.pValue < 0.05 ? 'ìœ ì˜í•¨' : 'ìœ ì˜í•˜ì§€ ì•ŠìŒ']);
                
                if (stats.groups) {
                    resultsData.push(['']);
                    resultsData.push(['ê·¸ë£¹ë³„ í†µê³„']);
                    resultsData.push(['ê·¸ë£¹', 'í‰ê· ', 'í‘œì¤€í¸ì°¨', 'í‘œë³¸ìˆ˜']);
                    
                    for (const [group, data] of Object.entries(stats.groups)) {
                        resultsData.push([group, data.mean?.toFixed(3), data.std?.toFixed(3), data.n]);
                    }
                }
            }
            
            const ws2 = XLSX.utils.aoa_to_sheet(resultsData);
            XLSX.utils.book_append_sheet(wb, ws2, "ë¶„ì„ê²°ê³¼");
            
            // íŒŒì¼ ì €ì¥
            XLSX.writeFile(wb, `í†µê³„ë¶„ì„_${new Date().toISOString().slice(0,10)}.xlsx`);
        }
        
        // ì§„í–‰ ìƒí™© ê°€ì ¸ì˜¤ê¸°
        function importProgress(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importData = JSON.parse(e.target.result);
                    currentData = importData.data;
                    analysisResults = importData.results;
                    currentStep = importData.metadata.currentStep;
                    autoProgress = importData.settings.autoProgress;
                    
                    // UI ì—…ë°ì´íŠ¸
                    moveToStep(currentStep);
                    document.getElementById('autoProgress').checked = autoProgress;
                    
                    alert('ì§„í–‰ ìƒí™©ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤');
                } catch (error) {
                    alert('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        // ë¹„êµ ë¶„ì„ ê¸°ëŠ¥
        let comparisonDatasets = [];
        
        function addComparisonDataset(name, data) {
            comparisonDatasets.push({
                name: name,
                data: data,
                results: null,
                timestamp: new Date().toISOString()
            });
            
            updateComparisonUI();
        }
        
        function updateComparisonUI() {
            if (comparisonDatasets.length > 1) {
                // ë¹„êµ ë¶„ì„ ë²„íŠ¼ í‘œì‹œ
                const compareBtn = document.getElementById('compareBtn');
                if (!compareBtn) {
                    const btn = document.createElement('button');
                    btn.id = 'compareBtn';
                    btn.className = 'btn-primary mt-4';
                    btn.innerHTML = 'ğŸ“Š ë°ì´í„°ì…‹ ë¹„êµ ë¶„ì„';
                    btn.onclick = runComparisonAnalysis;
                    document.querySelector('.max-w-7xl').appendChild(btn);
                }
            }
        }
        
        async function runComparisonAnalysis() {
            if (!pyodide) {
                alert('í†µê³„ ì—”ì§„ì´ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ë¹„êµ ë¶„ì„ ëª¨ë‹¬ í‘œì‹œ
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-lg p-8 max-w-4xl mx-4 max-h-[80vh] overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-4">ğŸ“Š ë°ì´í„°ì…‹ ë¹„êµ ë¶„ì„</h2>
                    <div class="grid grid-cols-2 gap-4">
                        ${comparisonDatasets.map((ds, i) => `
                            <div class="border rounded-lg p-4">
                                <h3 class="font-semibold">${ds.name}</h3>
                                <p class="text-sm text-gray-600">ë°ì´í„° í¬ì¸íŠ¸: ${Object.values(ds.data)[0]?.length || 0}</p>
                                <p class="text-sm text-gray-600">ê·¸ë£¹ ìˆ˜: ${Object.keys(ds.data).length}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div id="comparisonResults" class="mt-6">
                        <div class="loading-spinner mx-auto"></div>
                        <p class="text-center mt-2">ë¹„êµ ë¶„ì„ ì¤‘...</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="btn-secondary mt-4">
                        ë‹«ê¸°
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ë¹„êµ ë¶„ì„ ì‹¤í–‰
            setTimeout(async () => {
                const results = await pyodide.runPythonAsync(`
                    import json
                    
                    def compare_datasets(datasets):
                        results = []
                        for ds in datasets:
                            # ê¸°ë³¸ í†µê³„
                            stats = {}
                            for key, values in ds['data'].items():
                                numeric_vals = [float(v) for v in values if v is not None]
                                if numeric_vals:
                                    stats[key] = {
                                        'mean': np.mean(numeric_vals),
                                        'std': np.std(numeric_vals),
                                        'min': np.min(numeric_vals),
                                        'max': np.max(numeric_vals)
                                    }
                            results.append({
                                'name': ds['name'],
                                'stats': stats
                            })
                        
                        # ë°ì´í„°ì…‹ ê°„ ë¹„êµ
                        if len(datasets) == 2:
                            # t-test ë˜ëŠ” Mann-Whitney U test
                            pass
                        
                        return json.dumps(results)
                    
                    compare_datasets(${JSON.stringify(comparisonDatasets)})
                `);
                
                const compResults = JSON.parse(results);
                document.getElementById('comparisonResults').innerHTML = `
                    <h3 class="font-semibold mb-3">ë¹„êµ ë¶„ì„ ê²°ê³¼</h3>
                    ${compResults.map(r => `
                        <div class="mb-4">
                            <h4 class="font-medium">${r.name}</h4>
                            ${Object.entries(r.stats).map(([key, stats]) => `
                                <p class="text-sm">
                                    ${key}: í‰ê· =${stats.mean.toFixed(2)}, 
                                    í‘œì¤€í¸ì°¨=${stats.std.toFixed(2)}
                                </p>
                            `).join('')}
                        </div>
                    `).join('')}
                `;
            }, 1000);
        }
        
        // ìë™ ì €ì¥ ê¸°ëŠ¥ ì œê±° - ë§¤ë²ˆ ìƒˆë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì´ ë” ê¹”ë”í•¨
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ì „ ë°ì´í„° ì •ë¦¬ (ê¹”ë”í•œ ì‹œì‘)
        window.addEventListener('load', () => {
            // ì´ì „ ë¶„ì„ ë°ì´í„° ì •ë¦¬ (ë§¤ë²ˆ ìƒˆë¡œ ì‹œì‘)
            localStorage.removeItem('analysisProgress');
        });
        
        // í˜ì´ì§€ ì¢…ë£Œ ì‹œ ìë™ ì €ì¥ ì œê±° - ë§¤ë²ˆ ê¹”ë”í•˜ê²Œ ì‹œì‘
        
        // ì¶”ê°€ ë¶„ì„ í•¨ìˆ˜ë“¤
        
        // One-way ANOVA ì‹¤í–‰
        async function performOneWayANOVA(method) {
            const pythonCode = `
import numpy as np
from scipy import stats
import json

def one_way_anova(data, factor, dependent):
    """One-way ANOVA ì‹¤í–‰"""
    import pandas as pd
    df = pd.DataFrame(data)
    
    # ê·¸ë£¹ë³„ ë°ì´í„° ë¶„ë¦¬
    groups = {}
    for level in df[factor].unique():
        groups[level] = df[df[factor] == level][dependent].dropna().tolist()
    
    # ê° ê·¸ë£¹ì˜ ë°ì´í„°
    group_data = list(groups.values())
    group_names = list(groups.keys())
    
    # One-way ANOVA
    f_stat, p_value = stats.f_oneway(*group_data)
    
    # ê¸°ìˆ í†µê³„
    group_stats = {}
    for name, data in groups.items():
        group_stats[name] = {
            'mean': float(np.mean(data)),
            'std': float(np.std(data, ddof=1)),
            'n': len(data)
        }
    
    return {
        'f_statistic': float(f_stat),
        'p_value': float(p_value),
        'groups': group_stats,
        'factor': factor,
        'dependent': dependent
    }

result = one_way_anova(${JSON.stringify(currentData)}, '${method.factor}', '${method.dependent}')
result
`;
            
            const pyResult = await pyodide.runPythonAsync(pythonCode);
            const result = pyResult.toJs({dict_converter: Object.fromEntries});
            
            const interpretation = result.p_value < 0.05 ?
                `ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤ (F=${result.f_statistic.toFixed(3)}, p=${result.p_value.toFixed(4)}).` :
                `ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤ (F=${result.f_statistic.toFixed(3)}, p=${result.p_value.toFixed(4)}).`;
            
            return {
                test: 'One-way ANOVA',
                type: 'one_way_anova',
                result: result,
                interpretation: interpretation,
                significant: result.p_value < 0.05,
                pValue: result.p_value
            };
        }
        
        // t-test ì‹¤í–‰
        async function performTTest(method) {
            const pythonCode = `
import numpy as np
from scipy import stats
import json

def independent_ttest(data, factor, dependent):
    """ë…ë¦½í‘œë³¸ t-test ì‹¤í–‰"""
    import pandas as pd
    df = pd.DataFrame(data)
    
    groups = list(df[factor].unique())
    if len(groups) != 2:
        raise ValueError('t-testëŠ” ì •í™•íˆ 2ê°œ ê·¸ë£¹ì´ í•„ìš”í•©ë‹ˆë‹¤')
    
    group1_data = df[df[factor] == groups[0]][dependent].dropna().tolist()
    group2_data = df[df[factor] == groups[1]][dependent].dropna().tolist()
    
    # ë…ë¦½í‘œë³¸ t-test
    t_stat, p_value = stats.ttest_ind(group1_data, group2_data)
    
    # ë“±ë¶„ì‚° ê²€ì •
    levene_stat, levene_p = stats.levene(group1_data, group2_data)
    equal_var = levene_p > 0.05
    
    # Welch's t-test (ë“±ë¶„ì‚° ê°€ì • ìœ„ë°˜ì‹œ)
    if not equal_var:
        t_stat, p_value = stats.ttest_ind(group1_data, group2_data, equal_var=False)
    
    return {
        't_statistic': float(t_stat),
        'p_value': float(p_value),
        'equal_variances': equal_var,
        'group1': {'name': groups[0], 'mean': float(np.mean(group1_data)), 'n': len(group1_data)},
        'group2': {'name': groups[1], 'mean': float(np.mean(group2_data)), 'n': len(group2_data)},
        'test_type': 'Welch\\'s t-test' if not equal_var else 'Student\\'s t-test'
    }

result = independent_ttest(${JSON.stringify(currentData)}, '${method.factor}', '${method.dependent}')
result
`;
            
            const pyResult = await pyodide.runPythonAsync(pythonCode);
            const result = pyResult.toJs({dict_converter: Object.fromEntries});
            
            const interpretation = result.p_value < 0.05 ?
                `ë‘ ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤ (t=${result.t_statistic.toFixed(3)}, p=${result.p_value.toFixed(4)}).` :
                `ë‘ ê·¸ë£¹ ê°„ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤ (t=${result.t_statistic.toFixed(3)}, p=${result.p_value.toFixed(4)}).`;
            
            return {
                test: result.test_type,
                type: 'ttest',
                result: result,
                interpretation: interpretation,
                significant: result.p_value < 0.05,
                pValue: result.p_value
            };
        }
        
        // ê¸°íƒ€ ë¶„ì„ë“¤ (ê°„ë‹¨ êµ¬í˜„)
        async function performCPUEAnalysis(method) {
            return {
                test: 'CPUE Analysis',
                type: 'cpue',
                interpretation: 'CPUE ë¶„ì„ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. í˜„ì¬ëŠ” ê¸°ë³¸ í†µê³„ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.',
                pValue: 0.05
            };
        }
        
        async function performGrowthAnalysis(method) {
            return {
                test: 'Growth Analysis',
                type: 'growth',
                interpretation: 'ì„±ì¥ ë¶„ì„ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. í˜„ì¬ëŠ” ê¸°ë³¸ í†µê³„ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.',
                pValue: 0.05
            };
        }
        
        async function performDescriptiveStats(method) {
            const pythonCode = `
import numpy as np
from scipy import stats
import json

def descriptive_stats(data):
    """ê¸°ìˆ í†µê³„ ë¶„ì„"""
    import pandas as pd
    df = pd.DataFrame(data)
    
    # ìˆ«ìí˜• ì»¬ëŸ¼ë§Œ ì„ íƒ
    numeric_cols = df.select_dtypes(include=[np.number]).columns.tolist()
    
    results = {}
    for col in numeric_cols:
        col_data = df[col].dropna()
        results[col] = {
            'count': len(col_data),
            'mean': float(np.mean(col_data)),
            'std': float(np.std(col_data, ddof=1)),
            'min': float(np.min(col_data)),
            'max': float(np.max(col_data)),
            'q25': float(np.percentile(col_data, 25)),
            'median': float(np.percentile(col_data, 50)),
            'q75': float(np.percentile(col_data, 75))
        }
    
    return results

result = descriptive_stats(${JSON.stringify(currentData)})
result
`;
            
            const pyResult = await pyodide.runPythonAsync(pythonCode);
            const result = pyResult.toJs({dict_converter: Object.fromEntries});
            
            return {
                test: 'Descriptive Statistics',
                type: 'descriptive',
                result: result,
                interpretation: `${Object.keys(result).length}ê°œ ë³€ìˆ˜ì˜ ê¸°ìˆ í†µê³„ê°€ ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                pValue: null
            };
        }
    </script>
</body>
</html>
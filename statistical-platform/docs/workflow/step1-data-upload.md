# Step 1: 데이터 업로드 - 상세 명세

**버전**: 1.0.0
**최종 수정일**: 2025-01-17
**단계 번호**: 1/5

[← 전체 워크플로우로 돌아가기](./README.md)

---

## 📂 단계 개요

| 항목 | 내용 |
|-----|------|
| **목적** | 사용자의 데이터 파일을 안전하고 효율적으로 시스템에 가져오기 |
| **설명** | 분석할 파일 선택 |
| **아이콘** | Upload |
| **예상 소요시간** | 1-5분 (파일 크기에 따라) |
| **선행 조건** | 없음 |
| **다음 단계** | Step 2: 데이터 확인 |

## 1.1 지원 파일 형식

### CSV 파일 (.csv)
- **인코딩**: UTF-8, EUC-KR, CP949 자동 감지
- **구분자**: 쉼표(,), 탭(\t), 세미콜론(;) 자동 감지
- **따옴표**: 큰따옴표("), 작은따옴표(') 지원
- **줄바꿈**: CRLF, LF 모두 지원
- **최대 크기**: 100MB
- **최대 행**: 500,000개
- **최대 열**: 1,000개

### Excel 파일 (.xlsx, .xls)
- **시트**: 첫 번째 시트 자동 선택, 다중 시트 선택 UI 제공
- **병합 셀**: 자동 분리 처리
- **수식**: 계산된 값으로 변환
- **날짜/시간**: ISO 8601 형식으로 변환
- **최대 크기**: 20MB
- **최대 행**: 100,000개
- **최대 열**: 500개

### 향후 지원 예정
- JSON (.json)
- TSV (.tsv)
- Parquet (.parquet)
- SPSS (.sav)
- SAS (.sas7bdat)

## 1.2 파일 업로드 인터페이스

### 드래그앤드롭 영역
```
┌─────────────────────────────────────┐
│                                     │
│         📁                          │
│                                     │
│   파일을 드래그하거나               │
│   클릭하여 선택하세요               │
│                                     │
│   CSV, Excel 지원                   │
│   최대: CSV 100MB, Excel 20MB      │
│                                     │
└─────────────────────────────────────┘
```

**상태별 UI 변화**:
- **기본**: 회색 점선 테두리
- **드래그 오버**: 파란색 실선, 배경색 변경
- **업로드 중**: 진행률 표시
- **완료**: 초록색 체크 아이콘

## 1.3 파일 검증 프로세스

### 1단계: 형식 검증
```javascript
if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
  maxSize = 100 * 1024 * 1024; // 100MB
} else if (file.type.includes('excel') || file.name.match(/\.xlsx?$/)) {
  maxSize = 20 * 1024 * 1024;  // 20MB
} else {
  reject('지원하지 않는 파일 형식');
}
```

### 2단계: 크기 검증
- CSV: 100MB 이하 → 정상 처리
- CSV: 100-200MB → 샘플링 권장
- CSV: 200MB 초과 → 차단, 대안 제시
- Excel: 20MB 이하 → 정상 처리
- Excel: 20-50MB → 샘플링 권장
- Excel: 50MB 초과 → 차단, 대안 제시

### 3단계: 보안 검증
- 악성 스크립트 패턴 검사
- SQL injection 시그니처 탐지
- 실행 파일 확장자 차단 (.exe, .bat, .sh)
- MIME 타입과 확장자 일치 확인

## 1.4 데이터 파싱

### 인코딩 감지 프로세스
1. **BOM 확인**: UTF-8, UTF-16 BOM 체크
2. **자동 감지**: CharDet 라이브러리 사용
3. **휴리스틱**: 한글 포함 시 EUC-KR/CP949 우선
4. **사용자 선택**: 감지 실패 시 선택 UI 표시

### 구조 파싱
- **헤더 감지**: 첫 행의 데이터 타입 분석
- **타입 추론**: 각 열의 데이터 타입 자동 판별
- **누락값 처리**: null, NaN, 빈 문자열 통일
- **이상값 플래깅**: 명백한 오류값 표시

## 1.5 대용량 파일 처리

### 처리 전략
```
파일 크기
├─ 10MB 이하: 동기 처리
├─ 10-50MB: Web Worker 처리
├─ 50-100MB: 청크 + Worker
└─ 100MB+: 샘플링 또는 서버 처리
```

### 샘플링 옵션
1. **균등 샘플링**: 전체의 10%, 25%, 50%
2. **첫 N행**: 10,000행, 50,000행
3. **층화 샘플링**: 범주형 변수 기준
4. **시계열 샘플링**: 시간 간격 기준

### 메모리 관리
- 실시간 메모리 모니터링
- 80% 초과 시 경고 메시지
- 90% 초과 시 처리 중단
- 가비지 컬렉션 수동 트리거

## 1.6 업로드 상태 표시

### 진행 단계
| 단계 | 설명 | 진행률 |
|-----|------|--------|
| 1 | 파일 읽기 | 0-30% |
| 2 | 데이터 파싱 | 30-60% |
| 3 | 구조 분석 | 60-90% |
| 4 | 완료 처리 | 90-100% |

### 실시간 정보 표시
- 현재 처리 중인 행 번호
- 처리 속도 (행/초)
- 예상 남은 시간
- 메모리 사용량

## 1.7 업로드 완료 정보

### 표시 항목
```
✅ 업로드 성공

파일 정보:
• 파일명: sales_data_2024.csv
• 크기: 15.3MB
• 인코딩: UTF-8

데이터 구조:
• 행: 45,231개
• 열: 23개
• 수치형: 15개
• 문자형: 8개

처리 시간: 3.2초
```

## 1.8 에러 처리

### 에러 유형별 메시지

#### 파일 형식 에러
```
❌ 지원하지 않는 파일 형식입니다.

지원 형식: CSV, Excel (xlsx, xls)
현재 파일: document.pdf

[다른 파일 선택]
```

#### 크기 초과 에러
```
❌ 파일이 너무 큽니다.

파일 크기: 152MB
최대 허용: 100MB (CSV)

해결 방법:
• 데이터 샘플링 사용
• 필요한 열만 추출
• 여러 파일로 분할

[샘플링 도구] [도움말]
```

#### 파싱 에러
```
⚠️ 데이터를 읽는 중 문제가 발생했습니다.

15행에서 열 개수 불일치
예상: 12개, 실제: 8개

[건너뛰고 계속] [파일 수정]
```

## 1.9 자동 진행 조건

다음 조건 모두 충족 시 자동으로 Step 2로 진행:
- ✅ 파일 파싱 완료
- ✅ 최소 1개 데이터 행
- ✅ 최소 1개 변수(열)
- ✅ 보안 검증 통과
- ✅ 치명적 에러 없음

## 1.10 접근성 지원

- **키보드 네비게이션**: Tab, Enter 키 지원
- **스크린 리더**: ARIA 라벨 제공
- **색맹 모드**: 색상 외 아이콘/패턴 사용
- **다국어**: 한국어, 영어 지원

## 1.11 브라우저 호환성

| 브라우저 | 최소 버전 | 최대 메모리 |
|---------|----------|------------|
| Chrome | 90+ | 2GB |
| Firefox | 88+ | 1GB |
| Safari | 14+ | 1GB |
| Edge | 90+ | 2GB |

---

[다음: Step 2 - 데이터 확인 →](./STEP2_DATA_VALIDATION_SPEC.md)
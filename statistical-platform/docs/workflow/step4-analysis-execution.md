# Step 4: 분석 수행 - 상세 명세

**버전**: 1.0.0
**최종 수정일**: 2025-01-17
**단계 번호**: 4/5

[← 전체 워크플로우로 돌아가기](./README.md) | [← Step 3](./STEP3_ANALYSIS_GOAL_SPEC.md) | [Step 5 →](./STEP5_RESULTS_INTERPRETATION_SPEC.md)

---

## ⚙️ 단계 개요

| 항목 | 내용 |
|-----|------|
| **목적** | 선택된 통계 방법으로 실제 분석을 실행하고 결과 계산 |
| **설명** | 최적 통계 방법으로 분석 |
| **아이콘** | BarChart3 |
| **예상 소요시간** | 5-30초 (데이터 크기 및 방법에 따라) |
| **선행 조건** | Step 3 완료 (분석 방법 선택) |
| **다음 단계** | Step 5: 결과 해석 |
| **핵심 원칙** | "정확한 계산과 명확한 진행 표시" |

## 4.1 UI 레이아웃

### 4.1.1 메인 진행 화면

```
┌──────────────────────────────────────────────┐
│  분석 수행 중                                  │
│                                               │
│  ┌─────────────────────────────────────┐     │
│  │                                      │     │
│  │         [■■■■■■□□□□] 60%            │     │
│  │                                      │     │
│  └─────────────────────────────────────┘     │
│                                               │
│  현재 단계: 가정 검정                          │
│  • 정규성 검정 완료 ✓                          │
│  • 등분산성 검정 진행 중...                    │
│                                               │
│  예상 남은 시간: 5초                           │
│                                               │
│  [일시정지] [취소]                             │
└──────────────────────────────────────────────┘
```

### 4.1.2 진행 단계 표시

| 단계 | 작업 내용 | 진행률 범위 | 표시 메시지 |
|------|----------|------------|------------|
| 1 | 환경 준비 | 0-15% | "분석 환경 준비 중..." |
| 2 | 데이터 전처리 | 15-30% | "데이터 전처리 중..." |
| 3 | 가정 검정 | 30-50% | "통계적 가정 검증 중..." |
| 4 | 주 분석 | 50-75% | "통계 분석 실행 중..." |
| 5 | 추가 계산 | 75-90% | "추가 통계량 계산 중..." |
| 6 | 결과 정리 | 90-100% | "결과 정리 중..." |

## 4.2 실시간 피드백

### 4.2.1 상세 로그 패널 (선택적 표시)

```
▼ 상세 실행 로그 [접기/펼치기]
┌──────────────────────────────────────────────┐
│ [09:23:45] 분석 환경 준비 완료               │
│ [09:23:46] 데이터 로드 완료 (n=500)          │
│ [09:23:47] 결측값 처리 완료 (제거: 5개)      │
│ [09:23:48] 정규성 검정: p=0.234 (만족)       │
│ [09:23:49] 등분산성 검정: p=0.456 (만족)     │
│ [09:23:50] 독립표본 t-test 실행              │
│ [09:23:51] 효과크기 계산 완료                │
│ [09:23:52] 분석 완료!                        │
└──────────────────────────────────────────────┘
```

### 4.2.2 진행 상태 아이콘

- ⏳ 대기 중
- 🔄 진행 중 (회전 애니메이션)
- ✅ 완료
- ⚠️ 경고 (진행은 계속)
- ❌ 오류 (중단)

## 4.3 분석 실행 흐름

### 4.3.1 공통 실행 프로세스

```
Step 3 결과 수신
    ↓
데이터 유효성 확인
    ↓
결측값 처리
    ↓
[가정 검정] (필요시)
    ↓
주 분석 실행
    ↓
추가 통계량 계산
    ↓
결과 포맷팅
    ↓
Step 5로 전달
```

### 4.3.2 방법별 특수 처리

| 통계 방법 | 추가 단계 |
|-----------|----------|
| t-검정 계열 | 정규성, 등분산성 검정 |
| ANOVA | 사후검정 (유의미할 때) |
| 회귀분석 | VIF, 잔차 분석 |
| 비모수 | (가정 검정 생략) |
| PCA | 적재값, scree plot 데이터 |
| 시계열 | 정상성, 자기상관 |

## 4.4 결과 데이터 구조

### 4.4.1 표준 출력 형식

```javascript
{
  // 메타 정보
  metadata: {
    method: "twoSampleTTest",
    timestamp: "2025-01-17T09:23:52",
    duration: 7.2,  // 초
    dataInfo: {
      totalN: 495,
      missingRemoved: 5
    }
  },

  // 주 결과
  mainResults: {
    statistic: 2.345,
    pvalue: 0.023,
    df: 493,
    significant: true  // p < 0.05
  },

  // 부가 정보
  additionalInfo: {
    effectSize: {
      type: "cohens_d",
      value: 0.47,
      interpretation: "medium"
    },
    confidenceInterval: {
      level: 0.95,
      lower: 1.23,
      upper: 5.67
    },
    assumptions: {
      passed: true,
      details: [...]
    }
  },

  // 시각화용 데이터
  visualizationData: {
    type: "boxplot",
    data: {...}
  }
}
```

### 4.4.2 필수 vs 선택 출력

**모든 분석 필수:**
- statistic (검정통계량)
- pvalue
- n (표본 크기)

**선택적 출력:**
- effectSize (효과크기)
- confidenceInterval (신뢰구간)
- power (검정력)
- assumptions (가정 검정)

## 4.5 오류 처리

### 4.5.1 복구 가능 오류

```
⚠️ 가정 위반 감지

정규성 가정이 충족되지 않습니다 (p=0.003)

선택 옵션:
[Mann-Whitney로 변경] [그대로 진행] [취소]
```

### 4.5.2 치명적 오류

```
❌ 분석 실행 실패

오류: 모든 그룹의 분산이 0입니다
원인: 각 그룹 내 모든 값이 동일

[데이터 확인] [다른 변수 선택] [도움말]
```

## 4.6 성능 고려사항

### 4.6.1 처리 시간 기준

| 데이터 크기 | 예상 시간 | 처리 방식 |
|------------|-----------|-----------|
| < 1,000행 | 1-5초 | 직접 처리 |
| 1,000-10,000행 | 5-15초 | 진행률 표시 |
| 10,000-100,000행 | 15-60초 | 청크 처리 |
| > 100,000행 | 60초+ | 샘플링 권장 |

### 4.6.2 사용자 경험 최적화

- 1초 이상: 진행률 표시
- 5초 이상: 예상 시간 표시
- 10초 이상: 중단 버튼 활성화
- 30초 이상: 백그라운드 처리 제안

## 4.7 중단 및 재개

### 4.7.1 일시정지 기능

```
분석 일시정지됨

현재 진행률: 45%
완료된 작업: 가정 검정

[계속] [처음부터] [취소]
```

### 4.7.2 취소 시 처리

```
정말 취소하시겠습니까?

• 현재까지 계산된 결과는 저장되지 않습니다
• Step 3로 돌아갑니다

[예, 취소] [계속 진행]
```

## 4.8 분석 완료 처리

### 4.8.1 성공 시

```
✅ 분석 완료!

소요 시간: 7.2초
다음 단계로 자동 이동합니다...

[지금 이동] [결과 미리보기]
```

### 4.8.2 부분 성공 시

```
⚠️ 분석 완료 (경고 있음)

• 주 분석: 완료
• 가정 검정: 일부 실패
• 추가 분석: 완료

[결과 보기] [경고 확인]
```

## 4.9 접근성 고려

- **진행률**: 텍스트로도 표시 (60%)
- **색상**: 색맹 친화적 팔레트
- **소리**: 완료 시 선택적 알림음
- **키보드**: Space로 일시정지, Esc로 취소

## 4.10 다음 단계 연계

### 자동 전달 데이터
- 분석 결과 객체
- 시각화 데이터
- 메타데이터
- 경고/오류 정보

### 수동 확인 필요 시
- 가정 위반이 심각한 경우
- 결과가 비정상적인 경우
- 사용자가 중단한 경우

---

[다음: Step 5 - 결과 해석 →](./STEP5_RESULTS_INTERPRETATION_SPEC.md)